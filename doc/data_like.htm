<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>Data Likelihood and Weighted Residuals</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="Data Likelihood and Weighted Residuals">
<meta name="keywords" id="keywords" content=" data likelihood weighted residuals table notation i y_i a_i b_i s_i t_i d_i i_i x_ij w_i delta_i measurement noise covariates k_i gamma_j effects u theta average integrand effect adjusted standard deviation scaling add variance add_std_scale_all add_std_scale_log add_var_scale_all add_var_scale_log residual ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_data_like_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://bradbell.github.io/dismod_at" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Location-&gt;</option>
<option>dismod_at</option>
<option>model</option>
<option>data_like</option>
</select>
</td>
<td>
<select onchange='choose_across0(this)'>
<option>Search-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td><a href="avg_integrand.htm" target="_top">Prev</a>
</td><td><a href="fixed_value.htm" target="_top">Next</a>
</td><td>
<script type='text/javascript' language='JavaScript' src='_childtable_dismod_at_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_model_htm.js'></script>
</td>
<td>data_like</td>
</tr></table><br>
@(@\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@


<center><b><big><big>Data Likelihood and Weighted Residuals</big></big></b></center>

<br><a href="data_like.htm#Data Table Notation" target="_top">Data&nbsp;Table&nbsp;Notation</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.i" target="_top">i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.y_i" target="_top">y_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.a_i" target="_top">a_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.b_i" target="_top">b_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.s_i" target="_top">s_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.t_i" target="_top">t_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.d_i" target="_top">d_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.I_i" target="_top">I_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.x_ij" target="_top">x_ij</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.w_i" target="_top">w_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Data Table Notation.Delta_i" target="_top">Delta_i</a>
<br><a href="data_like.htm#Measurement Noise Covariates" target="_top">Measurement&nbsp;Noise&nbsp;Covariates</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Measurement Noise Covariates.K_i" target="_top">K_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Measurement Noise Covariates.gamma_j" target="_top">gamma_j</a>
<br><a href="data_like.htm#Effects, u, theta" target="_top">Effects,&nbsp;u,&nbsp;theta</a>
<br><a href="data_like.htm#Average Integrand" target="_top">Average&nbsp;Integrand</a>
<br><a href="data_like.htm#Average Noise Effect" target="_top">Average&nbsp;Noise&nbsp;Effect</a>
<br><a href="data_like.htm#Adjusted Standard Deviation, delta_i" target="_top">Adjusted&nbsp;Standard&nbsp;Deviation,&nbsp;delta_i</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Adjusted Standard Deviation, delta_i.Scaling" target="_top">Scaling</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Adjusted Standard Deviation, delta_i.Add Variance or Standard Deviation" target="_top">Add&nbsp;Variance&nbsp;or&nbsp;Standard&nbsp;Deviation</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Adjusted Standard Deviation, delta_i.add_std_scale_all" target="_top">add_std_scale_all</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Adjusted Standard Deviation, delta_i.add_std_scale_log" target="_top">add_std_scale_log</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Adjusted Standard Deviation, delta_i.add_var_scale_all" target="_top">add_var_scale_all</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="data_like.htm#Adjusted Standard Deviation, delta_i.add_var_scale_log" target="_top">add_var_scale_log</a>
<br><a href="data_like.htm#Weighted Residual and Likelihood" target="_top">Weighted&nbsp;Residual&nbsp;and&nbsp;Likelihood</a>
<br><br>
<b><big><a name="Data Table Notation" id="Data Table Notation">Data Table Notation</a></big></b>


<br>
<br>
<big><a name="Data Table Notation.i" id="Data Table Notation.i">i</a></big>
<br>
We use <small>@(@
i
@)@</small> to
denote the <a href="data_table.htm#data_id" target="_top"><span style='white-space: nowrap'>data_id</span></a>

for a row in the data table.

<br>
<br>
<big><a name="Data Table Notation.y_i" id="Data Table Notation.y_i">y_i</a></big>
<br>
We use <small>@(@
y_i
@)@</small> to denote the corresponding
<a href="data_table.htm#meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>
 value.

<br>
<br>
<big><a name="Data Table Notation.a_i" id="Data Table Notation.a_i">a_i</a></big>
<br>
We use <small>@(@
a_i
@)@</small> to denote the corresponding
<a href="data_table.htm#age_lower" target="_top"><span style='white-space: nowrap'>age_lower</span></a>
 value.

<br>
<br>
<big><a name="Data Table Notation.b_i" id="Data Table Notation.b_i">b_i</a></big>
<br>
We use <small>@(@
b_i
@)@</small> to denote the corresponding
<a href="data_table.htm#age_upper" target="_top"><span style='white-space: nowrap'>age_upper</span></a>
 value.

<br>
<br>
<big><a name="Data Table Notation.s_i" id="Data Table Notation.s_i">s_i</a></big>
<br>
We use <small>@(@
s_i
@)@</small> to denote the corresponding
<a href="data_table.htm#time_lower" target="_top"><span style='white-space: nowrap'>time_lower</span></a>
 value.

<br>
<br>
<big><a name="Data Table Notation.t_i" id="Data Table Notation.t_i">t_i</a></big>
<br>
We use <small>@(@
t_i
@)@</small> to denote the corresponding
<a href="data_table.htm#time_upper" target="_top"><span style='white-space: nowrap'>time_upper</span></a>
 value.

<br>
<br>
<big><a name="Data Table Notation.d_i" id="Data Table Notation.d_i">d_i</a></big>
<br>
We use <small>@(@
d_i
@)@</small> to denote the
<a href="data_table.htm#density_id" target="_top"><span style='white-space: nowrap'>density_id</span></a>
 and
<a href="data_table.htm#eta" target="_top"><span style='white-space: nowrap'>eta</span></a>
 value corresponding to <small>@(@
i
@)@</small>.

<br>
<br>
<big><a name="Data Table Notation.I_i" id="Data Table Notation.I_i">I_i</a></big>
<br>
We use <small>@(@
I_i
@)@</small> to denote the corresponding
<a href="data_table.htm#integrand_id" target="_top"><span style='white-space: nowrap'>integrand_id</span></a>
 value.

<br>
<br>
<big><a name="Data Table Notation.x_ij" id="Data Table Notation.x_ij">x_ij</a></big>
<br>
We use <small>@(@
x_{i,j}
@)@</small> to denote the corresponding
<a href="data_table.htm#Covariates" target="_top"><span style='white-space: nowrap'>covariate</span></a>
 values where <small>@(@
j
@)@</small>
denotes the <a href="covariate_table.htm#covariate_id" target="_top"><span style='white-space: nowrap'>covariate_id</span></a>
.
Note that the covariate
<a href="covariate_table.htm#reference" target="_top"><span style='white-space: nowrap'>reference</span></a>
 has already
been subtracted from these values.

<br>
<br>
<big><a name="Data Table Notation.w_i" id="Data Table Notation.w_i">w_i</a></big>
<br>
We use <small>@(@
w_i (a, t)
@)@</small> for the weighting as a function of age and time
that corresponds to the
<a href="data_table.htm#weight_id" target="_top"><span style='white-space: nowrap'>weight_id</span></a>
 for this 
<code><i><font color="black"><span style='white-space: nowrap'>data_id</span></font></i></code>
.

<br>
<br>
<big><a name="Data Table Notation.Delta_i" id="Data Table Notation.Delta_i">Delta_i</a></big>
<br>
Let 
<code><i><font color="black"><span style='white-space: nowrap'>minimum_meas_cv</span></font></i></code>
 be the integrand table
<a href="integrand_table.htm#minimum_meas_cv" target="_top"><span style='white-space: nowrap'>minimum_meas_cv</span></a>
 corresponding to
this integrand <small>@(@
I_i
@)@</small>.
Let <a href="data_table.htm#meas_std" target="_top"><span style='white-space: nowrap'>meas_std</span></a>

and <a href="data_table.htm#meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>

correspond to this data table
<a href="data_table.htm#data_id" target="_top"><span style='white-space: nowrap'>data_id</span></a>
.
We use the notation <small>@(@
\Delta_i
@)@</small>
for the modified standard deviation used for this data

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>Delta_i</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;max(</span></font><i><font color="black"><span style='white-space: nowrap'>meas_std</span></font></i><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>minimum_meas_cv</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;*&nbsp;|</span></font><i><font color="black"><span style='white-space: nowrap'>meas_value</span></font></i><font color="blue"><span style='white-space: nowrap'>|&nbsp;)<br>
</span></font></code>
<br>
<b><big><a name="Measurement Noise Covariates" id="Measurement Noise Covariates">Measurement Noise Covariates</a></big></b>


<br>
<br>
<big><a name="Measurement Noise Covariates.K_i" id="Measurement Noise Covariates.K_i">K_i</a></big>
<br>
There is a set of rows in the mulcov table such that
<a href="mulcov_table.htm#integrand_id" target="_top"><span style='white-space: nowrap'>integrand_id</span></a>
 is equal to <small>@(@
I_i
@)@</small>.
and
<a href="mulcov_table.htm#mulcov_type" target="_top"><span style='white-space: nowrap'>mulcov_type</span></a>
 is equal to <code><font color="blue">meas_noise</font></code>.
We use <small>@(@
K_i
@)@</small> to denote the corresponding set of
<a href="mulcov_table.htm#covariate_id" target="_top"><span style='white-space: nowrap'>covariate_id</span></a>
 values for
which this is the case.

<br>
<br>
<big><a name="Measurement Noise Covariates.gamma_j" id="Measurement Noise Covariates.gamma_j">gamma_j</a></big>
<br>
For each covariate index <small>@(@
j \in K_i
@)@</small> ,
we use <small>@(@
\gamma_j (a, t)
@)@</small> to denote the
piecewise linear function corresponding to the
<a href="model_variables.htm#Fixed Effects, theta.Covariate Multipliers" target="_top"><span style='white-space: nowrap'>covariate&nbsp;multiplier</span></a>

variables for the corresponding
<a href="mulcov_table.htm#mulcov_id" target="_top"><span style='white-space: nowrap'>mulcov_id</span></a>
.
Note that these are only
<a href="mulcov_table.htm#mulcov_type.meas_noise" target="_top"><span style='white-space: nowrap'>meas_noise</span></a>
 covariate multipliers.

<br>
<br>
<b><big><a name="Effects, u, theta" id="Effects, u, theta">Effects, u, theta</a></big></b>
<br>
We use <small>@(@
u
@)@</small> and <small>@(@
\theta
@)@</small> to denote the vector of
<a href="model_variables.htm#Random Effects, u" target="_top"><span style='white-space: nowrap'>random&nbsp;effects</span></a>
 and
<a href="model_variables.htm#Fixed Effects, theta" target="_top"><span style='white-space: nowrap'>fixed&nbsp;effects</span></a>
 respectively.
There is a different random effects vector <small>@(@
u
@)@</small> for each child.
The 
<code><i><font color="black"><span style='white-space: nowrap'>node_id</span></font></i></code>
 for each data point determines the random effects for
<a href="data_table.htm#node_id.Child Data Random Effects" target="_top"><span style='white-space: nowrap'>child&nbsp;data</span></a>
.
Note that there are no random effects for
<a href="data_table.htm#node_id.Parent Data Random Effects" target="_top"><span style='white-space: nowrap'>parent&nbsp;data</span></a>
.
This corresponds to <small>@(@
u = 0
@)@</small>.

<br>
<br>
<b><big><a name="Average Integrand" id="Average Integrand">Average Integrand</a></big></b>
<br>
Let <small>@(@
A_i ( u , \theta )
@)@</small> denote the
<a href="avg_integrand.htm#Average Integrand, A_i" target="_top"><span style='white-space: nowrap'>average&nbsp;integrand</span></a>
 for this

<code><i><font color="black"><span style='white-space: nowrap'>data_id</span></font></i></code>
.

<br>
<br>
<b><big><a name="Average Noise Effect" id="Average Noise Effect">Average Noise Effect</a></big></b>
<br>
We define the average noise effect by
<small>@[@

E_i ( \theta )
=
\frac{1}{\bar{w}_i}
	\int_{a(i)}^{b(i)}  \int_{s(i)}^{t(i)}
	\left(
		\sum_{j \in K_i} x_{i,j} \gamma_j (a, t)
	\right)
	w_i (a,t) \; \B{d} t \; \B{d} a

@]@</small>

<br>
<br>
<b><big><a name="Adjusted Standard Deviation, delta_i" id="Adjusted Standard Deviation, delta_i">Adjusted Standard Deviation, delta_i</a></big></b>
<br>
For <small>@(@
j \in K_i
@)@</small> it should hold that
<small>@(@
0 \leq x_{i,j}
@)@</small>, and
<small>@(@
0 \leq \gamma_j (a, t)
@)@</small>
so that <small>@(@
\Delta_i
@)@</small> is less than or equal <small>@(@
\delta_i ( \theta )
@)@</small>
defined below:

<br>
<br>
<big><a name="Adjusted Standard Deviation, delta_i.Scaling" id="Adjusted Standard Deviation, delta_i.Scaling">Scaling</a></big>
<br>
For some cases below, <small>@(@
E_i ( \theta )
@)@</small> multiplies
<a href="data_like.htm#Data Table Notation.Delta_i" target="_top"><span style='white-space: nowrap'>Delta_i</span></a>

instead of multiplying <small>@(@
y_i
@)@</small>.
This avoids have no effect when <small>@(@
y_i
@)@</small> is zero.
It is also possible to scale <small>@(@
E_i ( \theta )
@)@</small>
by any factor one chooses by changing the value of the covariates
<small>@(@
x_{ij}
@)@</small>; see the definition of <small>@(@
E_i ( \theta )
@)@</small> above.

<br>
<br>
<big><a name="Adjusted Standard Deviation, delta_i.Add Variance or Standard Deviation" id="Adjusted Standard Deviation, delta_i.Add Variance or Standard Deviation">Add Variance or Standard Deviation</a></big>
<br>
Adding standard deviations requires fewer
floating point operations (for every data point)
but this is not expected to be significant.
In addition, if the covariate value is one, the covariate multipliers
have the same units as the data.
On the other hand, an initial value of zero does not work well
in this case because the derivative of the object with respect to the
multiplier is zero.
Adding variances does not have this problem,
but when the covariate value is one, the covariate multipliers
have data squared units.

<br>
<br>
<big><a name="Adjusted Standard Deviation, delta_i.add_std_scale_all" id="Adjusted Standard Deviation, delta_i.add_std_scale_all">add_std_scale_all</a></big>
<br>
If <a href="option_table.htm#meas_noise_effect" target="_top"><span style='white-space: nowrap'>meas_noise_effect</span></a>
 is
<code><font color="blue">add_std_scale_all</font></code> (add standard deviations and scale all cases)
the adjusted standard deviation is
<small>@[@

\delta_i ( \theta ) = \Delta_i [ 1 + E_i (\theta) ]

@]@</small>

<br>
<br>
<big><a name="Adjusted Standard Deviation, delta_i.add_std_scale_log" id="Adjusted Standard Deviation, delta_i.add_std_scale_log">add_std_scale_log</a></big>
<br>
If <a href="option_table.htm#meas_noise_effect" target="_top"><span style='white-space: nowrap'>meas_noise_effect</span></a>
 is
<code><font color="blue">add_std_scale_log</font></code>
(add standard deviations and only scale log density cases)
the adjusted standard deviation is
<small>@[@

\delta_i ( \theta ) = \Delta_i [ 1 + E_i (\theta) ]

@]@</small>
for the log density cases. Otherwise it is
<small>@[@

\delta_i ( \theta ) = \Delta_i + E_i (\theta)

@]@</small>

<br>
<br>
<big><a name="Adjusted Standard Deviation, delta_i.add_var_scale_all" id="Adjusted Standard Deviation, delta_i.add_var_scale_all">add_var_scale_all</a></big>
<br>
If <a href="option_table.htm#meas_noise_effect" target="_top"><span style='white-space: nowrap'>meas_noise_effect</span></a>
 is
<code><font color="blue">add_var_scale_all</font></code> (add variances and scale all cases)
the adjusted standard deviation is
<small>@[@

\delta_i ( \theta ) = \Delta_i \sqrt{ 1 + E_i (\theta) }

@]@</small>

<br>
<br>
<big><a name="Adjusted Standard Deviation, delta_i.add_var_scale_log" id="Adjusted Standard Deviation, delta_i.add_var_scale_log">add_var_scale_log</a></big>
<br>
If <a href="option_table.htm#meas_noise_effect" target="_top"><span style='white-space: nowrap'>meas_noise_effect</span></a>
 is
<code><font color="blue">add_var_scale_log</font></code>
(add variances and only scale log density cases)
the adjusted standard deviation is
<small>@[@

\delta_i ( \theta ) = \Delta_i \sqrt{ 1 + E_i (\theta) }

@]@</small>
for the log density cases. Otherwise it is
<small>@[@

\delta_i ( \theta ) = \sqrt{ \Delta_i^2 + E_i (\theta) }

@]@</small>


<br>
<br>
<b><big><a name="Weighted Residual and Likelihood" id="Weighted Residual and Likelihood">Weighted Residual and Likelihood</a></big></b>
<br>
Given the random effects <small>@(@
u
@)@</small> and the fixed effects <small>@(@
\theta
@)@</small>,
we use the
<a href="statistic.htm#Weighted Residual Function, R.Reversed Residual" target="_top"><span style='white-space: nowrap'>reversed&nbsp;residual</span></a>

<small>@[@

- R [
	A_i ( u, \theta )    \W{,}
	y_i                  \W{,}
	\delta_i ( \theta )  \W{,}
	d_i
]

@]@</small>
Note that <small>@(@
y_i
@)@</small> (<small>@(@
\mu
@)@</small>) here is plays the role of
<small>@(@
\mu
@)@</small> (<small>@(@
y
@)@</small>) in the function
<small>@(@
R(y, \mu , \delta , d)
@)@</small>.
This is so that
<a href="statistic.htm#Log-Transformed Standard Deviation, sigma" target="_top"><span style='white-space: nowrap'>sigma</span></a>

does not depend on the <a href="model_variables.htm" target="_top"><span style='white-space: nowrap'>model_variables</span></a>
.
Also note the negative sign in front of the weighted residual is so that
it has the same sign as <small>@(@
y_i - A_i ( u, \theta )
@)@</small>
(data minus model).
The likelihood is
<small>@[@

\B{p}( y_i | u , \theta )
=
\exp \left( D [
	A_i ( u, \theta )    \W{,}
	y_i                  \W{,}
	\delta_i ( \theta )  \W{,}
	d_i
] \right)

@]@</small>
see the log-density function
<a href="statistic.htm#Log-Density Function, D" target="_top"><span style='white-space: nowrap'>D</span></a>
.



<hr>Input File: omh/model/data_like.omh

</body>
</html>
