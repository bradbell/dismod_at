<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>The Fit Command</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="The Fit Command">
<meta name="keywords" id="keywords" content=" the fit command syntax database variables fixed random both simulate_index data_sim_table prior_sim_table warm_start ipopt_info_table fit_var_table fit_data_subset_table trace_fixed mixed_info effects convergence problems ipopt options example ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_fit_command_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://bradbell.github.io/dismod_at" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Location-&gt;</option>
<option>dismod_at</option>
<option>command</option>
<option>fit_command</option>
</select>
</td>
<td>
<select onchange='choose_across0(this)'>
<option>Search-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td><a href="depend_command.py.htm" target="_top">Prev</a>
</td><td><a href="fit_command.py.htm" target="_top">Next</a>
</td><td>
<script type='text/javascript' language='JavaScript' src='_childtable_dismod_at_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_command_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_fit_command_htm.js'></script>
</td>
</tr></table><br>
@(@\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@<center><b><big><big>The Fit Command</big></big></b></center>

<br><a href="fit_command.htm#Syntax" target="_top">Syntax</a>
<br><a href="fit_command.htm#database" target="_top">database</a>
<br><a href="fit_command.htm#variables" target="_top">variables</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="fit_command.htm#variables.fixed" target="_top">fixed</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="fit_command.htm#variables.random" target="_top">random</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="fit_command.htm#variables.both" target="_top">both</a>
<br><a href="fit_command.htm#simulate_index" target="_top">simulate_index</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="fit_command.htm#simulate_index.data_sim_table" target="_top">data_sim_table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="fit_command.htm#simulate_index.prior_sim_table" target="_top">prior_sim_table</a>
<br><a href="fit_command.htm#warm_start" target="_top">warm_start</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="fit_command.htm#warm_start.ipopt_info_table" target="_top">ipopt_info_table</a>
<br><a href="fit_command.htm#fit_var_table" target="_top">fit_var_table</a>
<br><a href="fit_command.htm#fit_data_subset_table" target="_top">fit_data_subset_table</a>
<br><a href="fit_command.htm#trace_fixed" target="_top">trace_fixed</a>
<br><a href="fit_command.htm#mixed_info" target="_top">mixed_info</a>
<br><a href="fit_command.htm#Random Effects" target="_top">Random&nbsp;Effects</a>
<br><a href="fit_command.htm#Convergence Problems" target="_top">Convergence&nbsp;Problems</a>
<br><a href="fit_command.htm#Ipopt Options" target="_top">Ipopt&nbsp;Options</a>
<br><a href="fit_command.htm#Example" target="_top">Example</a>
<br><br>
<b><big><a name="Syntax" id="Syntax">Syntax</a></big></b>

<br>

<code><font color="blue"><span style='white-space: nowrap'>dismod_at&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>database</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;fit&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>

<code><font color="blue"><span style='white-space: nowrap'>dismod_at&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>database</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;fit&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>

<code><font color="blue"><span style='white-space: nowrap'>dismod_at&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>database</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;fit&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;warm_start<br>
</span></font></code>

<code><font color="blue"><span style='white-space: nowrap'>dismod_at&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>database</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;fit&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;warm_start<br>
</span></font></code>
<br>
<b><big><a name="database" id="database">database</a></big></b>
<br>
Is an
<a href="http://www.sqlite.org/sqlite/" target="_top"><span style='white-space: nowrap'>http://www.sqlite.org/sqlite/</span></a>
 database containing the
<code><font color="blue">dismod_at</font></code> <a href="input.htm" target="_top"><span style='white-space: nowrap'>input</span></a>
 tables which are not modified.

<br>
<br>
<b><big><a name="variables" id="variables">variables</a></big></b>
<br>
This argument is <code><font color="blue">fixed</font></code>, <code><font color="blue">random</font></code> or <code><font color="blue">both</font></code>.
If it is <code><font color="blue">fixed</font></code> (<code><font color="blue">random</font></code>)
only the fixed effects (random effects) are optimized.
If it is <code><font color="blue">both</font></code>, both the fixed and random effects
are optimized.

<br>
<br>
<big><a name="variables.fixed" id="variables.fixed">fixed</a></big>
<br>
This option optimizes the fixed effects with the
random effects corresponding to
<a href="rate_table.htm#Child Value Priors.Constant" target="_top"><span style='white-space: nowrap'>constant&nbsp;child&nbsp;value&nbsp;priors</span></a>

at their constrained values and the other random effects
constrained to be zero.
(This is equivalent to fitting with
<a href="option_table.htm#Random Only.bound_random" target="_top"><span style='white-space: nowrap'>bound_random</span></a>
 equal to zero.)
This is useful when one uses fitting with no random effects as
a starting point for fitting with random effects; see
<a href="set_command.htm" target="_top"><span style='white-space: nowrap'>set_command</span></a>
,
<a href="start_var_table.htm" target="_top"><span style='white-space: nowrap'>start_var_table</span></a>
, and
<a href="user_fit_fixed_both.py.htm" target="_top"><span style='white-space: nowrap'>fit_fixed_both.py</span></a>
.
This enables one to see the different between the two
fits in the <a href="log_table.htm" target="_top"><span style='white-space: nowrap'>log_table</span></a>

(as apposed to changing
<a href="option_table.htm#Random Only.bound_random" target="_top"><span style='white-space: nowrap'>bound_random</span></a>

in the <code><font color="blue">option</font></code> table).

<br>
<br>
<big><a name="variables.random" id="variables.random">random</a></big>
<br>
This optimizes the random effects with
the fixed effects set to their starting values; see
<a href="start_var_table.htm" target="_top"><span style='white-space: nowrap'>start_var_table</span></a>
.

<br>
<br>
<big><a name="variables.both" id="variables.both">both</a></big>
<br>
This option fits both the
<a href="model_variables.htm#Fixed Effects, theta" target="_top"><span style='white-space: nowrap'>fixed</span></a>
 and
<a href="model_variables.htm#Random Effects, u" target="_top"><span style='white-space: nowrap'>random</span></a>
 effects.

<br>
<br>
<b><big><a name="simulate_index" id="simulate_index">simulate_index</a></big></b>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
 is present, it must be less than
<a href="simulate_command.htm#number_simulate" target="_top"><span style='white-space: nowrap'>number_simulate</span></a>
.

<br>
<br>
<big><a name="simulate_index.data_sim_table" id="simulate_index.data_sim_table">data_sim_table</a></big>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
 is present, this is an extra input table.
The <a href="data_sim_table.htm#data_sim_value" target="_top"><span style='white-space: nowrap'>data_sim_value</span></a>
 entries,
corresponding to 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
,
are used in place of the data table
<a href="data_table.htm#meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>
 entries.
All the rest of the data table values
are the same as when 
<code><i><font color="black"><span style='white-space: nowrap'>simulated_index</span></font></i></code>
 is not present; e.g.,
<a href="data_table.htm#meas_std" target="_top"><span style='white-space: nowrap'>meas_std</span></a>
 comes from the data table.

<br>
<br>
<big><a name="simulate_index.prior_sim_table" id="simulate_index.prior_sim_table">prior_sim_table</a></big>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
 is present, this is an extra input table.
The <a href="prior_sim_table.htm#prior_sim_value" target="_top"><span style='white-space: nowrap'>prior_sim_value</span></a>
 entries,
corresponding to 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
,
are used in place of the prior table
<a href="prior_table.htm#mean" target="_top"><span style='white-space: nowrap'>mean</span></a>
 entries.
All the rest of the prior table values
are the same as when 
<code><i><font color="black"><span style='white-space: nowrap'>simulated_index</span></font></i></code>
 is not present; e.g.,
<a href="prior_table.htm#std" target="_top"><span style='white-space: nowrap'>std</span></a>
 comes from the prior table.

<br>
<br>
<b><big><a name="warm_start" id="warm_start">warm_start</a></big></b>
<br>
If <code><font color="blue">warm_start</font></code> is at the end of the command,
the ipopt_info table, written by the previous fit,
is used to start the optimization of the fixed effects
where the previous fit left off.
This is intended to be used in the following cases:
<ol type="1"><li>
Termination of previous fit is due to reaching
<a href="option_table.htm#Fixed and Random.max_num_iter" target="_top"><span style='white-space: nowrap'>max_num_iter_fixed</span></a>
.
</li><li>

The
<a href="option_table.htm#Fixed and Random.tolerance" target="_top"><span style='white-space: nowrap'>tolerance</span></a>
 for the
fixed or random effects been changed.
</li></ol>

Other options besides those listed above,
should be the same as for the previous fit.

<br>
<br>
<big><a name="warm_start.ipopt_info_table" id="warm_start.ipopt_info_table">ipopt_info_table</a></big>
<br>
The fixed effect are optimized when

<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 is equal to <code><font color="blue">both</font></code> or <code><font color="blue">fixed</font></code>.
In the case a new <code><font color="blue">ipopt_info</font></code> table, corresponding to the final
fit for the fixed effects, is written to the ipopt_info table.
The contents of this table are unspecified; i.e., not part of the
dismod_at API and my change.

<br>
<br>
<b><big><a name="fit_var_table" id="fit_var_table">fit_var_table</a></big></b>
<br>
A new <a href="fit_var_table.htm" target="_top"><span style='white-space: nowrap'>fit_var_table</span></a>
 is created each time this command is run.
It contains the results of the fit in its
<a href="fit_var_table.htm#fit_var_value" target="_top"><span style='white-space: nowrap'>fit_var_value</span></a>
 column.

<br>
<br>
<b><big><a name="fit_data_subset_table" id="fit_data_subset_table">fit_data_subset_table</a></big></b>
<br>
A new <a href="fit_data_subset_table.htm" target="_top"><span style='white-space: nowrap'>fit_data_subset_table</span></a>
 is created each time this command is run.
It is a comparison of the model and data corresponding to the fit results.

<br>
<br>
<b><big><a name="trace_fixed" id="trace_fixed">trace_fixed</a></big></b>
<br>
A new <a href="trace_fixed_table.htm" target="_top"><span style='white-space: nowrap'>trace_fixed_table</span></a>
 is created each time a
<code><font color="blue">fit fixed</font></code> or <code><font color="blue">fit both</font></code> command is run.
It contains a trace of the corresponding optimization.

<br>
<br>
<b><big><a name="mixed_info" id="mixed_info">mixed_info</a></big></b>
<br>
A new <code><font color="blue">mixed_info</font></code> table is created each time this command is run.
It contains unspecified information about the size of the
<a href="install_unix.htm#Special Requirements.cppad_mixed" target="_top"><span style='white-space: nowrap'>cppad_mixed</span></a>

objects used to represent the objective function and its derivatives.
This table is useful for seeing how the problem setup affects the
size (and hence time) of the problem.
For example, how different the size is when one uses
a <a href="hold_out_command.htm" target="_top"><span style='white-space: nowrap'>hold_out_command</span></a>
 to sub-sample the data.

<br>
<br>
<b><big><a name="Random Effects" id="Random Effects">Random Effects</a></big></b>
<br>
A model has random effects if one of the
<a href="rate_table.htm#child_smooth_id" target="_top"><span style='white-space: nowrap'>child_smooth_id</span></a>
 or
<a href="rate_table.htm#child_nslist_id" target="_top"><span style='white-space: nowrap'>child_nslist_id</span></a>
 is not <code><font color="blue">null</font></code>.
In some cases it helps to
first fit with 
<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 equal to <code><font color="blue">fixed</font></code>
and then fit with 
<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 equal to <code><font color="blue">both</font></code>.

<br>
<br>
<b><big><a name="Convergence Problems" id="Convergence Problems">Convergence Problems</a></big></b>
<br>
The derivative of the fixed effects objective,
at the prior mean for the fixed effects,
is used to scale the fixed effects objective.
If the optimal value for a fixed effect is equal to its prior mean,
its partial derivative at the prior mean is often near zero.
Near zero derivatives, at the prior mean, cause the scaling to be unstable
and result in convergence problems.
You may be able to fix this
by using a uniform distribution, and a different prior mean,
for a fixed effect that does not change.
If this does not work, the data will not determine that fixed effect
and you may have to constrain it to have the value you want.

<br>
<br>
<b><big><a name="Ipopt Options" id="Ipopt Options">Ipopt Options</a></big></b>
<br>
Some of the options in the <a href="option_table.htm" target="_top"><span style='white-space: nowrap'>option_table</span></a>
 are for controlling
<a href="https://coin-or.github.io/Ipopt/OPTIONS.html" target="_top"><span style='white-space: nowrap'>Ipopt</span></a>
.
You can override these options, or set other options, using a file called
<code><font color="blue">ipopt.opt</font></code> in the directory where a fit command is run.
Doing so not supported because <code><font color="blue">dismod_at</font></code>
expects certain options to be set a certain way.
The set of such options that is not specified and may change with time.


<br>
<br>
<b><big><a name="Example" id="Example">Example</a></big></b>
<br>
The file <a href="fit_command.py.htm" target="_top"><span style='white-space: nowrap'>fit_command.py</span></a>
 contains an example and test
using this command.


<hr>Input File: devel/cmd/fit_command.cpp

</body>
</html>
