<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>An Example Fitting Simulated Diabetes Data</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="An Example Fitting Simulated Diabetes Data">
<meta name="keywords" id="keywords" content=" example fitting simulated diabetes data under construction node table age time omega integrand weight grid covariate multiplier rate value measurement standard deviations truth predict problem parameters age_grid time_grid fit_with_nose_in_data noise_cv node_list ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_user_diabetes.py_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://github.com/bradbell/dismod_at" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td><a href="user_continue_fit.py.htm" target="_top">Prev</a>
</td><td><a href="user_diff_constraint.py.htm" target="_top">Next</a>
</td><td>
<select onchange='choose_across0(this)'>
<option>Index-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Up-&gt;</option>
<option>dismod_at</option>
<option>user</option>
<option>user_diabetes.py</option>
</select>
</td>
<td>
<select onchange='choose_down2(this)'>
<option>dismod_at-&gt;</option>
<option>install_unix</option>
<option>get_started</option>
<option>user</option>
<option>database</option>
<option>model</option>
<option>command</option>
<option>python</option>
<option>devel</option>
<option>whats_new_2018</option>
<option>wish_list</option>
</select>
</td>
<td>
<select onchange='choose_down1(this)'>
<option>user-&gt;</option>
<option>user_asymptotic.py</option>
<option>user_const_random.py</option>
<option>user_const_value.py</option>
<option>user_continue_fit.py</option>
<option>user_diabetes.py</option>
<option>user_diff_constraint.py</option>
<option>user_fit_fixed.py</option>
<option>user_fit_random.py</option>
<option>user_fit_sim.py</option>
<option>user_jump_at_age.py</option>
<option>user_lasso_covariate.py</option>
<option>user_meas_covariate.py</option>
<option>user_no_children.py</option>
<option>user_predict_fit.py</option>
<option>user_zero_sum_random.py</option>
<option>user_re_scale.py</option>
<option>user_speed.py</option>
<option>user_students.py</option>
</select>
</td>
<td>user_diabetes.py</td>
<td>
<select onchange='choose_current0(this)'>
<option>Headings-&gt;</option>
<option>Under Construction</option>
<option>Node Table</option>
<option>Age Table</option>
<option>Time Table</option>
<option>omega</option>
<option>Integrand Table</option>
<option>Weight Table and Grid</option>
<option>Covariate Table</option>
<option>Covariate Multiplier Table</option>
<option>---..Rate Value</option>
<option>---..Measurement Value</option>
<option>---..Measurement Standard Deviations</option>
<option>Truth</option>
<option>Predict</option>
<option>Problem Parameters</option>
<option>---..age_grid</option>
<option>---..time_grid</option>
<option>---..fit_with_nose_in_data</option>
<option>---..noise_cv</option>
<option>---..node_list</option>
</select>
</td>
</tr></table><br>
@(@\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@<center><b><big><big>An Example Fitting Simulated Diabetes Data</big></big></b></center>
<br>
<b><big><a name="Under Construction" id="Under Construction">Under Construction</a></big></b>
<br>
This example is under construction.

<br>
<br>
<b><big><a name="Node Table" id="Node Table">Node Table</a></big></b>
<br>
The <a href="node_table.htm" target="_top"><span style='white-space: nowrap'>node_table</span></a>
 only contains the
<a href="node_table.htm#parent" target="_top"><span style='white-space: nowrap'>parent</span></a>
 and child nodes specified by
the <code><font color="blue">node_list</font></code>.

<br>
<br>
<b><big><a name="Age Table" id="Age Table">Age Table</a></big></b>
<br>
The <a href="age_table.htm" target="_top"><span style='white-space: nowrap'>age_table</span></a>
 is uniformly spaced starting at age zero,
ending at age 100.

<br>
<br>
<b><big><a name="Time Table" id="Time Table">Time Table</a></big></b>
<br>
The <a href="time_table.htm" target="_top"><span style='white-space: nowrap'>time_table</span></a>
 is uniformly spaced starting at time 1990
and ending at time 2020.

<br>
<br>
<b><big><a name="omega" id="omega">omega</a></big></b>
<br>
We constrain <a href="rate_table.htm#rate_name.omega" target="_top"><span style='white-space: nowrap'>omega</span></a>
 to have
the value used during simulation of the data.

<br>
<br>
<b><big><a name="Integrand Table" id="Integrand Table">Integrand Table</a></big></b>
<br>
The <a href="integrand_table.htm" target="_top"><span style='white-space: nowrap'>integrand_table</span></a>
 just contains mtspecific and prevalence.
We constrain omega to a specific value.
We think of
<a href="avg_integrand.htm#I_i(a,t).mtspecific" target="_top"><span style='white-space: nowrap'>mtspecific</span></a>

as informing <a href="rate_table.htm#rate_name.chi" target="_top"><span style='white-space: nowrap'>chi</span></a>
,
<a href="avg_integrand.htm#I_i(a,t).prevalence" target="_top"><span style='white-space: nowrap'>prevalence</span></a>

as informing <a href="rate_table.htm#rate_name.iota" target="_top"><span style='white-space: nowrap'>iota</span></a>
, and
<a href="avg_integrand.htm#I_i(a,t).prevalence" target="_top"><span style='white-space: nowrap'>prevalence</span></a>
 at age zero
as informing <a href="rate_table.htm#rate_name.pini" target="_top"><span style='white-space: nowrap'>pini</span></a>
.
We assume that <a href="rate_table.htm#rate_name.rho" target="_top"><span style='white-space: nowrap'>rho</span></a>
 is zero.

<br>
<br>
<b><big><a name="Weight Table and Grid" id="Weight Table and Grid">Weight Table and Grid</a></big></b>
<br>
There is one weighting, with the constant value one,
in the <a href="weight_table.htm" target="_top"><span style='white-space: nowrap'>weight_table</span></a>
 and <a href="weight_grid_table.htm" target="_top"><span style='white-space: nowrap'>weight_grid_table</span></a>
.

<br>
<br>
<b><big><a name="Covariate Table" id="Covariate Table">Covariate Table</a></big></b>
<br>
The following information is placed in the <a href="covariate_table.htm" target="_top"><span style='white-space: nowrap'>covariate_table</span></a>

<table><tr><td align='left'  valign='top'>

Name </td><td align='left'  valign='top'>
 Description </td><td align='left'  valign='top'>
 reference  </td><td align='left'  valign='top'>
 max_difference </td></tr><tr><td align='left'  valign='top'>

one     </td><td align='left'  valign='top'>
 constant value = 1        </td><td align='left'  valign='top'>
 0     </td><td align='left'  valign='top'>
 null </td></tr><tr><td align='left'  valign='top'>

sex     </td><td align='left'  valign='top'>
 .5=male -.5=female        </td><td align='left'  valign='top'>
 0     </td><td align='left'  valign='top'>
 0.6  </td></tr><tr><td align='left'  valign='top'>

BMI     </td><td align='left'  valign='top'>
 body mass index           </td><td align='left'  valign='top'>
 27    </td><td align='left'  valign='top'>
 null </td></tr><tr><td align='left'  valign='top'>

MS_2000 </td><td align='left'  valign='top'>
 market scan data for 2000 </td><td align='left'  valign='top'>
 0     </td><td align='left'  valign='top'>
 null </td></tr><tr><td align='left'  valign='top'>

MS_2010 </td><td align='left'  valign='top'>
 market scan data for 2010 </td><td align='left'  valign='top'>
 0     </td><td align='left'  valign='top'>
 null </td></tr><tr><td align='left'  valign='top'>

MS_2015 </td><td align='left'  valign='top'>
 market scan data for 2015 </td><td align='left'  valign='top'>
 0     </td><td align='left'  valign='top'>
 null
</td></tr>
</table>
(This information is not yet used.)

<br>
<br>
<b><big><a name="Covariate Multiplier Table" id="Covariate Multiplier Table">Covariate Multiplier Table</a></big></b>
<br>
All of the covariate multipliers use that same smoothing which corresponds
to a constant in age and time. The value is a Gaussian with mean zero
and variable one.
(The covariates multipliers are currently set to zero.)

<br>
<br>
<b><a name="Covariate Multiplier Table.Rate Value" id="Covariate Multiplier Table.Rate Value">Rate Value</a></b>
<br>
There are two rate value covariate multipliers,
<a href="avg_integrand.htm#Rate Functions.alpha_jk" target="_top"><span style='white-space: nowrap'>alpha_jk</span></a>

that are used to adjust
<a href="rate_table.htm#rate_name.iota" target="_top"><span style='white-space: nowrap'>iota</span></a>
.
A separate multiplier is applied to the covariates
<code><font color="blue">sex</font></code> and <code><font color="blue">BMI</font></code>.

<br>
<br>
<b><a name="Covariate Multiplier Table.Measurement Value" id="Covariate Multiplier Table.Measurement Value">Measurement Value</a></b>
<br>
There are three measurement value covariate multipliers
<a href="avg_integrand.htm#Measurement Value Covariates.beta_j" target="_top"><span style='white-space: nowrap'>beta_j</span></a>

that is used to adjust the prevalence measurements.
A separate multiplier is applied to the covariates
<code><font color="blue">MS_2000</font></code>, <code><font color="blue">MS_2010</font></code> and <code><font color="blue">MS_2015</font></code>.

<br>
<br>
<b><a name="Covariate Multiplier Table.Measurement Standard Deviations" id="Covariate Multiplier Table.Measurement Standard Deviations">Measurement Standard Deviations</a></b>
<br>
There is one measurement standard deviation covariate multiplier
<a href="data_like.htm#Measurement Standard Deviation Covariates.gamma_j" target="_top"><span style='white-space: nowrap'>gamma_j</span></a>

that is for prevalence measurements and multiplies the <code><font color="blue">one</font></code> covariate.

<br>
<br>
<b><big><a name="Truth" id="Truth">Truth</a></big></b>
<br>
The start_age is 0, The end_age is 100,
the start_time is 1990, and the end_time is 2020.
The values in the <a href="truth_var_table.htm" target="_top"><span style='white-space: nowrap'>truth_var_table</span></a>
 are generated using bilinear
interpolation of the log of the specified values at
(start_age, start_time),
(start_age, end_time),
(end_age, start_time)
and (end_age, end_time).

<br>
<br>
<b><big><a name="Predict" id="Predict">Predict</a></big></b>
<br>
The <a href="predict_command.htm" target="_top"><span style='white-space: nowrap'>predict_command</span></a>
 is used to compute the
<a href="predict_table.htm#avg_integrand" target="_top"><span style='white-space: nowrap'>avg_integrand</span></a>
 corresponding to the
true values for the variables.
This is then used to create a version of the <a href="data_table.htm" target="_top"><span style='white-space: nowrap'>data_table</span></a>

with no noise, but modeled with a standard deviation corresponding
to a coefficient of variation.

<br>
<br>
<b><big><a name="Problem Parameters" id="Problem Parameters">Problem Parameters</a></big></b>


<br>
<br>
<b><a name="Problem Parameters.age_grid" id="Problem Parameters.age_grid">age_grid</a></b>
<br>
This sets the start age, end age, and number of age grid points.
The interval between age grid points is the end age, minus the start age,
divided by the number of grid points minus one.
<pre style='display:inline'><tt>
age_grid  <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'start'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>    <font color="#FF0000">'end'</font><font color="#990000">:</font> <font color="#993399">100</font><font color="#990000">,</font>  <font color="#FF0000">'number'</font><font color="#990000">:</font> <font color="#993399">9</font>  <font color="#990000">}</font>
</tt></pre>
<br>
<b><a name="Problem Parameters.time_grid" id="Problem Parameters.time_grid">time_grid</a></b>
<br>
This sets the start time, end time, and number of time grid points.
The interval between time grid points is the end time, minus the start time,
divided by the number of grid points minus one.
<pre style='display:inline'><tt>
time_grid <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'start'</font><font color="#990000">:</font><font color="#993399">1990.0</font><font color="#990000">,</font> <font color="#FF0000">'end'</font><font color="#990000">:</font> <font color="#993399">2020</font><font color="#990000">,</font> <font color="#FF0000">'number'</font><font color="#990000">:</font> <font color="#993399">2</font>  <font color="#990000">}</font>
</tt></pre>
<br>
<b><a name="Problem Parameters.fit_with_nose_in_data" id="Problem Parameters.fit_with_nose_in_data">fit_with_nose_in_data</a></b>
<br>
If this variable is true, simulated measurements with noise are used
for the fit. Otherwise, the model value for the
<a href="avg_integrand.htm" target="_top"><span style='white-space: nowrap'>avg_integrand</span></a>
 is used, without noise, for each data point.
(The measurements, without noise, are stored in
<a href="data_table.htm#meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>
).
<pre style='display:inline'><tt>
fit_with_noise_in_data <font color="#990000">=</font> True
</tt></pre>
<br>
<b><a name="Problem Parameters.noise_cv" id="Problem Parameters.noise_cv">noise_cv</a></b>
<br>
For each measurement without noise, the corresponding
<a href="data_table.htm#meas_std" target="_top"><span style='white-space: nowrap'>meas_std</span></a>
 is computed as

<code><font color="blue"><span style='white-space: nowrap'>meas_std</span></font><i><font color="black"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font></i><font color="blue"><span style='white-space: nowrap'>noise_cv</span></font><i><font color="black"><span style='white-space: nowrap'>&nbsp;*&nbsp;</span></font></i><font color="blue"><span style='white-space: nowrap'>meas_value</span></font></code>
.
<pre style='display:inline'><tt>
noise_cv <font color="#990000">=</font> <font color="#993399">0.1</font>
</tt></pre>
<br>
<b><a name="Problem Parameters.node_list" id="Problem Parameters.node_list">node_list</a></b>
<br>
The first element of this list is the parent node,
the others are the child nodes. There must be an even number of children;
i.e., an odd number of elements in this list.
<pre style='display:inline'><tt>
node_list <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'US'</font><font color="#990000">,</font> <font color="#FF0000">'Alabama'</font><font color="#990000">,</font> <font color="#FF0000">'California'</font><font color="#990000">,</font> <font color="#FF0000">'Massachusetts'</font><font color="#990000">,</font> <font color="#FF0000">'Wisconsin'</font> <font color="#990000">]</font>
</tt></pre>
<code><font color="blue"><pre><tt><i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#000080">import</font></b> sys
<b><font color="#000080">import</font></b> os
<b><font color="#000080">import</font></b> distutils<font color="#990000">.</font>dir_util
<b><font color="#000080">import</font></b> subprocess
<b><font color="#000080">import</font></b> copy
<b><font color="#000080">import</font></b> math
test_program <font color="#990000">=</font> <font color="#FF0000">'example/user/diabetes.py'</font>
<b><font color="#0000FF">if</font></b> sys<font color="#990000">.</font>argv<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">!=</font> test_program  <b><font color="#0000FF">or</font></b> <b><font color="#000000">len</font></b><font color="#990000">(</font>sys<font color="#990000">.</font>argv<font color="#990000">)</font> <font color="#990000">!=</font> <font color="#993399">1</font> <font color="#990000">:</font>
     usage  <font color="#990000">=</font> <font color="#FF0000">'python3 '</font> <font color="#990000">+</font> test_program <font color="#990000">+</font> <font color="#FF0000">'\n'</font>
     usage <font color="#990000">+=</font> <font color="#FF0000">'where python3 is the python 3 program on your system\n'</font>
     usage <font color="#990000">+=</font> <font color="#FF0000">'and working directory is the dismod_at distribution directory\n'</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font>usage<font color="#990000">)</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font>test_program<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># import dismod_at</font></i>
local_dir <font color="#990000">=</font> os<font color="#990000">.</font><b><font color="#000000">getcwd</font></b><font color="#990000">()</font> <font color="#990000">+</font> <font color="#FF0000">'/python'</font>
<b><font color="#0000FF">if</font></b><font color="#990000">(</font> os<font color="#990000">.</font>path<font color="#990000">.</font><b><font color="#000000">isdir</font></b><font color="#990000">(</font> local_dir <font color="#990000">+</font> <font color="#FF0000">'/dismod_at'</font> <font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font>path<font color="#990000">.</font><b><font color="#000000">insert</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> local_dir<font color="#990000">)</font>
<b><font color="#000080">import</font></b> dismod_at
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># change into the build/example/user directory</font></i>
distutils<font color="#990000">.</font>dir_util<font color="#990000">.</font><b><font color="#000000">mkpath</font></b><font color="#990000">(</font><font color="#FF0000">'build/example/user'</font><font color="#990000">)</font>
os<font color="#990000">.</font><b><font color="#000000">chdir</font></b><font color="#990000">(</font><font color="#FF0000">'build/example/user'</font><font color="#990000">)</font>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
     age_start <font color="#990000">=</font> age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># denominator</font></i>
     da  <font color="#990000">=</font> age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> age_start
     dt  <font color="#990000">=</font> time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     den <font color="#990000">=</font> da <font color="#990000">*</font> dt<font color="#990000">;</font>
     num <font color="#990000">=</font> <font color="#993399">0.0</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at start age and start time</font></i>
     da   <font color="#990000">=</font> age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> a
     dt   <font color="#990000">=</font> time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> t
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at start age and end time</font></i>
     da   <font color="#990000">=</font> age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> a
     dt   <font color="#990000">=</font> t <font color="#990000">-</font> time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at end age and start time</font></i>
     da   <font color="#990000">=</font> a <font color="#990000">-</font> age_start
     dt   <font color="#990000">=</font> time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> t
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at end age and end time</font></i>
     da   <font color="#990000">=</font> a <font color="#990000">-</font> age_start
     dt   <font color="#990000">=</font> t <font color="#990000">-</font> time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <b><font color="#0000FF">return</font></b> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(</font> num <font color="#990000">/</font> den <font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">true_rate</font></b><font color="#990000">(</font>node<font color="#990000">,</font> rate<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
     parent_node <font color="#990000">=</font> node_list<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
     <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
          even_child <font color="#990000">=</font> node_list<font color="#990000">.</font><b><font color="#000000">index</font></b><font color="#990000">(</font>node<font color="#990000">)</font> <font color="#990000">%</font> <font color="#993399">2</font> <font color="#990000">==</font> <font color="#993399">0</font>
     <i><font color="#9A1900"># default</font></i>
     grid_value <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">if</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'pini'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1e-2</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1e-2</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># pini is constant in age</font></i>
          grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font>
          grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">elif</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'iota'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1e-3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">2e-3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1e-2</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">2e-2</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">1.0</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">1.0</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">elif</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'omega'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">3e-3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">2e-3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">3e-1</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">2e-1</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">1.0</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">1.0</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">elif</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'chi'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">4.0e-3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">2.0e-3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0e-1</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">0.5e-1</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">1.0</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">1.0</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#993399">1.0</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
          <b><font color="#0000FF">assert</font></b> False
     <i><font color="#9A1900">#</font></i>
     <b><font color="#0000FF">return</font></b> ret
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">example_db</font></b> <font color="#990000">(</font>file_name<font color="#990000">)</font> <font color="#990000">:</font>
     <i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># functions used for priors in smoothing</font></i>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># weight table has constant value 1.0</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_constant_one</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#993399">1.0</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># Note that there are no forward differences for covariate multiplier grids.</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_mulcov_meas_std</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b><font color="#990000">(</font><font color="#FF0000">'prior_U(0,0)'</font><font color="#990000">,</font> None<font color="#990000">,</font> None<font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_mulcov_meas_value</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b><font color="#990000">(</font><font color="#FF0000">'prior_U(0,0)'</font><font color="#990000">,</font> None<font color="#990000">,</font> None<font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_mulcov_rate_value</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b><font color="#990000">(</font><font color="#FF0000">'prior_U(0,0)'</font><font color="#990000">,</font> None<font color="#990000">,</font> None<font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># priors used in smoothing for iota</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_iota_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_U(1e-8,1)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_time'</font><font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_iota_child</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_N(0,1)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_time'</font><font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># priors used in smoothing for chi</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_chi_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_U(1e-8,1)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_time'</font><font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_chi_child</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_N(0,1)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_time'</font><font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># use const_value to constrain omega to true value</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_omega</font></b><font color="#990000">(</font>node<font color="#990000">)</font> <font color="#990000">:</font>
          <i><font color="#9A1900"># Use default argument to bind the value of node at point of</font></i>
          <i><font color="#9A1900"># definition instead of at point of call.</font></i>
          <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_omega_node</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">,</font> node <font color="#990000">=</font> node<font color="#990000">)</font> <font color="#990000">:</font>
               true_value <font color="#990000">=</font> <b><font color="#000000">true_rate</font></b><font color="#990000">(</font>node<font color="#990000">,</font> <font color="#FF0000">'omega'</font><font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
               <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>true_value<font color="#990000">,</font> <font color="#FF0000">'prior_U(-inf,inf)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_U(-inf,inf)'</font><font color="#990000">)</font>
          <b><font color="#0000FF">return</font></b> fun_omega_node
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># priors used in smoothing for pini</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_pini_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_U(0,1)'</font><font color="#990000">,</font> None<font color="#990000">,</font> <font color="#FF0000">'prior_parent_time'</font><font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_pini_child</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_N(0,1)'</font><font color="#990000">,</font> None<font color="#990000">,</font> <font color="#FF0000">'prior_child_time'</font><font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     fun                       <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     fun<font color="#990000">[</font><font color="#FF0000">'mulcov_rate_value'</font><font color="#990000">]</font>  <font color="#990000">=</font> fun_mulcov_rate_value
     fun<font color="#990000">[</font><font color="#FF0000">'mulcov_meas_value'</font><font color="#990000">]</font>  <font color="#990000">=</font> fun_mulcov_meas_value
     fun<font color="#990000">[</font><font color="#FF0000">'mulcov_meas_std'</font><font color="#990000">]</font>    <font color="#990000">=</font> fun_mulcov_meas_std
     fun<font color="#990000">[</font><font color="#FF0000">'constant_one'</font><font color="#990000">]</font>       <font color="#990000">=</font> fun_constant_one
     fun<font color="#990000">[</font><font color="#FF0000">'iota_parent'</font><font color="#990000">]</font>        <font color="#990000">=</font> fun_iota_parent
     fun<font color="#990000">[</font><font color="#FF0000">'iota_child'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_iota_child
     fun<font color="#990000">[</font><font color="#FF0000">'chi_parent'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_chi_parent
     fun<font color="#990000">[</font><font color="#FF0000">'chi_child'</font><font color="#990000">]</font>          <font color="#990000">=</font> fun_chi_child
     fun<font color="#990000">[</font><font color="#FF0000">'pini_parent'</font><font color="#990000">]</font>        <font color="#990000">=</font> fun_pini_parent
     fun<font color="#990000">[</font><font color="#FF0000">'pini_child'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_pini_child
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     d_age <font color="#990000">=</font>  <font color="#990000">(</font> age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font>  age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">])/(</font> age_grid<font color="#990000">[</font><font color="#FF0000">'number'</font><font color="#990000">]</font> <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font>
     d_time <font color="#990000">=</font> <font color="#990000">(</font>time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">])/(</font>time_grid<font color="#990000">[</font><font color="#FF0000">'number'</font><font color="#990000">]</font> <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># nslist_table:</font></i>
     nslist_table <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># age lists</font></i>
     start                     <font color="#990000">=</font> age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     number                    <font color="#990000">=</font> age_grid<font color="#990000">[</font><font color="#FF0000">'number'</font><font color="#990000">]</font>
     age_index                 <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     age_list                  <font color="#990000">=</font> <font color="#990000">[</font> start <font color="#990000">+</font> j <font color="#990000">*</font> d_age <b><font color="#0000FF">for</font></b> j <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font> <font color="#990000">]</font>
     age_list                  <font color="#990000">=</font> <b><font color="#000000">sorted</font></b><font color="#990000">(</font> age_list <font color="#990000">)</font>
     age_index_all             <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font>
     age_index<font color="#990000">[</font><font color="#FF0000">'iota_parent'</font><font color="#990000">]</font>  <font color="#990000">=</font> age_index_all
     age_index<font color="#990000">[</font><font color="#FF0000">'chi_parent'</font><font color="#990000">]</font>   <font color="#990000">=</font> age_index_all
     age_index<font color="#990000">[</font><font color="#FF0000">'omega_parent'</font><font color="#990000">]</font> <font color="#990000">=</font> age_index_all
     age_index<font color="#990000">[</font><font color="#FF0000">'pini_parent'</font><font color="#990000">]</font>  <font color="#990000">=</font> <font color="#990000">[</font> <font color="#993399">0</font> <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     age_index<font color="#990000">[</font><font color="#FF0000">'iota_child'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">[</font> <font color="#993399">0</font><font color="#990000">,</font> number<font color="#990000">-</font><font color="#993399">1</font> <font color="#990000">]</font>
     age_index<font color="#990000">[</font><font color="#FF0000">'chi_child'</font><font color="#990000">]</font>    <font color="#990000">=</font> <font color="#990000">[</font> <font color="#993399">0</font><font color="#990000">,</font> number<font color="#990000">-</font><font color="#993399">1</font> <font color="#990000">]</font>
     age_index<font color="#990000">[</font><font color="#FF0000">'omega_child'</font><font color="#990000">]</font>  <font color="#990000">=</font> <font color="#990000">[</font> <font color="#993399">0</font><font color="#990000">,</font> number<font color="#990000">-</font><font color="#993399">1</font> <font color="#990000">]</font>
     age_index<font color="#990000">[</font><font color="#FF0000">'pini_child'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">[</font> <font color="#993399">0</font> <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># time lists</font></i>
     start                  <font color="#990000">=</font> time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     number                 <font color="#990000">=</font> time_grid<font color="#990000">[</font><font color="#FF0000">'number'</font><font color="#990000">]</font>
     time_list              <font color="#990000">=</font> <font color="#990000">[</font> start <font color="#990000">+</font> i <font color="#990000">*</font> d_time <b><font color="#0000FF">for</font></b> i <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font> <font color="#990000">]</font>
     time_index_all         <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font>
     time_index_rate_parent <font color="#990000">=</font> time_index_all
     time_index_rate_child  <font color="#990000">=</font> <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">,</font> number<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># integrand table:</font></i>
     integrand_list <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'mtspecific'</font><font color="#990000">,</font> <font color="#FF0000">'prevalence'</font> <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># node table:</font></i>
     parent_node <font color="#990000">=</font> node_list<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
     node_table <font color="#990000">=</font> <font color="#990000">[</font> <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font>parent_node<font color="#990000">,</font> <font color="#FF0000">'parent'</font><font color="#990000">:</font><font color="#FF0000">''</font> <font color="#990000">}</font> <font color="#990000">]</font>
     <b><font color="#0000FF">for</font></b> i <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>node_list<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
          node_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font>node_list<font color="#990000">[</font>i<font color="#990000">],</font> <font color="#FF0000">'parent'</font><font color="#990000">:</font>parent_node <font color="#990000">}</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># weight table and weight_grid table:</font></i>
     name    <font color="#990000">=</font> <font color="#FF0000">'weight_constant'</font>
     weight_table <font color="#990000">=</font> <font color="#990000">[</font> <font color="#990000">{</font>
          <font color="#FF0000">'name'</font><font color="#990000">:</font>      <font color="#FF0000">'weight_constant'</font><font color="#990000">,</font>
          <font color="#FF0000">'age_id'</font><font color="#990000">:</font>    <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
          <font color="#FF0000">'time_id'</font><font color="#990000">:</font>   <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
          <font color="#FF0000">'fun'</font><font color="#990000">:</font>       fun<font color="#990000">[</font><font color="#FF0000">'constant_one'</font><font color="#990000">]</font>
     <font color="#990000">}</font> <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># prior_table, smooth_table, and smooth_grid_table</font></i>
     prior_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_N(0,1)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_N(0,1)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">1.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_N_+(0,1)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_N_+(0,1)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">1.0</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">0.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_U(0,1)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_U(0,1)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.1</font><font color="#990000">,</font>     <i><font color="#9A1900"># only affects initial optimizer value</font></i>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">1.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_U(1e-8,1)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_U(1e-8,1)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.1</font><font color="#990000">,</font>     <i><font color="#9A1900"># only affects initial optimizer value</font></i>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">1e-8</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">1.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_U(0,0)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_U(0,0)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">0.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_U(-inf,inf)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_U(-inf,inf)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_U(1e-8,1e-8)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_U(1e-8,1e-8)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">1e-8</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">1e-8</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">1e-8</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_parent_age</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_parent_age'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">0.3</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_parent_time</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_parent_time'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">0.4</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_child_age</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_child_age'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">0.2</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_child_time</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_child_time'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">0.2</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># smooth table</font></i>
     smooth_table   <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># smooth_mulcov</font></i>
     <b><font color="#0000FF">for</font></b> cov_type <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'rate_value'</font><font color="#990000">,</font> <font color="#FF0000">'meas_value'</font><font color="#990000">,</font> <font color="#FF0000">'meas_std'</font> <font color="#990000">]</font> <font color="#990000">:</font>
          var_type <font color="#990000">=</font> <font color="#FF0000">'mulcov_'</font> <font color="#990000">+</font> cov_type
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'smooth_'</font> <font color="#990000">+</font> var_type<font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>   <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>  <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>      fun<font color="#990000">[</font>var_type<font color="#990000">]</font>
          <font color="#990000">}</font> <font color="#990000">)</font>
     <b><font color="#0000FF">for</font></b> rate <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'pini'</font><font color="#990000">,</font> <font color="#FF0000">'iota'</font><font color="#990000">,</font> <font color="#FF0000">'chi'</font> <font color="#990000">]</font> <font color="#990000">:</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># smooth_rate_parent</font></i>
          name <font color="#990000">=</font> rate <font color="#990000">+</font> <font color="#FF0000">'_parent'</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>        <font color="#FF0000">'smooth_'</font> <font color="#990000">+</font> name  <font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>       age_index<font color="#990000">[</font>name<font color="#990000">]</font>  <font color="#990000">,</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>      time_index_rate_parent <font color="#990000">,</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>          fun<font color="#990000">[</font>name<font color="#990000">]</font>
          <font color="#990000">}</font> <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># smooth_rate_child</font></i>
          name <font color="#990000">=</font> rate <font color="#990000">+</font> <font color="#FF0000">'_child'</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>        <font color="#FF0000">'smooth_'</font> <font color="#990000">+</font> name  <font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>       age_index<font color="#990000">[</font>name<font color="#990000">]</font>  <font color="#990000">,</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>      time_index_rate_parent <font color="#990000">,</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>          fun<font color="#990000">[</font>name<font color="#990000">]</font>
          <font color="#990000">}</font> <font color="#990000">)</font>
     nslist_table<font color="#990000">[</font><font color="#FF0000">'nslist_omega_child'</font><font color="#990000">]</font> <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">for</font></b> node <b><font color="#0000FF">in</font></b> node_list <font color="#990000">:</font>
          name <font color="#990000">=</font> <font color="#FF0000">'smooth_omega_'</font> <font color="#990000">+</font> node
          smoothing <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font> name <font color="#990000">}</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               smoothing<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font>  <font color="#990000">=</font> age_index<font color="#990000">[</font><font color="#FF0000">'omega_parent'</font><font color="#990000">]</font>
               smoothing<font color="#990000">[</font><font color="#FF0000">'time_id'</font><font color="#990000">]</font> <font color="#990000">=</font> time_index_rate_parent
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               smoothing<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font>  <font color="#990000">=</font> age_index<font color="#990000">[</font><font color="#FF0000">'omega_child'</font><font color="#990000">]</font>
               smoothing<font color="#990000">[</font><font color="#FF0000">'time_id'</font><font color="#990000">]</font> <font color="#990000">=</font> time_index_rate_child
               nslist_table<font color="#990000">[</font><font color="#FF0000">'nslist_omega_child'</font><font color="#990000">].</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">(</font>node<font color="#990000">,</font> name<font color="#990000">)</font> <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          smoothing<font color="#990000">[</font><font color="#FF0000">'fun'</font><font color="#990000">]</font> <font color="#990000">=</font> <b><font color="#000000">fun_omega</font></b><font color="#990000">(</font>node<font color="#990000">)</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> smoothing <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># no standard deviation multipliers</font></i>
     <b><font color="#0000FF">for</font></b> dictionary <b><font color="#0000FF">in</font></b> smooth_table <font color="#990000">:</font>
          <b><font color="#0000FF">for</font></b> name <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'value'</font> <font color="#990000">,</font> <font color="#FF0000">'dage'</font><font color="#990000">,</font> <font color="#FF0000">'dtime'</font> <font color="#990000">]</font> <font color="#990000">:</font>
               key   <font color="#990000">=</font> <font color="#FF0000">'mulstd_'</font> <font color="#990000">+</font> name <font color="#990000">+</font> <font color="#FF0000">'_prior_name'</font>
               value <font color="#990000">=</font> None
               dictionary<font color="#990000">[</font>key<font color="#990000">]</font> <font color="#990000">=</font> value
     <i><font color="#9A1900"># -----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># covariate table:</font></i>
     covariate_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'sex'</font><font color="#990000">,</font>     <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font><font color="#993399">0.6</font>  <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'BMI'</font><font color="#990000">,</font>     <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">27.0</font><font color="#990000">,</font> <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'MS_2000'</font><font color="#990000">,</font> <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'MS_2010'</font><font color="#990000">,</font> <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'MS_2015'</font><font color="#990000">,</font> <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'one'</font><font color="#990000">,</font>     <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># mulcov table:</font></i>
     mulcov_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font>
               <i><font color="#9A1900"># alpha for iota and sex</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'sex'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'rate_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_rate_value'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># alpha for iota and BMI</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'BMI'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'rate_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_rate_value'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># beta for prevalence and MS_2000</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'MS_2000'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'meas_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'prevalence'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_meas_value'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># beta for prevalence and MS_2010</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'MS_2010'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'meas_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'prevalence'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_meas_value'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># beta for prevalence and MS_2015</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'MS_2015'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'meas_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'prevalence'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_meas_value'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># gamma for prevalence and one</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'one'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'meas_std'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'prevalence'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_meas_std'</font>
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># rate table:</font></i>
     rate_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font>    <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'pini'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_pini_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  <font color="#FF0000">'smooth_pini_child'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_iota_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  <font color="#FF0000">'smooth_iota_child'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'rho'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> None<font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'chi'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_chi_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  <font color="#FF0000">'smooth_chi_child'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'omega'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_omega_'</font> <font color="#990000">+</font> parent_node<font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  <font color="#FF0000">'nslist_omega_child'</font><font color="#990000">,</font>
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># data table, avgint_table:</font></i>
     data_table   <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     avgint_table <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># for each integrand, age, time, node</font></i>
     n_integrand <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>integrand_list<font color="#990000">)</font>
     n_age       <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>age_list<font color="#990000">)</font>
     n_time      <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>time_list<font color="#990000">)</font>
     n_node      <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>node_table<font color="#990000">)</font>
     <b><font color="#0000FF">if</font></b> fit_with_noise_in_data <font color="#990000">:</font>
          n_repeat <font color="#990000">=</font> <font color="#993399">3</font>
     <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
          n_repeat <font color="#990000">=</font> <font color="#993399">1</font>
     <b><font color="#0000FF">for</font></b> k1 <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font>n_integrand <font color="#990000">*</font> n_age <font color="#990000">*</font> n_time <font color="#990000">*</font> n_node <font color="#990000">*</font> n_repeat<font color="#990000">)</font> <font color="#990000">:</font>
          den         <font color="#990000">=</font> n_age <font color="#990000">*</font> n_time <font color="#990000">*</font> n_node <font color="#990000">*</font> n_repeat
          i_integrand <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k1 <font color="#990000">/</font> den <font color="#990000">)</font>
          k2          <font color="#990000">=</font>      k1 <font color="#990000">%</font> den
          <i><font color="#9A1900">#</font></i>
          den         <font color="#990000">=</font> n_time <font color="#990000">*</font> n_node <font color="#990000">*</font> n_repeat
          i_age       <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k2 <font color="#990000">/</font> den <font color="#990000">)</font>
          k3          <font color="#990000">=</font>      k2 <font color="#990000">%</font> den
          <i><font color="#9A1900">#</font></i>
          den         <font color="#990000">=</font> n_node <font color="#990000">*</font> n_repeat
          i_time      <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k3 <font color="#990000">/</font> den <font color="#990000">)</font>
          k4          <font color="#990000">=</font>      k3 <font color="#990000">%</font> den
          <i><font color="#9A1900">#</font></i>
          den         <font color="#990000">=</font> n_repeat
          i_node      <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k4 <font color="#990000">/</font> den <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          age         <font color="#990000">=</font> age_list<font color="#990000">[</font>i_age<font color="#990000">]</font>
          time        <font color="#990000">=</font> time_list<font color="#990000">[</font>i_time<font color="#990000">]</font>
          integrand   <font color="#990000">=</font> integrand_list<font color="#990000">[</font>i_integrand<font color="#990000">]</font>
          node        <font color="#990000">=</font> node_table<font color="#990000">[</font>i_node<font color="#990000">][</font><font color="#FF0000">'name'</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># sex</font></i>
          <b><font color="#0000FF">if</font></b> k1 <font color="#990000">%</font> <font color="#993399">2</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">:</font>
               sex <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">0.5</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               sex <font color="#990000">=</font> <font color="#990000">+</font><font color="#993399">0.5</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># market scan</font></i>
          <b><font color="#0000FF">if</font></b> k1 <font color="#990000">%</font> <font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">:</font>
               ms <font color="#990000">=</font> <font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">)</font>
          <b><font color="#0000FF">elif</font></b> k1 <font color="#990000">%</font> <font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">:</font>
               ms <font color="#990000">=</font> <font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">)</font>
          <b><font color="#0000FF">elif</font></b> k1 <font color="#990000">%</font> <font color="#993399">4</font> <font color="#990000">==</font> <font color="#993399">2</font> <font color="#990000">:</font>
               ms <font color="#990000">=</font> <font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">1</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">)</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               ms <font color="#990000">=</font> <font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">1</font><font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># body mass index</font></i>
          bmi <font color="#990000">=</font> <font color="#993399">20</font> <font color="#990000">+</font> k1 <font color="#990000">%</font> <font color="#993399">16</font>
          <i><font color="#9A1900">#</font></i>
          row <font color="#990000">=</font> <font color="#990000">{</font>
               <font color="#FF0000">'node'</font><font color="#990000">:</font>        node<font color="#990000">,</font>
               <font color="#FF0000">'integrand'</font><font color="#990000">:</font>   integrand<font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>     <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'weight'</font><font color="#990000">:</font>      <font color="#FF0000">'weight_constant'</font><font color="#990000">,</font>
               <font color="#FF0000">'age_lower'</font><font color="#990000">:</font>    age<font color="#990000">,</font>
               <font color="#FF0000">'age_upper'</font><font color="#990000">:</font>    age<font color="#990000">,</font>
               <font color="#FF0000">'time_lower'</font><font color="#990000">:</font>   time<font color="#990000">,</font>
               <font color="#FF0000">'time_upper'</font><font color="#990000">:</font>   time<font color="#990000">,</font>
               <font color="#FF0000">'sex'</font><font color="#990000">:</font>          sex<font color="#990000">,</font>
               <font color="#FF0000">'MS_2000'</font><font color="#990000">:</font>      ms<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
               <font color="#FF0000">'MS_2010'</font><font color="#990000">:</font>      ms<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">],</font>
               <font color="#FF0000">'MS_2015'</font><font color="#990000">:</font>      ms<font color="#990000">[</font><font color="#993399">2</font><font color="#990000">],</font>
               <font color="#FF0000">'BMI'</font><font color="#990000">:</font>          bmi<font color="#990000">,</font>
               <font color="#FF0000">'one'</font><font color="#990000">:</font>          <font color="#993399">1</font><font color="#990000">,</font>
          <font color="#990000">}</font>
          avgint_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> copy<font color="#990000">.</font><b><font color="#000000">copy</font></b><font color="#990000">(</font>row<font color="#990000">)</font> <font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># option_table</font></i>
     option_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'rate_case'</font><font color="#990000">,</font>              <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'iota_pos_rho_zero'</font> <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'parent_node_name'</font><font color="#990000">,</font>       <font color="#FF0000">'value'</font><font color="#990000">:</font>parent_node         <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'ode_step_size'</font><font color="#990000">,</font>          <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'10.0'</font>              <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'random_seed'</font><font color="#990000">,</font>            <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'0'</font>                 <font color="#990000">},</font>

          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'quasi_fixed'</font><font color="#990000">,</font>            <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'true'</font>              <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'max_num_iter_fixed'</font><font color="#990000">,</font>     <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'200'</font>               <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'print_level_fixed'</font><font color="#990000">,</font>      <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'5'</font>                 <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'tolerance_fixed'</font><font color="#990000">,</font>        <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'1e-2'</font>              <font color="#990000">},</font>

          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'max_num_iter_random'</font><font color="#990000">,</font>    <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'50'</font>                <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'print_level_random'</font><font color="#990000">,</font>     <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'0'</font>                 <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'tolerance_random'</font><font color="#990000">,</font>       <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'1e-8'</font>              <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># create database</font></i>
     dismod_at<font color="#990000">.</font><b><font color="#000000">create_database</font></b><font color="#990000">(</font>
          file_name<font color="#990000">,</font>
          age_list<font color="#990000">,</font>
          time_list<font color="#990000">,</font>
          integrand_list<font color="#990000">,</font>
          node_table<font color="#990000">,</font>
          weight_table<font color="#990000">,</font>
          covariate_table<font color="#990000">,</font>
          avgint_table<font color="#990000">,</font>
          data_table<font color="#990000">,</font>
          prior_table<font color="#990000">,</font>
          smooth_table<font color="#990000">,</font>
          nslist_table<font color="#990000">,</font>
          rate_table<font color="#990000">,</font>
          mulcov_table<font color="#990000">,</font>
          option_table
     <font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">return</font></b>
<i><font color="#9A1900"># -----------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">create_truth_var_table</font></b><font color="#990000">()</font> <font color="#990000">:</font>
     new             <font color="#990000">=</font> False
     connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
     var_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
     rate_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'rate'</font><font color="#990000">)</font>
     covariate_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'covariate'</font><font color="#990000">)</font>
     integrand_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'integrand'</font><font color="#990000">)</font>
     node_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'node'</font><font color="#990000">)</font>
     time_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'time'</font><font color="#990000">)</font>
     age_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'age'</font><font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># create truth table</font></i>
     tbl_name     <font color="#990000">=</font> <font color="#FF0000">'truth_var'</font>
     col_name     <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'truth_var_value'</font> <font color="#990000">]</font>
     col_type     <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'real'</font> <font color="#990000">]</font>
     row_list     <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>var_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
          row          <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">]</font>
          var_type     <font color="#990000">=</font> row<font color="#990000">[</font><font color="#FF0000">'var_type'</font><font color="#990000">]</font>
          age          <font color="#990000">=</font> age_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'age'</font><font color="#990000">]</font>
          time         <font color="#990000">=</font> time_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'time_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'time'</font><font color="#990000">]</font>
          <b><font color="#0000FF">if</font></b> var_type<font color="#990000">.</font><b><font color="#000000">startswith</font></b><font color="#990000">(</font><font color="#FF0000">'mulcov_'</font><font color="#990000">)</font> <font color="#990000">:</font>
               covariate <font color="#990000">=</font> covariate_table<font color="#990000">[</font>row<font color="#990000">[</font><font color="#FF0000">'covariate_id'</font> <font color="#990000">]][</font><font color="#FF0000">'covariate_name'</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          value <font color="#990000">=</font> <font color="#993399">0.0</font>
          <b><font color="#0000FF">if</font></b> var_type <font color="#990000">==</font> <font color="#FF0000">'rate'</font> <font color="#990000">:</font>
               node  <font color="#990000">=</font> node_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'node_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'node_name'</font><font color="#990000">]</font>
               rate  <font color="#990000">=</font> rate_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'rate_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'rate_name'</font><font color="#990000">]</font>
               value <font color="#990000">=</font> <b><font color="#000000">true_rate</font></b><font color="#990000">(</font>node<font color="#990000">,</font> rate<font color="#990000">,</font> age<font color="#990000">,</font> time<font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          row_list<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">[</font> value <font color="#990000">]</font> <font color="#990000">)</font>
     dismod_at<font color="#990000">.</font><b><font color="#000000">create_table</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">,</font> col_name<font color="#990000">,</font> col_type<font color="#990000">,</font> row_list<font color="#990000">)</font>
     connection<font color="#990000">.</font><b><font color="#000000">close</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">return</font></b>
<i><font color="#9A1900"># ===========================================================================</font></i>
<i><font color="#9A1900"># Run the init command to create the var table</font></i>
file_name      <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
<b><font color="#000000">example_db</font></b><font color="#990000">(</font>file_name<font color="#990000">)</font>
program        <font color="#990000">=</font> <font color="#FF0000">'../../devel/dismod_at'</font>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'init'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at init command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># create truth_var table</font></i>
<b><font color="#000000">create_truth_var_table</font></b><font color="#990000">()</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># create predict table</font></i>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'predict'</font><font color="#990000">,</font> <font color="#FF0000">'truth_var'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at predict command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># add data to data table</font></i>
new             <font color="#990000">=</font> False
connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
predict_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'predict'</font><font color="#990000">)</font>
avgint_table    <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'avgint'</font><font color="#990000">)</font>
density_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'density'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># get column names and types for data table</font></i>
tbl_name             <font color="#990000">=</font> <font color="#FF0000">'data'</font>
<font color="#990000">(</font>col_name<font color="#990000">,</font> col_type<font color="#990000">)</font> <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_name_type</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># remove the primary key from col_name and col_type</font></i>
<b><font color="#0000FF">assert</font></b> col_name<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#FF0000">'data_id'</font>
<b><font color="#0000FF">del</font></b> col_name<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
<b><font color="#0000FF">del</font></b> col_type<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># list of row values to place in data table</font></i>
row_list <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># density_id for log_gaussian</font></i>
density_id <font color="#990000">=</font> None
<b><font color="#0000FF">for</font></b> i <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> density_table <font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     <b><font color="#0000FF">if</font></b> density_table<font color="#990000">[</font>i<font color="#990000">][</font><font color="#FF0000">'density_name'</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#FF0000">'log_gaussian'</font> <font color="#990000">:</font>
          density_id <font color="#990000">=</font> i
<i><font color="#9A1900">#</font></i>
<b><font color="#0000FF">for</font></b> predict_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>predict_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># get prediction for average integrand</font></i>
     row <font color="#990000">=</font> predict_table<font color="#990000">[</font>predict_id<font color="#990000">]</font>
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'sample_index'</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#993399">0</font>
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'avgint_id'</font><font color="#990000">]</font>    <font color="#990000">==</font> predict_id
     avg_integrand <font color="#990000">=</font> row<font color="#990000">[</font><font color="#FF0000">'avg_integrand'</font><font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># initial row using information in avgint table</font></i>
     row <font color="#990000">=</font> copy<font color="#990000">.</font><b><font color="#000000">copy</font></b><font color="#990000">(</font> avgint_table<font color="#990000">[</font>predict_id<font color="#990000">]</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># add information, that is not in avgint_table, to row</font></i>
     eta        <font color="#990000">=</font> <font color="#993399">1e-7</font>                     <i><font color="#9A1900"># a very small eta</font></i>
     meas_value <font color="#990000">=</font> avg_integrand            <i><font color="#9A1900"># no noise version of meas_value</font></i>
     meas_std   <font color="#990000">=</font> noise_cv <font color="#990000">*</font> avg_integrand <i><font color="#9A1900"># noise in simulated data</font></i>
     row<font color="#990000">[</font><font color="#FF0000">'density_id'</font><font color="#990000">]</font> <font color="#990000">=</font> density_id
     row<font color="#990000">[</font><font color="#FF0000">'hold_out'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">0</font>
     row<font color="#990000">[</font><font color="#FF0000">'meas_std'</font><font color="#990000">]</font>   <font color="#990000">=</font> meas_std
     row<font color="#990000">[</font><font color="#FF0000">'meas_value'</font><font color="#990000">]</font> <font color="#990000">=</font> meas_value
     row<font color="#990000">[</font><font color="#FF0000">'eta'</font><font color="#990000">]</font>        <font color="#990000">=</font> eta
     row<font color="#990000">[</font><font color="#FF0000">'nu'</font><font color="#990000">]</font>         <font color="#990000">=</font> None
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># values in same order as col_name</font></i>
     row_value <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">for</font></b> key <b><font color="#0000FF">in</font></b> col_name <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> key <font color="#990000">!=</font> <font color="#FF0000">'data_id'</font> <font color="#990000">:</font>
               row_value<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> row<font color="#990000">[</font>key<font color="#990000">]</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     row_list<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> row_value <font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># drop the old data table</font></i>
command <font color="#990000">=</font> <font color="#FF0000">'DROP TABLE data'</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">sql_command</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> command<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># create the new data table</font></i>
dismod_at<font color="#990000">.</font><b><font color="#000000">create_table</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">,</font> col_name<font color="#990000">,</font> col_type<font color="#990000">,</font> row_list <font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># re-initailize to get data_subset table to correspond to new data</font></i>
file_name      <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
program        <font color="#990000">=</font> <font color="#FF0000">'../../devel/dismod_at'</font>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'init'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at init command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Initializing erases the truth_var table.</font></i>
<i><font color="#9A1900"># Create a new version of truth_var table that will correspond to fit</font></i>
<b><font color="#000000">create_truth_var_table</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># drop the start_var table created by init</font></i>
new             <font color="#990000">=</font> False
connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
command <font color="#990000">=</font> <font color="#FF0000">'DROP TABLE start_var'</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">sql_command</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> command<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># create new start_var table</font></i>
rate_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'rate'</font><font color="#990000">)</font>
var_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
truth_var_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'truth_var'</font><font color="#990000">)</font>
tbl_name        <font color="#990000">=</font> <font color="#FF0000">'start_var'</font>
col_name        <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'start_var_value'</font> <font color="#990000">]</font>
col_type        <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'real'</font> <font color="#990000">]</font>
row_list        <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
<b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>var_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     truth_var_value  <font color="#990000">=</font> truth_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'truth_var_value'</font><font color="#990000">]</font>
     var_type         <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'var_type'</font><font color="#990000">]</font>
     rate_id          <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'rate_id'</font><font color="#990000">]</font>
     start_var_value  <font color="#990000">=</font> truth_var_value
     <b><font color="#0000FF">if</font></b> var_type <font color="#990000">==</font> <font color="#FF0000">'rate'</font> <font color="#990000">:</font>
               <b><font color="#0000FF">if</font></b> rate_table<font color="#990000">[</font>rate_id<font color="#990000">][</font><font color="#FF0000">'rate_name'</font><font color="#990000">]</font> <font color="#990000">!=</font> <font color="#FF0000">'omega'</font> <font color="#990000">:</font>
                    start_var_value <font color="#990000">=</font> <font color="#993399">3.0</font> <font color="#990000">*</font> truth_var_value
     row_list<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">[</font>start_var_value<font color="#990000">]</font> <font color="#990000">)</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">create_table</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">,</font> col_name<font color="#990000">,</font> col_type<font color="#990000">,</font> row_list<font color="#990000">)</font>
connection<font color="#990000">.</font><b><font color="#000000">close</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Simulate a data set corresponding to the truth</font></i>
number_simulate <font color="#990000">=</font> <font color="#FF0000">'1'</font>
cmd             <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'simulate'</font><font color="#990000">,</font> number_simulate <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at simulate command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Do a fit</font></i>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'fit'</font><font color="#990000">,</font> <font color="#FF0000">'fixed'</font> <font color="#990000">]</font>
<b><font color="#0000FF">if</font></b> fit_with_noise_in_data <font color="#990000">:</font>
     simulate_index <font color="#990000">=</font> <font color="#FF0000">'0'</font>
     cmd <font color="#990000">+=</font> <font color="#990000">[</font> simulate_index <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at fit command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># compare truth and fit</font></i>
file_name      <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
new             <font color="#990000">=</font> False
connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
var_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
truth_var_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'truth_var'</font><font color="#990000">)</font>
fit_var_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'fit_var'</font><font color="#990000">)</font>
eps             <font color="#990000">=</font> <font color="#993399">0.15</font>
ok              <font color="#990000">=</font> True
max_err         <font color="#990000">=</font> <font color="#993399">0.0</font>
<b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>var_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     truth_var_value <font color="#990000">=</font> truth_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'truth_var_value'</font><font color="#990000">]</font>
     fit_var_value   <font color="#990000">=</font> fit_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'fit_var_value'</font><font color="#990000">]</font>
     <b><font color="#0000FF">if</font></b> truth_var_value <font color="#990000">!=</font> <font color="#993399">0.0</font> <font color="#990000">:</font>
          rel_err <font color="#990000">=</font> fit_var_value <font color="#990000">/</font> truth_var_value <font color="#990000">-</font> <font color="#993399">1.0</font>
          flag    <font color="#990000">=</font> <b><font color="#000000">abs</font></b><font color="#990000">(</font> rel_err <font color="#990000">)</font> <font color="#990000">&lt;=</font> eps
          ok     <font color="#990000">&amp;=</font> flag
          <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">not</font></b> flag <font color="#990000">:</font>
               <b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'var_id = '</font><font color="#990000">,</font> var_id<font color="#990000">,</font> <font color="#FF0000">', rel_err = '</font><font color="#990000">,</font> rel_err<font color="#990000">)</font>
          max_err <font color="#990000">=</font> <b><font color="#000000">max</font></b><font color="#990000">(</font> max_err<font color="#990000">,</font> <b><font color="#000000">abs</font></b><font color="#990000">(</font>rel_err<font color="#990000">)</font> <font color="#990000">)</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font>max_err<font color="#990000">)</font>
<b><font color="#0000FF">assert</font></b> ok
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'diabetes.py: OK'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i></tt></pre>
</font></code>
<hr>Input File: example/user/diabetes.py

</body>
</html>
