<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>An Example / Speed Test Fitting Simulated Diabetes Data</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="An Example / Speed Test Fitting Simulated Diabetes Data">
<meta name="keywords" id="keywords" content=" example / speed test fitting simulated diabetes data running this omega rho weight table grid covariates covariate multipliers truth var parent rates child rate effects predict problem parameters mulcov_dict node_list integrand_list parent_age_grid child_age_grid parent_time_grid child_time_grid ode_step_size meas_cv meas_repeat fit_with_noise_in_data random_seed quasi_fixed tolerance_fixed derivative_test_fixed truth2start accept_rel_err source code ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_user_diabetes.py_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://bradbell.github.io/dismod_at" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Location-&gt;</option>
<option>dismod_at</option>
<option>user</option>
<option>user_diabetes.py</option>
</select>
</td>
<td>
<select onchange='choose_across0(this)'>
<option>Search-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td><a href="age_avg_split.py.htm" target="_top">Prev</a>
</td><td><a href="user_asymptotic.py.htm" target="_top">Next</a>
</td><td>
<select onchange='choose_down2(this)'>
<option>dismod_at-&gt;</option>
<option>math_abstract</option>
<option>install_unix</option>
<option>get_started</option>
<option>user</option>
<option>database</option>
<option>model</option>
<option>command</option>
<option>python</option>
<option>devel</option>
<option>whats_new_2018</option>
<option>wish_list</option>
</select>
</td>
<td>
<select onchange='choose_down1(this)'>
<option>user-&gt;</option>
<option>user_csv2db.py</option>
<option>user_fit_random.py</option>
<option>user_fit_fixed_both.py</option>
<option>user_posterior.py</option>
<option>user_fit_sim.py</option>
<option>age_avg_split.py</option>
<option>user_diabetes.py</option>
<option>user_asymptotic.py</option>
<option>user_change_grid.py</option>
<option>user_const_random.py</option>
<option>user_const_value.py</option>
<option>user_continue_fit.py</option>
<option>user_diff_constraint.py</option>
<option>user_jump_at_age.py</option>
<option>user_lasso_covariate.py</option>
<option>user_meas_covariate.py</option>
<option>user_no_children.py</option>
<option>user_predict_fit.py</option>
<option>user_zero_sum_random.py</option>
<option>user_re_scale.py</option>
<option>user_speed.py</option>
<option>user_students.py</option>
</select>
</td>
<td>user_diabetes.py</td>
</tr></table><br>
@(@\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@<center><b><big><big>An Example / Speed Test Fitting Simulated Diabetes Data</big></big></b></center>

<br><a href="user_diabetes.py.htm#Running This example" target="_top">Running&nbsp;This&nbsp;example</a>
<br><a href="user_diabetes.py.htm#omega" target="_top">omega</a>
<br><a href="user_diabetes.py.htm#rho" target="_top">rho</a>
<br><a href="user_diabetes.py.htm#Weight Table and Grid" target="_top">Weight&nbsp;Table&nbsp;and&nbsp;Grid</a>
<br><a href="user_diabetes.py.htm#Covariates" target="_top">Covariates</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Covariates.Covariate Table" target="_top">Covariate&nbsp;Table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Covariates.Data Table" target="_top">Data&nbsp;Table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Covariates.Multipliers" target="_top">Multipliers</a>
<br><a href="user_diabetes.py.htm#Truth Var Table" target="_top">Truth&nbsp;Var&nbsp;Table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Truth Var Table.Parent Rates" target="_top">Parent&nbsp;Rates</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Truth Var Table.Child Rate Effects" target="_top">Child&nbsp;Rate&nbsp;Effects</a>
<br><a href="user_diabetes.py.htm#Predict Table" target="_top">Predict&nbsp;Table</a>
<br><a href="user_diabetes.py.htm#Problem Parameters" target="_top">Problem&nbsp;Parameters</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.mulcov_dict" target="_top">mulcov_dict</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.node_list" target="_top">node_list</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.integrand_list" target="_top">integrand_list</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.parent_age_grid" target="_top">parent_age_grid</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.child_age_grid" target="_top">child_age_grid</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.parent_time_grid" target="_top">parent_time_grid</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.child_time_grid" target="_top">child_time_grid</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.ode_step_size" target="_top">ode_step_size</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.meas_cv" target="_top">meas_cv</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.meas_repeat" target="_top">meas_repeat</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.fit_with_noise_in_data" target="_top">fit_with_noise_in_data</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.random_seed" target="_top">random_seed</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.quasi_fixed" target="_top">quasi_fixed</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.tolerance_fixed" target="_top">tolerance_fixed</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.derivative_test_fixed" target="_top">derivative_test_fixed</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.truth2start" target="_top">truth2start</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_diabetes.py.htm#Problem Parameters.accept_rel_err" target="_top">accept_rel_err</a>
<br><a href="user_diabetes.py.htm#Source Code" target="_top">Source&nbsp;Code</a><br>
<br>
<b><big><a name="Running This example" id="Running This example">Running This example</a></big></b>
<br>
see <a href="user.htm#Run One Example" target="_top"><span style='white-space: nowrap'>run&nbsp;one&nbsp;example</span></a>
.
The time required to run the program will be printed at then end.

<br>
<br>
<b><big><a name="omega" id="omega">omega</a></big></b>
<br>
The model rate <a href="rate_table.htm#rate_name.omega" target="_top"><span style='white-space: nowrap'>omega</span></a>

is constrained to have the value used during simulation of the data.

<br>
<br>
<b><big><a name="rho" id="rho">rho</a></big></b>
<br>
The model rate <a href="rate_table.htm#rate_name.rho" target="_top"><span style='white-space: nowrap'>rho</span></a>

is constrained to be zero.

<br>
<br>
<b><big><a name="Weight Table and Grid" id="Weight Table and Grid">Weight Table and Grid</a></big></b>
<br>
There is one weighting, with the constant value one,
in the <a href="weight_table.htm" target="_top"><span style='white-space: nowrap'>weight_table</span></a>
 and <a href="weight_grid_table.htm" target="_top"><span style='white-space: nowrap'>weight_grid_table</span></a>
.

<br>
<br>
<b><big><a name="Covariates" id="Covariates">Covariates</a></big></b>


<br>
<br>
<big><a name="Covariates.Covariate Table" id="Covariates.Covariate Table">Covariate Table</a></big>
<br>
The covariate table has the following values:
<table><tr><td align='left'  valign='top'>

covariate_name    </td><td align='left'  valign='top'>
 reference      </td><td align='left'  valign='top'>
 max_difference </td></tr><tr><td align='left'  valign='top'>

sex               </td><td align='left'  valign='top'>
 0              </td><td align='left'  valign='top'>
 0.6            </td></tr><tr><td align='left'  valign='top'>

bmi               </td><td align='left'  valign='top'>
 28             </td><td align='left'  valign='top'>
 null           </td></tr><tr><td align='left'  valign='top'>

ms_2000           </td><td align='left'  valign='top'>
 0              </td><td align='left'  valign='top'>
 null
</td></tr>
</table>
<br>
<big><a name="Covariates.Data Table" id="Covariates.Data Table">Data Table</a></big>
<br>
The <a href="data_table.htm#Covariates" target="_top"><span style='white-space: nowrap'>covariate</span></a>
 columns in the
data table have the following values:

<code><i><font color="black"><span style='white-space: nowrap'>sex</span></font></i></code>
 is <code><font color="blue">0.5</font></code> for male and <code><font color="blue">-0.5</font></code> for female,

<code><i><font color="black"><span style='white-space: nowrap'>bmi</span></font></i></code>
 is body mass index 
<code><font color="blue"><span style='white-space: nowrap'>20&nbsp;&lt;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>bmi</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;&lt;=&nbsp;36</span></font></code>
,

<code><i><font color="black"><span style='white-space: nowrap'>ms_2000</span></font></i></code>
 is <code><font color="blue">1.0</font></code> if this is year 2000 market scan data
and <code><font color="blue">0.0</font></code> otherwise.

<br>
<br>
<big><a name="Covariates.Multipliers" id="Covariates.Multipliers">Multipliers</a></big>
<br>
There are three covariate multipliers, one for each covariate.
(In general, a covariate can have more than one multiplier.)
In addition, each covariate multiplier has one grid point; i.e.,
the multiplier is constant in age and time.
The value for each multiplier has a uniform distribution
with the lower and upper limits below:
<table><tr><td align='left'  valign='top'>

covariate </td><td align='left'  valign='top'>
 affected   </td><td align='left'  valign='top'>
 lower </td><td align='left'  valign='top'>
 upper </td></tr><tr><td align='left'  valign='top'>

sex       </td><td align='left'  valign='top'>
 iota       </td><td align='left'  valign='top'>
 -2.0  </td><td align='left'  valign='top'>
 +2.0  </td></tr><tr><td align='left'  valign='top'>

bmi       </td><td align='left'  valign='top'>
 iota       </td><td align='left'  valign='top'>
 -0.1  </td><td align='left'  valign='top'>
 +0.1  </td></tr><tr><td align='left'  valign='top'>

ms_2000   </td><td align='left'  valign='top'>
 prevalence </td><td align='left'  valign='top'>
 -1.0  </td><td align='left'  valign='top'>
 +1.0  </td></tr><tr><td align='left'  valign='top'>

</td></tr>
</table>
Note that the for sex and bmi these are
<a href="mulcov_table.htm#mulcov_type.rate_value" target="_top"><span style='white-space: nowrap'>rate_value</span></a>
 multipliers and
for ms_2000 it is a
<a href="mulcov_table.htm#mulcov_type.meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>
 multiplier.

<br>
<br>
<b><big><a name="Truth Var Table" id="Truth Var Table">Truth Var Table</a></big></b>
<br>
The values in the <a href="truth_var_table.htm" target="_top"><span style='white-space: nowrap'>truth_var_table</span></a>
 are generated using bilinear
interpolation of the log of values specified points.

<br>
<br>
<big><a name="Truth Var Table.Parent Rates" id="Truth Var Table.Parent Rates">Parent Rates</a></big>
<br>
We use the notation
as for age start,
ae for age end,
ts for time start, and
te for time end.
The following table gives the values used for the parent rates
(note that the parent rate for pini cannot change with age):
<table><tr><td align='left'  valign='top'>

rate  </td><td align='left'  valign='top'>
 (as,ts) </td><td align='left'  valign='top'>
 (as,te) </td><td align='left'  valign='top'>
 (ae,ts) </td><td align='left'  valign='top'>
 (ae,te) </td></tr><tr><td align='left'  valign='top'>

pini  </td><td align='left'  valign='top'>
 .01     </td><td align='left'  valign='top'>
 .01     </td><td align='left'  valign='top'>
 .01     </td><td align='left'  valign='top'>
 .01     </td></tr><tr><td align='left'  valign='top'>

iota  </td><td align='left'  valign='top'>
 .001    </td><td align='left'  valign='top'>
 .002    </td><td align='left'  valign='top'>
 .01     </td><td align='left'  valign='top'>
 .02     </td></tr><tr><td align='left'  valign='top'>

omega </td><td align='left'  valign='top'>
 .003    </td><td align='left'  valign='top'>
 .002    </td><td align='left'  valign='top'>
 .3      </td><td align='left'  valign='top'>
 .2      </td></tr><tr><td align='left'  valign='top'>

chi   </td><td align='left'  valign='top'>
 .004    </td><td align='left'  valign='top'>
 .002    </td><td align='left'  valign='top'>
 .1      </td><td align='left'  valign='top'>
 .05     </td></tr><tr><td align='left'  valign='top'>

</td></tr>
</table>
<br>
<big><a name="Truth Var Table.Child Rate Effects" id="Truth Var Table.Child Rate Effects">Child Rate Effects</a></big>
<br>
The child rate effects are in log space
(see <a href="avg_integrand.htm#Rate Functions.Child Rate Effect, u_ik" target="_top"><span style='white-space: nowrap'>u_ik</span></a>
),
constant in age and time,
positive for even index children, negative for odd indices, and have the
following values:
<table><tr><td align='left'  valign='top'>

rate   </td><td align='left'  valign='top'>
 even index </td><td align='left'  valign='top'>
 odd index </td></tr><tr><td align='left'  valign='top'>

pini   </td><td align='left'  valign='top'>
 .1         </td><td align='left'  valign='top'>
 -.1       </td></tr><tr><td align='left'  valign='top'>

iota   </td><td align='left'  valign='top'>
 .15        </td><td align='left'  valign='top'>
 -.15      </td></tr><tr><td align='left'  valign='top'>

chi    </td><td align='left'  valign='top'>
 .25        </td><td align='left'  valign='top'>
 -.25      </td></tr><tr><td align='left'  valign='top'>

</td></tr>
</table>
There is an exception for omega, which is constrained. It is defined
on the parent age grid and has the following values:
<table><tr><td align='left'  valign='top'>

index  </td><td align='left'  valign='top'>
 (as,ts) </td><td align='left'  valign='top'>
 (as,te) </td><td align='left'  valign='top'>
 (ae,ts) </td><td align='left'  valign='top'>
 (ae,te) </td></tr><tr><td align='left'  valign='top'>

even   </td><td align='left'  valign='top'>
  .1     </td><td align='left'  valign='top'>
  .02     </td><td align='left'  valign='top'>
  .02   </td><td align='left'  valign='top'>
  .03    </td></tr><tr><td align='left'  valign='top'>

odd    </td><td align='left'  valign='top'>
 -.1     </td><td align='left'  valign='top'>
 -.02     </td><td align='left'  valign='top'>
 -.02   </td><td align='left'  valign='top'>
 -.03    </td></tr><tr><td align='left'  valign='top'>

</td></tr>
</table>
<br>
<b><big><a name="Predict Table" id="Predict Table">Predict Table</a></big></b>
<br>
The <a href="predict_command.htm" target="_top"><span style='white-space: nowrap'>predict_command</span></a>
 is used to compute the
<a href="predict_table.htm#avg_integrand" target="_top"><span style='white-space: nowrap'>avg_integrand</span></a>
 corresponding to the
true values for the variables.
This is then used to create a version of the <a href="data_table.htm" target="_top"><span style='white-space: nowrap'>data_table</span></a>

with no noise, and with a standard deviation that is modeled using
a coefficient of variation.

<br>
<br>
<b><big><a name="Problem Parameters" id="Problem Parameters">Problem Parameters</a></big></b>
<br>
The problem parameters below can (and should) be changed to experiment with
how they affect the results.

<br>
<br>
<big><a name="Problem Parameters.mulcov_dict" id="Problem Parameters.mulcov_dict">mulcov_dict</a></big>
<br>
This is a dictionary that maps each covariate name
to the true value for the corresponding covariate multiplier.
These values must satisfy the lower and upper
<a href="user_diabetes.py.htm#Covariates.Multipliers" target="_top"><span style='white-space: nowrap'>multiplier</span></a>
 limits above:
<pre style='display:inline'><tt>
mulcov_dict <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'sex'</font><font color="#990000">:</font><font color="#993399">0.5</font><font color="#990000">,</font> <font color="#FF0000">'bmi'</font><font color="#990000">:</font><font color="#993399">0.02</font><font color="#990000">,</font> <font color="#FF0000">'ms_2000'</font><font color="#990000">:</font><font color="#993399">0.25</font> <font color="#990000">}</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.node_list" id="Problem Parameters.node_list">node_list</a></big>
<br>
This is a <code><font color="blue">list</font></code> with <code><font color="blue">str</font></code> elements.
The first element of this list is the parent node,
the others are the child nodes. There must be an even number of children;
i.e., an odd number of elements in this list.
The case with no child nodes; i.e., one element in the list, is OK:
<pre style='display:inline'><tt>
node_list <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'US'</font><font color="#990000">,</font> <font color="#FF0000">'Alabama'</font><font color="#990000">,</font> <font color="#FF0000">'California'</font> <font color="#990000">]</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.integrand_list" id="Problem Parameters.integrand_list">integrand_list</a></big>
<br>
This is a <code><font color="blue">list</font></code> with <code><font color="blue">str</font></code> elements that are
<a href="integrand_table.htm#integrand_name" target="_top"><span style='white-space: nowrap'>integrand&nbsp;names</span></a>

that will have measurements in the <a href="data_table.htm" target="_top"><span style='white-space: nowrap'>data_table</span></a>

and <a href="data_sim_table.htm" target="_top"><span style='white-space: nowrap'>data_sim_table</span></a>
.
As mentioned above, the rates
<a href="user_diabetes.py.htm#omega" target="_top"><span style='white-space: nowrap'>omega</span></a>
  and
<a href="user_diabetes.py.htm#rho" target="_top"><span style='white-space: nowrap'>rho</span></a>

are know during the estimation (fitting) process.
The integrands must inform the estimation of
the model rates for
<a href="rate_table.htm#rate_name.pini" target="_top"><span style='white-space: nowrap'>pini</span></a>
,
<a href="rate_table.htm#rate_name.iota" target="_top"><span style='white-space: nowrap'>iota</span></a>
, and
<a href="rate_table.htm#rate_name.chi" target="_top"><span style='white-space: nowrap'>chi</span></a>
.
Note that measuring prevalence at age zero should determine pini,
prevalence at other ages corresponds to integrals of iota, and
given prevalence, mtspecific should determine chi.
<pre><tt>integrand_table <font color="#990000">=</font> <font color="#990000">[</font>
      <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'mtspecific'</font> <font color="#990000">},</font>
      <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'prevalence'</font> <font color="#990000">}</font>
<font color="#990000">]</font></tt></pre>
<br>
<big><a name="Problem Parameters.parent_age_grid" id="Problem Parameters.parent_age_grid">parent_age_grid</a></big>
<br>
This specifies the age grid used for all the parent rate
<a href="rate_table.htm#parent_smooth_id" target="_top"><span style='white-space: nowrap'>smoothings</span></a>
.
It is also the age grid used for constraining the child omega rates using
<a href="rate_table.htm#child_nslist_id" target="_top"><span style='white-space: nowrap'>child_nslist_id</span></a>
.
In addition, it is the set of ages in the <a href="age_table.htm" target="_top"><span style='white-space: nowrap'>age_table</span></a>
.
It is a <code><font color="blue">dict</font></code> with <code><font color="blue">float</font></code> values
(except for 
<code><i><font color="black"><span style='white-space: nowrap'>number</span></font></i></code>
 which is a positive <code><font color="blue">int</font></code>) containing
the start age, end age, number of age grid points, and
standard deviation of the log-Gaussian used to smooth the
<a href="model_variables.htm#Fixed Effects, theta.Parent Rates" target="_top"><span style='white-space: nowrap'>parent&nbsp;rates</span></a>

age differences.
(This does not include <a href="rate_table.htm#rate_name.pini" target="_top"><span style='white-space: nowrap'>pini</span></a>

because it only has one age point.)
The interval between age grid points is the end age, minus the start age,
divided by the number of grid points minus one.
<pre style='display:inline'><tt>
parent_age_grid  <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'start'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font> <font color="#FF0000">'end'</font><font color="#990000">:</font><font color="#993399">100.0</font><font color="#990000">,</font> <font color="#FF0000">'number'</font><font color="#990000">:</font><font color="#993399">6</font><font color="#990000">,</font> <font color="#FF0000">'std'</font><font color="#990000">:</font><font color="#993399">0.4</font> <font color="#990000">}</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.child_age_grid" id="Problem Parameters.child_age_grid">child_age_grid</a></big>
<br>
The is the age grid used for all the child rate effect
<a href="rate_table.htm#child_smooth_id" target="_top"><span style='white-space: nowrap'>smoothings</span></a>
 except for
omega (see 
<code><i><font color="black"><span style='white-space: nowrap'>parent_age_grid</span></font></i></code>
 above).
It is a <code><font color="blue">dict</font></code> with the following values:
The value of 
<code><i><font color="black"><span style='white-space: nowrap'>index</span></font></i></code>
 is a list of indices (<code><font color="blue">int</font></code>) in the parent
age grid where there are
<a href="model_variables.htm#Random Effects, u" target="_top"><span style='white-space: nowrap'>random&nbsp;effects</span></a>
.
Each of these indices must be less than 
<code><i><font color="black"><span style='white-space: nowrap'>number</span></font></i></code>
 in the age grid.
The value 
<code><i><font color="black"><span style='white-space: nowrap'>std</span></font></i></code>
 (a <code><font color="blue">float</font></code>) is the standard deviation in the
Gaussian used to smooth the child rate effect values.
(This does not include <a href="rate_table.htm#rate_name.pini" target="_top"><span style='white-space: nowrap'>pini</span></a>

because it only has one age point.)
<pre style='display:inline'><tt>
child_age_grid  <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'index'</font><font color="#990000">:[</font><font color="#993399">0</font><font color="#990000">],</font> <font color="#FF0000">'std'</font><font color="#990000">:</font><font color="#993399">0.2</font> <font color="#990000">}</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.parent_time_grid" id="Problem Parameters.parent_time_grid">parent_time_grid</a></big>
<br>
This specifies the time grid used for all the parent rate
<a href="rate_table.htm#parent_smooth_id" target="_top"><span style='white-space: nowrap'>smoothings</span></a>
.
It is also the time grid used for constraining the child omega rates using
<a href="rate_table.htm#child_nslist_id" target="_top"><span style='white-space: nowrap'>child_nslist_id</span></a>
.
In addition, it is the set of times in the <a href="time_table.htm" target="_top"><span style='white-space: nowrap'>time_table</span></a>
.
<a href="rate_table.htm#child_nslist_id" target="_top"><span style='white-space: nowrap'>child_nslist_id</span></a>
.
It is a <code><font color="blue">dict</font></code> with <code><font color="blue">float</font></code> values
(except for 
<code><i><font color="black"><span style='white-space: nowrap'>number</span></font></i></code>
 which is a positive <code><font color="blue">int</font></code>) containing
the start time, end time, number of time grid points, and
standard deviation of the log-Gaussian used to smooth the
<a href="model_variables.htm#Fixed Effects, theta.Parent Rates" target="_top"><span style='white-space: nowrap'>parent&nbsp;rates</span></a>

time differences.
(This includes <a href="rate_table.htm#rate_name.pini" target="_top"><span style='white-space: nowrap'>pini</span></a>
).
This is also the set of times in the <a href="time_table.htm" target="_top"><span style='white-space: nowrap'>time_table</span></a>
.
The interval between time grid points is the end time, minus the start time,
divided by the number of grid points minus one.
<pre style='display:inline'><tt>
parent_time_grid <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'start'</font><font color="#990000">:</font><font color="#993399">1990.0</font><font color="#990000">,</font> <font color="#FF0000">'end'</font><font color="#990000">:</font> <font color="#993399">2020</font><font color="#990000">,</font> <font color="#FF0000">'number'</font><font color="#990000">:</font><font color="#993399">2</font><font color="#990000">,</font> <font color="#FF0000">'std'</font><font color="#990000">:</font><font color="#993399">0.6</font>  <font color="#990000">}</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.child_time_grid" id="Problem Parameters.child_time_grid">child_time_grid</a></big>
<br>
The is the time grid used for all the child rate effect
<a href="rate_table.htm#child_smooth_id" target="_top"><span style='white-space: nowrap'>smoothings</span></a>
 except for
omega (see 
<code><i><font color="black"><span style='white-space: nowrap'>parent_time_grid</span></font></i></code>
 above).
It is a <code><font color="blue">dict</font></code> with the following values:
The value of 
<code><i><font color="black"><span style='white-space: nowrap'>index</span></font></i></code>
 is a list of indices (<code><font color="blue">int</font></code>) in the parent
time grid where there are
<a href="model_variables.htm#Random Effects, u" target="_top"><span style='white-space: nowrap'>random&nbsp;effects</span></a>
.
Each of these indices must be less than 
<code><i><font color="black"><span style='white-space: nowrap'>number</span></font></i></code>
 in the time grid.
The value 
<code><i><font color="black"><span style='white-space: nowrap'>std</span></font></i></code>
 (a <code><font color="blue">float</font></code>) is the standard deviation in the
Gaussian used to smooth the child rate effect values.
(This includes <a href="rate_table.htm#rate_name.pini" target="_top"><span style='white-space: nowrap'>pini</span></a>
).
<pre style='display:inline'><tt>
child_time_grid  <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'index'</font><font color="#990000">:[</font><font color="#993399">0</font><font color="#990000">],</font> <font color="#FF0000">'std'</font><font color="#990000">:</font><font color="#993399">0.2</font> <font color="#990000">}</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.ode_step_size" id="Problem Parameters.ode_step_size">ode_step_size</a></big>
<br>
This is a <code><font color="blue">str</font></code> that specifies the
<a href="option_table.htm#ode_step_size" target="_top"><span style='white-space: nowrap'>ode_step_size</span></a>
.
It is suggest that this value be less than the intervals in the
age and time grids:
<pre style='display:inline'><tt>
ode_step_size <font color="#990000">=</font> <font color="#FF0000">'10.0'</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.meas_cv" id="Problem Parameters.meas_cv">meas_cv</a></big>
<br>
This is a <code><font color="blue">float</font></code> that specifies the measurement standard deviations
<a href="data_table.htm#meas_std" target="_top"><span style='white-space: nowrap'>meas_std</span></a>
 by

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>meas_std</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>meas_cv</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;*&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>meas_value</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>
For this example, the data table column
<a href="data_table.htm#meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>
 does not have any noise; i.e.,
the values in that column are the corresponding
<a href="avg_integrand.htm#Average Integrand, A_i" target="_top"><span style='white-space: nowrap'>average&nbsp;integrand</span></a>
.
The 
<code><i><font color="black"><span style='white-space: nowrap'>meas_std</span></font></i></code>
 determines the noise level used by the
<a href="simulate_command.htm" target="_top"><span style='white-space: nowrap'>simulate_command</span></a>
:
<pre style='display:inline'><tt>
meas_cv <font color="#990000">=</font> <font color="#993399">0.1</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.meas_repeat" id="Problem Parameters.meas_repeat">meas_repeat</a></big>
<br>
This is a positive <code><font color="blue">int</font></code> that specifies
the number of times each noiseless measurement is repeated.
Note that the simulated measurements will be different, because
the noise for each measurement will be different.
There are 
<code><i><font color="black"><span style='white-space: nowrap'>meas_repeat</span></font></i></code>

data points for each integrand in the integrand list,
each age in the age grid,
each time in the time grid,
each node in the node list.
In addition if an age is not the first age and time is not the first time,
there is a data point in the middle of the age-time interval that ends
at that (age, time):
<pre style='display:inline'><tt>
meas_repeat <font color="#990000">=</font> <font color="#993399">1</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.fit_with_noise_in_data" id="Problem Parameters.fit_with_noise_in_data">fit_with_noise_in_data</a></big>
<br>
This is a <code><font color="blue">bool</font></code> that specifies if measurement noise is included
when fitting the data; i.e., if the column
<a href="data_sim_table.htm#data_sim_value" target="_top"><span style='white-space: nowrap'>data_sim_value</span></a>
 is used to
fit the <a href="model_variables.htm" target="_top"><span style='white-space: nowrap'>model_variables</span></a>
.
Otherwise, the measurements without noise
are used to fit the model variables; i.e., the column
<a href="data_table.htm#meas_value" target="_top"><span style='white-space: nowrap'>meas_value</span></a>
:
<pre style='display:inline'><tt>
fit_with_noise_in_data <font color="#990000">=</font> False
</tt></pre>
<br>
<big><a name="Problem Parameters.random_seed" id="Problem Parameters.random_seed">random_seed</a></big>
<br>
This <code><font color="blue">str</font></code> must be a non-negative integer and is the
<a href="option_table.htm#random_seed" target="_top"><span style='white-space: nowrap'>random_seed</span></a>
 option value.
This is used to seed the random number generator used to simulate the
noise in the measurement values.
The affects the results of the fit when 
<code><i><font color="black"><span style='white-space: nowrap'>fit_with_noise_in_data</span></font></i></code>

is true
<pre style='display:inline'><tt>
random_seed <font color="#990000">=</font> <font color="#FF0000">'0'</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.quasi_fixed" id="Problem Parameters.quasi_fixed">quasi_fixed</a></big>
<br>
This <code><font color="blue">str</font></code> that is either <code><font color="blue">true</font></code> or <code><font color="blue">false</font></code> and is the
<a href="option_table.htm#Fixed Only.quasi_fixed" target="_top"><span style='white-space: nowrap'>quasi_fixed</span></a>
 option value.
If it is true, a quasi-Newton method is used.
This only requires function values and
first derivatives for the objective and constraints.
If it is false, a Newton method is used.
This requires second derivatives in which case initialization
and function evaluations take longer:
<pre style='display:inline'><tt>
quasi_fixed <font color="#990000">=</font> <font color="#FF0000">'true'</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.tolerance_fixed" id="Problem Parameters.tolerance_fixed">tolerance_fixed</a></big>
<br>
This <code><font color="blue">str</font></code> contains the
<a href="option_table.htm#Fixed and Random.tolerance" target="_top"><span style='white-space: nowrap'>tolerance_fixed</span></a>
 option value.
<pre style='display:inline'><tt>
tolerance_fixed <font color="#990000">=</font> <font color="#FF0000">'1e-4'</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.derivative_test_fixed" id="Problem Parameters.derivative_test_fixed">derivative_test_fixed</a></big>
<br>
This <code><font color="blue">str</font></code> is the
<a href="option_table.htm#Fixed and Random.derivative_test" target="_top"><span style='white-space: nowrap'>derivative_test</span></a>

option for the fixed effects.
The choice <code><font color="blue">trace-adaptive</font></code> can be used to see if the partial
derivatives of the objective and constraints after the
<a href="prior_table.htm#eta.Scaling Fixed Effects" target="_top"><span style='white-space: nowrap'>scaling</span></a>
 of the fixed effects.
The choice <code><font color="blue">none</font></code> is normal for a working example.
<pre style='display:inline'><tt>
derivative_test_fixed <font color="#990000">=</font> <font color="#FF0000">'none'</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.truth2start" id="Problem Parameters.truth2start">truth2start</a></big>
<br>
This is a <code><font color="blue">float</font></code> that is used to map

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>start_var_value</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>truth2start</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;*&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>truth_var_value</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>
for each model variable that is not constrained to a specific value.
The notation
<a href="truth_var_table.htm#truth_var_value" target="_top"><span style='white-space: nowrap'>truth_var_value</span></a>
 is the true value
used to simulate the data and
<a href="start_var_table.htm#start_var_value" target="_top"><span style='white-space: nowrap'>start_var_value</span></a>
 is the initial
value of the variable during the fit.
An error will result if the starting value for a variable is not within
the upper and lower limits for a variable.
The starting values are also used for the <a href="scale_var_table.htm" target="_top"><span style='white-space: nowrap'>scale_var_table</span></a>
.

<code><i><font color="black"><span style='white-space: nowrap'>truth2start</span></font></i></code>
:
<pre style='display:inline'><tt>
truth2start <font color="#990000">=</font> <font color="#993399">0.3</font>
</tt></pre>
<br>
<big><a name="Problem Parameters.accept_rel_err" id="Problem Parameters.accept_rel_err">accept_rel_err</a></big>
<br>
This is a <code><font color="blue">float</font></code> that specifies the absolute relative error
to be accepted as passing the test.
If the test passes, for each model variable

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>accept_rel_err</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;&gt;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>fit_var_value</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;/&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>truth_var_value</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;-&nbsp;1.0<br>
</span></font></code>
where
<a href="truth_var_table.htm#truth_var_value" target="_top"><span style='white-space: nowrap'>truth_var_value</span></a>
 is the true value
used to simulate the data and
<a href="fit_var_table.htm#fit_var_value" target="_top"><span style='white-space: nowrap'>fit_var_value</span></a>
 is result of the fit.
A python assertion is generated if the condition above is not satisfied.
<pre style='display:inline'><tt>
accept_rel_err <font color="#990000">=</font> <font color="#993399">0.25</font>
</tt></pre>
<br>
<b><big><a name="Source Code" id="Source Code">Source Code</a></big></b>

<pre><tt>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#000080">import</font></b> sys
<b><font color="#000080">import</font></b> os
<b><font color="#000080">import</font></b> distutils<font color="#990000">.</font>dir_util
<b><font color="#000080">import</font></b> subprocess
<b><font color="#000080">import</font></b> copy
<b><font color="#000080">import</font></b> math
<b><font color="#000080">import</font></b> time
test_program <font color="#990000">=</font> <font color="#FF0000">'example/user/diabetes.py'</font>
<b><font color="#0000FF">if</font></b> sys<font color="#990000">.</font>argv<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">!=</font> test_program  <b><font color="#0000FF">or</font></b> <b><font color="#000000">len</font></b><font color="#990000">(</font>sys<font color="#990000">.</font>argv<font color="#990000">)</font> <font color="#990000">!=</font> <font color="#993399">1</font> <font color="#990000">:</font>
     usage  <font color="#990000">=</font> <font color="#FF0000">'python3 '</font> <font color="#990000">+</font> test_program <font color="#990000">+</font> <font color="#FF0000">'\n'</font>
     usage <font color="#990000">+=</font> <font color="#FF0000">'where python3 is the python 3 program on your system\n'</font>
     usage <font color="#990000">+=</font> <font color="#FF0000">'and working directory is the dismod_at distribution directory\n'</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font>usage<font color="#990000">)</font>
start_second <font color="#990000">=</font> time<font color="#990000">.</font><b><font color="#000000">time</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># import dismod_at</font></i>
local_dir <font color="#990000">=</font> os<font color="#990000">.</font><b><font color="#000000">getcwd</font></b><font color="#990000">()</font> <font color="#990000">+</font> <font color="#FF0000">'/python'</font>
<b><font color="#0000FF">if</font></b><font color="#990000">(</font> os<font color="#990000">.</font>path<font color="#990000">.</font><b><font color="#000000">isdir</font></b><font color="#990000">(</font> local_dir <font color="#990000">+</font> <font color="#FF0000">'/dismod_at'</font> <font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font>path<font color="#990000">.</font><b><font color="#000000">insert</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> local_dir<font color="#990000">)</font>
<b><font color="#000080">import</font></b> dismod_at
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># change into the build/example/user directory</font></i>
distutils<font color="#990000">.</font>dir_util<font color="#990000">.</font><b><font color="#000000">mkpath</font></b><font color="#990000">(</font><font color="#FF0000">'build/example/user'</font><font color="#990000">)</font>
os<font color="#990000">.</font><b><font color="#000000">chdir</font></b><font color="#990000">(</font><font color="#FF0000">'build/example/user'</font><font color="#990000">)</font>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
     <i><font color="#9A1900"># denominator</font></i>
     da  <font color="#990000">=</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     dt  <font color="#990000">=</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     den <font color="#990000">=</font> da <font color="#990000">*</font> dt<font color="#990000">;</font>
     num <font color="#990000">=</font> <font color="#993399">0.0</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at start age and start time</font></i>
     da   <font color="#990000">=</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> a
     dt   <font color="#990000">=</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> t
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at start age and end time</font></i>
     da   <font color="#990000">=</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> a
     dt   <font color="#990000">=</font> t <font color="#990000">-</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at end age and start time</font></i>
     da   <font color="#990000">=</font> a <font color="#990000">-</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     dt   <font color="#990000">=</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font> <font color="#990000">-</font> t
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># value at end age and end time</font></i>
     da   <font color="#990000">=</font> a <font color="#990000">-</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     dt   <font color="#990000">=</font> t <font color="#990000">-</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     num <font color="#990000">+=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font> grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font> <font color="#990000">)</font> <font color="#990000">*</font> da <font color="#990000">*</font> dt
     <i><font color="#9A1900">#</font></i>
     <b><font color="#0000FF">return</font></b> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(</font> num <font color="#990000">/</font> den <font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">true_rate</font></b><font color="#990000">(</font>node<font color="#990000">,</font> rate<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
     parent_node <font color="#990000">=</font> node_list<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
     <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
          even_child <font color="#990000">=</font> node_list<font color="#990000">.</font><b><font color="#000000">index</font></b><font color="#990000">(</font>node<font color="#990000">)</font> <font color="#990000">%</font> <font color="#993399">2</font> <font color="#990000">==</font> <font color="#993399">0</font>
     <i><font color="#9A1900"># default</font></i>
     grid_value <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">if</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'pini'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">01</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">01</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(</font><font color="#993399">0.1</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(</font><font color="#993399">0.1</font><font color="#990000">)</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-</font><font color="#993399">0.1</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-</font><font color="#993399">0.1</font><font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># pini is constant in age</font></i>
          grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font>
          grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">elif</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'iota'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">001</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">002</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">01</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">02</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">15</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">15</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">15</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">15</font><font color="#990000">)</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">15</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">15</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">15</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">15</font><font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># we are constraining omega to its true value so we do a detailed</font></i>
     <i><font color="#9A1900"># simulation of the random effect for omega; i.e., it is not constant</font></i>
     <b><font color="#0000FF">elif</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'omega'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">003</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">002</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">3</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">2</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">10</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">20</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">20</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">30</font><font color="#990000">)</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">10</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">20</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">20</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">30</font><font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">elif</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'chi'</font> <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">==</font> parent_node <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">004</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">002</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">1</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> <font color="#990000">.</font><font color="#993399">05</font>
          <b><font color="#0000FF">elif</font></b> even_child <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">25</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">25</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">25</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(.</font><font color="#993399">25</font><font color="#990000">)</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, start_time'</font><font color="#990000">]</font> <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">25</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'start_age, end_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">25</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, start_time'</font><font color="#990000">]</font>   <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">25</font><font color="#990000">)</font>
               grid_value<font color="#990000">[</font><font color="#FF0000">'end_age, end_time'</font><font color="#990000">]</font>     <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">exp</font></b><font color="#990000">(-.</font><font color="#993399">25</font><font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          ret <font color="#990000">=</font> <b><font color="#000000">log_bilinear</font></b><font color="#990000">(</font>grid_value<font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               ret <font color="#990000">=</font> math<font color="#990000">.</font><b><font color="#000000">log</font></b><font color="#990000">(</font>ret<font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
          <b><font color="#0000FF">assert</font></b> False
     <i><font color="#9A1900">#</font></i>
     <b><font color="#0000FF">return</font></b> ret
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">example_db</font></b> <font color="#990000">(</font>file_name<font color="#990000">)</font> <font color="#990000">:</font>
     <i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># functions used for priors in smoothing</font></i>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># weight table has constant value 1.0</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_constant_one</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#993399">1.0</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># Note that there are no forward differences for covariate multiplier grids.</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_mulcov_sex</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b><font color="#990000">(</font><font color="#FF0000">'prior_sex'</font><font color="#990000">,</font>          None<font color="#990000">,</font> None<font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_mulcov_bmi</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b><font color="#990000">(</font><font color="#FF0000">'prior_bmi'</font><font color="#990000">,</font>         None<font color="#990000">,</font> None<font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_mulcov_ms_2000</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b><font color="#990000">(</font><font color="#FF0000">'prior_ms_2000'</font><font color="#990000">,</font>     None<font color="#990000">,</font> None<font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># priors used in smoothing for iota</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_iota_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font> <font color="#990000">\</font>
               <font color="#FF0000">'prior_pos_parent_value'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_time'</font><font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_iota_child</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_N(0,0.5)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_time'</font><font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># priors used in smoothing for chi</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_chi_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font> <font color="#990000">\</font>
               <font color="#FF0000">'prior_pos_parent_value'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_parent_time'</font><font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_chi_child</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_N(0,0.5)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_age'</font><font color="#990000">,</font> <font color="#FF0000">'prior_child_time'</font><font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># use const_value to constrain omega to true value</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_omega</font></b><font color="#990000">(</font>node<font color="#990000">)</font> <font color="#990000">:</font>
          <i><font color="#9A1900"># Use default argument to bind the value of node at point of</font></i>
          <i><font color="#9A1900"># definition instead of at point of call.</font></i>
          <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_omega_node</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">,</font> node <font color="#990000">=</font> node<font color="#990000">)</font> <font color="#990000">:</font>
               true_value <font color="#990000">=</font> <b><font color="#000000">true_rate</font></b><font color="#990000">(</font>node<font color="#990000">,</font> <font color="#FF0000">'omega'</font><font color="#990000">,</font> a<font color="#990000">,</font> t<font color="#990000">)</font>
               <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>true_value<font color="#990000">,</font> <font color="#FF0000">'prior_U(-inf,inf)'</font><font color="#990000">,</font> <font color="#FF0000">'prior_U(-inf,inf)'</font><font color="#990000">)</font>
          <b><font color="#0000FF">return</font></b> fun_omega_node
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># priors used in smoothing for pini</font></i>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_pini_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_pini_parent_value'</font><font color="#990000">,</font> None<font color="#990000">,</font> <font color="#FF0000">'prior_parent_time'</font><font color="#990000">)</font>
     <b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_pini_child</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
          <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_N(0,0.5)'</font><font color="#990000">,</font> None<font color="#990000">,</font> <font color="#FF0000">'prior_child_time'</font><font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     fun                       <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     fun<font color="#990000">[</font><font color="#FF0000">'mulcov_sex'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_mulcov_sex
     fun<font color="#990000">[</font><font color="#FF0000">'mulcov_bmi'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_mulcov_bmi
     fun<font color="#990000">[</font><font color="#FF0000">'mulcov_ms_2000'</font><font color="#990000">]</font>     <font color="#990000">=</font> fun_mulcov_ms_2000
     fun<font color="#990000">[</font><font color="#FF0000">'constant_one'</font><font color="#990000">]</font>       <font color="#990000">=</font> fun_constant_one
     fun<font color="#990000">[</font><font color="#FF0000">'iota_parent'</font><font color="#990000">]</font>        <font color="#990000">=</font> fun_iota_parent
     fun<font color="#990000">[</font><font color="#FF0000">'iota_child'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_iota_child
     fun<font color="#990000">[</font><font color="#FF0000">'chi_parent'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_chi_parent
     fun<font color="#990000">[</font><font color="#FF0000">'chi_child'</font><font color="#990000">]</font>          <font color="#990000">=</font> fun_chi_child
     fun<font color="#990000">[</font><font color="#FF0000">'pini_parent'</font><font color="#990000">]</font>        <font color="#990000">=</font> fun_pini_parent
     fun<font color="#990000">[</font><font color="#FF0000">'pini_child'</font><font color="#990000">]</font>         <font color="#990000">=</font> fun_pini_child
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># age_list, age_index_rate_parent, age_indexrate__child</font></i>
     start                     <font color="#990000">=</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     end                       <font color="#990000">=</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font>
     number                    <font color="#990000">=</font> parent_age_grid<font color="#990000">[</font><font color="#FF0000">'number'</font><font color="#990000">]</font>
     interval                  <font color="#990000">=</font> <font color="#990000">(</font>end <font color="#990000">-</font> start<font color="#990000">)</font> <font color="#990000">/</font> <font color="#990000">(</font>number <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font>
     age_list                  <font color="#990000">=</font> <font color="#990000">[</font> start <font color="#990000">+</font> j <font color="#990000">*</font> interval <b><font color="#0000FF">for</font></b> j <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font> <font color="#990000">]</font>
     age_index_rate_parent     <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font>
     age_index_rate_child      <font color="#990000">=</font> child_age_grid<font color="#990000">[</font><font color="#FF0000">'index'</font><font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># time_list, time_index_rate_parent, time_index_rate_child</font></i>
     start                  <font color="#990000">=</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'start'</font><font color="#990000">]</font>
     end                    <font color="#990000">=</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'end'</font><font color="#990000">]</font>
     number                 <font color="#990000">=</font> parent_time_grid<font color="#990000">[</font><font color="#FF0000">'number'</font><font color="#990000">]</font>
     interval               <font color="#990000">=</font> <font color="#990000">(</font>end <font color="#990000">-</font> start<font color="#990000">)</font> <font color="#990000">/</font> <font color="#990000">(</font>number <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font>
     time_list              <font color="#990000">=</font> <font color="#990000">[</font> start <font color="#990000">+</font> i <font color="#990000">*</font> interval <b><font color="#0000FF">for</font></b> i <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font> <font color="#990000">]</font>
     time_index_rate_parent <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font>number<font color="#990000">)</font>
     time_index_rate_child  <font color="#990000">=</font> child_time_grid<font color="#990000">[</font><font color="#FF0000">'index'</font><font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># node table:</font></i>
     parent_node <font color="#990000">=</font> node_list<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
     node_table <font color="#990000">=</font> <font color="#990000">[</font> <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font>parent_node<font color="#990000">,</font> <font color="#FF0000">'parent'</font><font color="#990000">:</font><font color="#FF0000">''</font> <font color="#990000">}</font> <font color="#990000">]</font>
     <b><font color="#0000FF">for</font></b> i <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font><font color="#993399">1</font><font color="#990000">,</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>node_list<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
          node_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font>node_list<font color="#990000">[</font>i<font color="#990000">],</font> <font color="#FF0000">'parent'</font><font color="#990000">:</font>parent_node <font color="#990000">}</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># weight table and weight_grid table:</font></i>
     name    <font color="#990000">=</font> <font color="#FF0000">'weight_constant'</font>
     weight_table <font color="#990000">=</font> <font color="#990000">[</font> <font color="#990000">{</font>
          <font color="#FF0000">'name'</font><font color="#990000">:</font>      <font color="#FF0000">'weight_constant'</font><font color="#990000">,</font>
          <font color="#FF0000">'age_id'</font><font color="#990000">:</font>    <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
          <font color="#FF0000">'time_id'</font><font color="#990000">:</font>   <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
          <font color="#FF0000">'fun'</font><font color="#990000">:</font>       fun<font color="#990000">[</font><font color="#FF0000">'constant_one'</font><font color="#990000">]</font>
     <font color="#990000">}</font> <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># prior_table</font></i>
     prior_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_N(0,0.5)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_N(0,0.5)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      math<font color="#990000">.</font><b><font color="#000000">sqrt</font></b><font color="#990000">(</font><font color="#993399">0.5</font><font color="#990000">),</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_U(-inf,inf)</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_U(-inf,inf)'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_pini_parent_value</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_pini_parent_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.1</font><font color="#990000">,</font>  <i><font color="#9A1900"># setting start_var table so mean has no affect</font></i>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">1.0</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font> <i><font color="#9A1900"># used for log-scaling during optimization</font></i>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_pos_parent_value</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_pos_parent_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.1</font><font color="#990000">,</font> <i><font color="#9A1900"># setting start_var table so mean has no affect</font></i>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">1e-8</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">1.0</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">0.0</font><font color="#990000">,</font> <i><font color="#9A1900"># used for log-scaling during optimization</font></i>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_parent_age</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_parent_age'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      parent_age_grid<font color="#990000">[</font><font color="#FF0000">'std'</font><font color="#990000">],</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_parent_time</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_parent_time'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      parent_time_grid<font color="#990000">[</font><font color="#FF0000">'std'</font><font color="#990000">],</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_child_age</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_child_age'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      child_age_grid<font color="#990000">[</font><font color="#FF0000">'std'</font><font color="#990000">],</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_child_time</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_child_time'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      child_time_grid<font color="#990000">[</font><font color="#FF0000">'std'</font><font color="#990000">],</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-5</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_sex</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_sex'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#990000">-</font><font color="#993399">2.0</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#990000">+</font><font color="#993399">2.0</font><font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_bmi</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_bmi'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#990000">-</font><font color="#993399">0.1</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#990000">+</font><font color="#993399">0.1</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># prior_ms_2000</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_ms_2000'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'uniform'</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#990000">-</font><font color="#993399">1.0</font><font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#990000">+</font><font color="#993399">1.0</font><font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># smooth table and nslist_table</font></i>
     smooth_table   <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     nslist_table   <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># smooth_mulcov</font></i>
     <b><font color="#0000FF">for</font></b> cov <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'sex'</font><font color="#990000">,</font> <font color="#FF0000">'bmi'</font><font color="#990000">,</font> <font color="#FF0000">'ms_2000'</font> <font color="#990000">]</font> <font color="#990000">:</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'smooth_mulcov_'</font> <font color="#990000">+</font> cov<font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>   <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>  <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>      fun<font color="#990000">[</font><font color="#FF0000">'mulcov_'</font> <font color="#990000">+</font> cov<font color="#990000">]</font>
          <font color="#990000">}</font> <font color="#990000">)</font>
     <b><font color="#0000FF">for</font></b> rate <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'pini'</font><font color="#990000">,</font> <font color="#FF0000">'iota'</font><font color="#990000">,</font> <font color="#FF0000">'chi'</font> <font color="#990000">]</font> <font color="#990000">:</font>
          age_index <font color="#990000">=</font> age_index_rate_parent
          <b><font color="#0000FF">if</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'pini'</font> <font color="#990000">:</font>
               age_index <font color="#990000">=</font> <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># smooth_rate_parent</font></i>
          name <font color="#990000">=</font> rate <font color="#990000">+</font> <font color="#FF0000">'_parent'</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>        <font color="#FF0000">'smooth_'</font> <font color="#990000">+</font> name        <font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>       age_index              <font color="#990000">,</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>      time_index_rate_parent <font color="#990000">,</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>          fun<font color="#990000">[</font>name<font color="#990000">]</font>
          <font color="#990000">}</font> <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          age_index <font color="#990000">=</font> age_index_rate_child
          <b><font color="#0000FF">if</font></b> rate <font color="#990000">==</font> <font color="#FF0000">'pini'</font> <font color="#990000">:</font>
               age_index <font color="#990000">=</font> <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># smooth_rate_child</font></i>
          name <font color="#990000">=</font> rate <font color="#990000">+</font> <font color="#FF0000">'_child'</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>        <font color="#FF0000">'smooth_'</font> <font color="#990000">+</font> name       <font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>       age_index             <font color="#990000">,</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>      time_index_rate_child <font color="#990000">,</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>          fun<font color="#990000">[</font>name<font color="#990000">]</font>
          <font color="#990000">}</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     nslist_table<font color="#990000">[</font><font color="#FF0000">'nslist_omega_child'</font><font color="#990000">]</font> <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">for</font></b> node <b><font color="#0000FF">in</font></b> node_list <font color="#990000">:</font>
          name                 <font color="#990000">=</font> <font color="#FF0000">'smooth_omega_'</font> <font color="#990000">+</font> node
          smoothing            <font color="#990000">=</font> <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font> name <font color="#990000">}</font>
          smoothing<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font>  <font color="#990000">=</font> age_index_rate_parent
          smoothing<font color="#990000">[</font><font color="#FF0000">'time_id'</font><font color="#990000">]</font> <font color="#990000">=</font> time_index_rate_parent
          smoothing<font color="#990000">[</font><font color="#FF0000">'fun'</font><font color="#990000">]</font>     <font color="#990000">=</font> <b><font color="#000000">fun_omega</font></b><font color="#990000">(</font>node<font color="#990000">)</font>
          smooth_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> smoothing <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          <b><font color="#0000FF">if</font></b> node <font color="#990000">!=</font> parent_node <font color="#990000">:</font>
               nslist_table<font color="#990000">[</font><font color="#FF0000">'nslist_omega_child'</font><font color="#990000">].</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">(</font>node<font color="#990000">,</font> name<font color="#990000">)</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># no standard deviation multipliers</font></i>
     <b><font color="#0000FF">for</font></b> dictionary <b><font color="#0000FF">in</font></b> smooth_table <font color="#990000">:</font>
          <b><font color="#0000FF">for</font></b> name <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'value'</font> <font color="#990000">,</font> <font color="#FF0000">'dage'</font><font color="#990000">,</font> <font color="#FF0000">'dtime'</font> <font color="#990000">]</font> <font color="#990000">:</font>
               key   <font color="#990000">=</font> <font color="#FF0000">'mulstd_'</font> <font color="#990000">+</font> name <font color="#990000">+</font> <font color="#FF0000">'_prior_name'</font>
               value <font color="#990000">=</font> None
               dictionary<font color="#990000">[</font>key<font color="#990000">]</font> <font color="#990000">=</font> value
     <i><font color="#9A1900"># -----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># covariate table:</font></i>
     covariate_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'sex'</font><font color="#990000">,</font>     <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font><font color="#993399">0.6</font>  <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'bmi'</font><font color="#990000">,</font>     <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">27.0</font><font color="#990000">,</font> <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
          <font color="#990000">{</font><font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'ms_2000'</font><font color="#990000">,</font> <font color="#FF0000">'reference'</font><font color="#990000">:</font><font color="#993399">0.0</font><font color="#990000">,</font>  <font color="#FF0000">'max_difference'</font><font color="#990000">:</font>None <font color="#990000">}</font> <font color="#990000">,</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># mulcov table:</font></i>
     mulcov_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font>
               <i><font color="#9A1900"># alpha for iota and sex</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'sex'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'rate_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_sex'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># alpha for iota and bmi</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'bmi'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'rate_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_bmi'</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <i><font color="#9A1900"># beta for prevalence and ms_2000</font></i>
               <font color="#FF0000">'covariate'</font><font color="#990000">:</font> <font color="#FF0000">'ms_2000'</font><font color="#990000">,</font>
               <font color="#FF0000">'type'</font><font color="#990000">:</font>      <font color="#FF0000">'meas_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'effected'</font><font color="#990000">:</font>  <font color="#FF0000">'prevalence'</font><font color="#990000">,</font>
               <font color="#FF0000">'smooth'</font><font color="#990000">:</font>    <font color="#FF0000">'smooth_mulcov_ms_2000'</font>
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># rate table:</font></i>
     rate_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font>    <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'pini'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_pini_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  <font color="#FF0000">'smooth_pini_child'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_iota_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  <font color="#FF0000">'smooth_iota_child'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'rho'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> None<font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'chi'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_chi_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  <font color="#FF0000">'smooth_chi_child'</font><font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
          <font color="#990000">}</font> <font color="#990000">,</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'omega'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_omega_'</font> <font color="#990000">+</font> parent_node<font color="#990000">,</font>
               <font color="#FF0000">'child_smooth'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
               <font color="#FF0000">'child_nslist'</font><font color="#990000">:</font>  <font color="#FF0000">'nslist_omega_child'</font><font color="#990000">,</font>
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># data table, avgint_table:</font></i>
     data_table   <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     avgint_table <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># for each integrand, age, time, node</font></i>
     n_integrand <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>integrand_table<font color="#990000">)</font>
     n_age       <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>age_list<font color="#990000">)</font>
     n_time      <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>time_list<font color="#990000">)</font>
     n_node      <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>node_table<font color="#990000">)</font>
     <b><font color="#0000FF">for</font></b> k1 <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font>n_integrand <font color="#990000">*</font> n_age <font color="#990000">*</font> n_time <font color="#990000">*</font> n_node <font color="#990000">*</font> meas_repeat<font color="#990000">)</font> <font color="#990000">:</font>
          den         <font color="#990000">=</font> n_age <font color="#990000">*</font> n_time <font color="#990000">*</font> n_node <font color="#990000">*</font> meas_repeat
          i_integrand <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k1 <font color="#990000">/</font> den <font color="#990000">)</font>
          k2          <font color="#990000">=</font>      k1 <font color="#990000">%</font> den
          <i><font color="#9A1900">#</font></i>
          den         <font color="#990000">=</font> n_time <font color="#990000">*</font> n_node <font color="#990000">*</font> meas_repeat
          i_age       <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k2 <font color="#990000">/</font> den <font color="#990000">)</font>
          k3          <font color="#990000">=</font>      k2 <font color="#990000">%</font> den
          <i><font color="#9A1900">#</font></i>
          den         <font color="#990000">=</font> n_node <font color="#990000">*</font> meas_repeat
          i_time      <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k3 <font color="#990000">/</font> den <font color="#990000">)</font>
          k4          <font color="#990000">=</font>      k3 <font color="#990000">%</font> den
          <i><font color="#9A1900">#</font></i>
          den         <font color="#990000">=</font> meas_repeat
          i_node      <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> k4 <font color="#990000">/</font> den <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          age         <font color="#990000">=</font> age_list<font color="#990000">[</font>i_age<font color="#990000">]</font>
          time        <font color="#990000">=</font> time_list<font color="#990000">[</font>i_time<font color="#990000">]</font>
          integrand   <font color="#990000">=</font> integrand_table<font color="#990000">[</font>i_integrand<font color="#990000">][</font><font color="#FF0000">'name'</font><font color="#990000">]</font>
          node        <font color="#990000">=</font> node_table<font color="#990000">[</font>i_node<font color="#990000">][</font><font color="#FF0000">'name'</font><font color="#990000">]</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># sex</font></i>
          <b><font color="#0000FF">if</font></b> k1 <font color="#990000">%</font> <font color="#993399">2</font> <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">:</font>
               sex <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">0.5</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               sex <font color="#990000">=</font> <font color="#990000">+</font><font color="#993399">0.5</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># market scan</font></i>
          <b><font color="#0000FF">if</font></b> k1 <font color="#990000">%</font> <font color="#993399">6</font> <font color="#990000">&lt;</font> <font color="#993399">3</font> <font color="#990000">:</font>
               ms_2000 <font color="#990000">=</font> <font color="#993399">1.0</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               ms_2000 <font color="#990000">=</font> <font color="#993399">0.0</font>
          <i><font color="#9A1900">#</font></i>
          <i><font color="#9A1900"># body mass index</font></i>
          bmi <font color="#990000">=</font> <font color="#993399">20</font> <font color="#990000">+</font> k1 <font color="#990000">%</font> <font color="#993399">17</font>
          <i><font color="#9A1900">#</font></i>
          row <font color="#990000">=</font> <font color="#990000">{</font>
               <font color="#FF0000">'node'</font><font color="#990000">:</font>        node<font color="#990000">,</font>
               <font color="#FF0000">'integrand'</font><font color="#990000">:</font>   integrand<font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>     <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'weight'</font><font color="#990000">:</font>      <font color="#FF0000">'weight_constant'</font><font color="#990000">,</font>
               <font color="#FF0000">'age_lower'</font><font color="#990000">:</font>    age<font color="#990000">,</font>
               <font color="#FF0000">'age_upper'</font><font color="#990000">:</font>    age<font color="#990000">,</font>
               <font color="#FF0000">'time_lower'</font><font color="#990000">:</font>   time<font color="#990000">,</font>
               <font color="#FF0000">'time_upper'</font><font color="#990000">:</font>   time<font color="#990000">,</font>
               <font color="#FF0000">'sex'</font><font color="#990000">:</font>          sex<font color="#990000">,</font>
               <font color="#FF0000">'ms_2000'</font><font color="#990000">:</font>      ms_2000<font color="#990000">,</font>
               <font color="#FF0000">'bmi'</font><font color="#990000">:</font>          bmi<font color="#990000">,</font>
               <font color="#FF0000">'one'</font><font color="#990000">:</font>          <font color="#993399">1</font><font color="#990000">,</font>
          <font color="#990000">}</font>
          avgint_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> copy<font color="#990000">.</font><b><font color="#000000">copy</font></b><font color="#990000">(</font>row<font color="#990000">)</font> <font color="#990000">)</font>
          <i><font color="#9A1900">#</font></i>
          <b><font color="#0000FF">if</font></b> i_age <font color="#990000">&gt;</font> <font color="#993399">0</font> <b><font color="#0000FF">and</font></b> i_time <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">:</font>
               age  <font color="#990000">=</font> <font color="#990000">(</font>age_list<font color="#990000">[</font>i_age<font color="#990000">]</font>   <font color="#990000">+</font> age_list<font color="#990000">[</font>i_age<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">])</font>   <font color="#990000">/</font> <font color="#993399">2.0</font>
               time <font color="#990000">=</font> <font color="#990000">(</font>time_list<font color="#990000">[</font>i_time<font color="#990000">]</font> <font color="#990000">+</font> time_list<font color="#990000">[</font>i_time<font color="#990000">-</font><font color="#993399">1</font><font color="#990000">])</font> <font color="#990000">/</font> <font color="#993399">2.0</font>
          row <font color="#990000">=</font> <font color="#990000">{</font>
               <font color="#FF0000">'node'</font><font color="#990000">:</font>        node<font color="#990000">,</font>
               <font color="#FF0000">'integrand'</font><font color="#990000">:</font>   integrand<font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>     <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'weight'</font><font color="#990000">:</font>      <font color="#FF0000">'weight_constant'</font><font color="#990000">,</font>
               <font color="#FF0000">'age_lower'</font><font color="#990000">:</font>    age<font color="#990000">,</font>
               <font color="#FF0000">'age_upper'</font><font color="#990000">:</font>    age<font color="#990000">,</font>
               <font color="#FF0000">'time_lower'</font><font color="#990000">:</font>   time<font color="#990000">,</font>
               <font color="#FF0000">'time_upper'</font><font color="#990000">:</font>   time<font color="#990000">,</font>
               <font color="#FF0000">'sex'</font><font color="#990000">:</font>          sex<font color="#990000">,</font>
               <font color="#FF0000">'ms_2000'</font><font color="#990000">:</font>      ms_2000<font color="#990000">,</font>
               <font color="#FF0000">'bmi'</font><font color="#990000">:</font>          bmi<font color="#990000">,</font>
               <font color="#FF0000">'one'</font><font color="#990000">:</font>          <font color="#993399">1</font><font color="#990000">,</font>
          <font color="#990000">}</font>
          avgint_table<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> copy<font color="#990000">.</font><b><font color="#000000">copy</font></b><font color="#990000">(</font>row<font color="#990000">)</font> <font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># option_table</font></i>
     option_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'rate_case'</font><font color="#990000">,</font>              <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'iota_pos_rho_zero'</font>    <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'parent_node_name'</font><font color="#990000">,</font>       <font color="#FF0000">'value'</font><font color="#990000">:</font>parent_node            <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'ode_step_size'</font><font color="#990000">,</font>          <font color="#FF0000">'value'</font><font color="#990000">:</font>ode_step_size          <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'random_seed'</font><font color="#990000">,</font>            <font color="#FF0000">'value'</font><font color="#990000">:</font>random_seed            <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'bound_random'</font><font color="#990000">,</font>           <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'1.0'</font>                  <font color="#990000">},</font>

          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'quasi_fixed'</font><font color="#990000">,</font>            <font color="#FF0000">'value'</font><font color="#990000">:</font>quasi_fixed            <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'max_num_iter_fixed'</font><font color="#990000">,</font>     <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'300'</font>                  <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'print_level_fixed'</font><font color="#990000">,</font>      <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'5'</font>                    <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'tolerance_fixed'</font><font color="#990000">,</font>        <font color="#FF0000">'value'</font><font color="#990000">:</font>tolerance_fixed        <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'derivative_test_fixed'</font><font color="#990000">,</font>  <font color="#FF0000">'value'</font><font color="#990000">:</font>derivative_test_fixed  <font color="#990000">},</font>

          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'max_num_iter_random'</font><font color="#990000">,</font>    <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'50'</font>                   <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'print_level_random'</font><font color="#990000">,</font>     <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'0'</font>                    <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'tolerance_random'</font><font color="#990000">,</font>       <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'1e-8'</font>                 <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># create database</font></i>
     dismod_at<font color="#990000">.</font><b><font color="#000000">create_database</font></b><font color="#990000">(</font>
          file_name<font color="#990000">,</font>
          age_list<font color="#990000">,</font>
          time_list<font color="#990000">,</font>
          integrand_table<font color="#990000">,</font>
          node_table<font color="#990000">,</font>
          weight_table<font color="#990000">,</font>
          covariate_table<font color="#990000">,</font>
          avgint_table<font color="#990000">,</font>
          data_table<font color="#990000">,</font>
          prior_table<font color="#990000">,</font>
          smooth_table<font color="#990000">,</font>
          nslist_table<font color="#990000">,</font>
          rate_table<font color="#990000">,</font>
          mulcov_table<font color="#990000">,</font>
          option_table
     <font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <b><font color="#0000FF">return</font></b>
<i><font color="#9A1900"># -----------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">create_truth_var_table</font></b><font color="#990000">()</font> <font color="#990000">:</font>
     new             <font color="#990000">=</font> False
     connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
     var_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
     rate_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'rate'</font><font color="#990000">)</font>
     covariate_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'covariate'</font><font color="#990000">)</font>
     integrand_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'integrand'</font><font color="#990000">)</font>
     node_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'node'</font><font color="#990000">)</font>
     time_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'time'</font><font color="#990000">)</font>
     age_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'age'</font><font color="#990000">)</font>
     <i><font color="#9A1900"># -------------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># create truth table</font></i>
     tbl_name     <font color="#990000">=</font> <font color="#FF0000">'truth_var'</font>
     col_name     <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'truth_var_value'</font> <font color="#990000">]</font>
     col_type     <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'real'</font> <font color="#990000">]</font>
     row_list     <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>var_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
          value <font color="#990000">=</font> None
          <i><font color="#9A1900">#</font></i>
          row          <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">]</font>
          var_type     <font color="#990000">=</font> row<font color="#990000">[</font><font color="#FF0000">'var_type'</font><font color="#990000">]</font>
          age          <font color="#990000">=</font> age_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'age'</font><font color="#990000">]</font>
          time         <font color="#990000">=</font> time_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'time_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'time'</font><font color="#990000">]</font>
          <b><font color="#0000FF">if</font></b> var_type<font color="#990000">.</font><b><font color="#000000">startswith</font></b><font color="#990000">(</font><font color="#FF0000">'mulcov_'</font><font color="#990000">)</font> <font color="#990000">:</font>
               covariate <font color="#990000">=</font> covariate_table<font color="#990000">[</font>row<font color="#990000">[</font><font color="#FF0000">'covariate_id'</font> <font color="#990000">]][</font><font color="#FF0000">'covariate_name'</font><font color="#990000">]</font>
               value     <font color="#990000">=</font> mulcov_dict<font color="#990000">[</font>covariate<font color="#990000">]</font>
          <b><font color="#0000FF">elif</font></b> var_type <font color="#990000">==</font> <font color="#FF0000">'rate'</font> <font color="#990000">:</font>
               node  <font color="#990000">=</font> node_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'node_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'node_name'</font><font color="#990000">]</font>
               rate  <font color="#990000">=</font> rate_table<font color="#990000">[</font> row<font color="#990000">[</font><font color="#FF0000">'rate_id'</font><font color="#990000">]</font> <font color="#990000">]</font> <font color="#990000">[</font><font color="#FF0000">'rate_name'</font><font color="#990000">]</font>
               value <font color="#990000">=</font> <b><font color="#000000">true_rate</font></b><font color="#990000">(</font>node<font color="#990000">,</font> rate<font color="#990000">,</font> age<font color="#990000">,</font> time<font color="#990000">)</font>
          <b><font color="#0000FF">else</font></b> <font color="#990000">:</font>
               <b><font color="#0000FF">assert</font></b> False
          <i><font color="#9A1900">#</font></i>
          row_list<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">[</font> value <font color="#990000">]</font> <font color="#990000">)</font>
     dismod_at<font color="#990000">.</font><b><font color="#000000">create_table</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">,</font> col_name<font color="#990000">,</font> col_type<font color="#990000">,</font> row_list<font color="#990000">)</font>
     connection<font color="#990000">.</font><b><font color="#000000">close</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">return</font></b>
<i><font color="#9A1900"># ===========================================================================</font></i>
<i><font color="#9A1900"># Run the init command to create the var table</font></i>
file_name      <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
<b><font color="#000000">example_db</font></b><font color="#990000">(</font>file_name<font color="#990000">)</font>
program        <font color="#990000">=</font> <font color="#FF0000">'../../devel/dismod_at'</font>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'init'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at init command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># create truth_var table</font></i>
<b><font color="#000000">create_truth_var_table</font></b><font color="#990000">()</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># create predict table</font></i>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'predict'</font><font color="#990000">,</font> <font color="#FF0000">'truth_var'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at predict command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># add data to data table</font></i>
new             <font color="#990000">=</font> False
connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
predict_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'predict'</font><font color="#990000">)</font>
avgint_table    <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'avgint'</font><font color="#990000">)</font>
density_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'density'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># get column names and types for data table</font></i>
tbl_name             <font color="#990000">=</font> <font color="#FF0000">'data'</font>
<font color="#990000">(</font>col_name<font color="#990000">,</font> col_type<font color="#990000">)</font> <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_name_type</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># remove the primary key from col_name and col_type</font></i>
<b><font color="#0000FF">assert</font></b> col_name<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#FF0000">'data_id'</font>
<b><font color="#0000FF">del</font></b> col_name<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
<b><font color="#0000FF">del</font></b> col_type<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># list of row values to place in data table</font></i>
row_list <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># density_id for log_gaussian</font></i>
density_id <font color="#990000">=</font> None
<b><font color="#0000FF">for</font></b> i <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> density_table <font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     <b><font color="#0000FF">if</font></b> density_table<font color="#990000">[</font>i<font color="#990000">][</font><font color="#FF0000">'density_name'</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#FF0000">'log_gaussian'</font> <font color="#990000">:</font>
          density_id <font color="#990000">=</font> i
<i><font color="#9A1900">#</font></i>
<b><font color="#0000FF">for</font></b> predict_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>predict_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># get prediction for average integrand</font></i>
     row <font color="#990000">=</font> predict_table<font color="#990000">[</font>predict_id<font color="#990000">]</font>
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'sample_index'</font><font color="#990000">]</font> <font color="#990000">==</font> None
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'avgint_id'</font><font color="#990000">]</font>    <font color="#990000">==</font> predict_id
     avg_integrand <font color="#990000">=</font> row<font color="#990000">[</font><font color="#FF0000">'avg_integrand'</font><font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># initial row using information in avgint table</font></i>
     row <font color="#990000">=</font> copy<font color="#990000">.</font><b><font color="#000000">copy</font></b><font color="#990000">(</font> avgint_table<font color="#990000">[</font>predict_id<font color="#990000">]</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># add information, that is not in avgint_table, to row</font></i>
     eta        <font color="#990000">=</font> <font color="#993399">1e-7</font>                     <i><font color="#9A1900"># a very small eta</font></i>
     meas_value <font color="#990000">=</font> avg_integrand            <i><font color="#9A1900"># no noise version of meas_value</font></i>
     meas_std   <font color="#990000">=</font> meas_cv <font color="#990000">*</font> avg_integrand <i><font color="#9A1900"># noise in simulated data</font></i>
     row<font color="#990000">[</font><font color="#FF0000">'density_id'</font><font color="#990000">]</font> <font color="#990000">=</font> density_id
     row<font color="#990000">[</font><font color="#FF0000">'hold_out'</font><font color="#990000">]</font>   <font color="#990000">=</font> <font color="#993399">0</font>
     row<font color="#990000">[</font><font color="#FF0000">'meas_std'</font><font color="#990000">]</font>   <font color="#990000">=</font> meas_std
     row<font color="#990000">[</font><font color="#FF0000">'meas_value'</font><font color="#990000">]</font> <font color="#990000">=</font> meas_value
     row<font color="#990000">[</font><font color="#FF0000">'eta'</font><font color="#990000">]</font>        <font color="#990000">=</font> eta
     row<font color="#990000">[</font><font color="#FF0000">'nu'</font><font color="#990000">]</font>         <font color="#990000">=</font> None
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># values in same order as col_name</font></i>
     row_value <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <b><font color="#0000FF">for</font></b> key <b><font color="#0000FF">in</font></b> col_name <font color="#990000">:</font>
          <b><font color="#0000FF">if</font></b> key <font color="#990000">!=</font> <font color="#FF0000">'data_id'</font> <font color="#990000">:</font>
               row_value<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> row<font color="#990000">[</font>key<font color="#990000">]</font> <font color="#990000">)</font>
     <i><font color="#9A1900">#</font></i>
     row_list<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> row_value <font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># drop the old data table</font></i>
command <font color="#990000">=</font> <font color="#FF0000">'DROP TABLE data'</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">sql_command</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> command<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># create the new data table</font></i>
dismod_at<font color="#990000">.</font><b><font color="#000000">create_table</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">,</font> col_name<font color="#990000">,</font> col_type<font color="#990000">,</font> row_list <font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># re-initailize to get data_subset table to correspond to new data</font></i>
file_name      <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
program        <font color="#990000">=</font> <font color="#FF0000">'../../devel/dismod_at'</font>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'init'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at init command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Initializing erases the truth_var table.</font></i>
<i><font color="#9A1900"># Create a new version of truth_var table that will correspond to fit</font></i>
<b><font color="#000000">create_truth_var_table</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># drop the start_var table created by init</font></i>
new             <font color="#990000">=</font> False
connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
command <font color="#990000">=</font> <font color="#FF0000">'DROP TABLE start_var'</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">sql_command</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> command<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># create new start_var table</font></i>
rate_table      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'rate'</font><font color="#990000">)</font>
var_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
truth_var_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'truth_var'</font><font color="#990000">)</font>
tbl_name        <font color="#990000">=</font> <font color="#FF0000">'start_var'</font>
col_name        <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'start_var_value'</font> <font color="#990000">]</font>
col_type        <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">'real'</font> <font color="#990000">]</font>
row_list        <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
<b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>var_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     truth_var_value  <font color="#990000">=</font> truth_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'truth_var_value'</font><font color="#990000">]</font>
     var_type         <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'var_type'</font><font color="#990000">]</font>
     rate_id          <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'rate_id'</font><font color="#990000">]</font>
     start_var_value  <font color="#990000">=</font> truth2start <font color="#990000">*</font> truth_var_value
     <b><font color="#0000FF">if</font></b> var_type <font color="#990000">==</font> <font color="#FF0000">'rate'</font> <font color="#990000">:</font>
               <b><font color="#0000FF">if</font></b> rate_table<font color="#990000">[</font>rate_id<font color="#990000">][</font><font color="#FF0000">'rate_name'</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#FF0000">'omega'</font> <font color="#990000">:</font>
                    start_var_value  <font color="#990000">=</font> truth_var_value
     row_list<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font> <font color="#990000">[</font>start_var_value<font color="#990000">]</font> <font color="#990000">)</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">create_table</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> tbl_name<font color="#990000">,</font> col_name<font color="#990000">,</font> col_type<font color="#990000">,</font> row_list<font color="#990000">)</font>
connection<font color="#990000">.</font><b><font color="#000000">close</font></b><font color="#990000">()</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># copy start_var table to scale_var table</font></i>
cmd <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'set'</font> <font color="#990000">,</font> <font color="#FF0000">'scale_var'</font><font color="#990000">,</font> <font color="#FF0000">'start_var'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at set command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Simulate a data set corresponding to the truth</font></i>
number_simulate <font color="#990000">=</font> <font color="#FF0000">'1'</font>
cmd             <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'simulate'</font><font color="#990000">,</font> number_simulate <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at simulate command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Do a fit with no random effects</font></i>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'fit'</font><font color="#990000">,</font> <font color="#FF0000">'fixed'</font> <font color="#990000">]</font>
<b><font color="#0000FF">if</font></b> fit_with_noise_in_data <font color="#990000">:</font>
     simulate_index <font color="#990000">=</font> <font color="#FF0000">'0'</font>
     cmd <font color="#990000">+=</font> <font color="#990000">[</font> simulate_index <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at fit command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># copy fit_var table to start_var table</font></i>
cmd <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'set'</font> <font color="#990000">,</font> <font color="#FF0000">'start_var'</font><font color="#990000">,</font> <font color="#FF0000">'fit_var'</font> <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at set command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Do a fit with random effects</font></i>
cmd            <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> <font color="#FF0000">'fit'</font><font color="#990000">,</font> <font color="#FF0000">'both'</font> <font color="#990000">]</font>
<b><font color="#0000FF">if</font></b> fit_with_noise_in_data <font color="#990000">:</font>
     simulate_index <font color="#990000">=</font> <font color="#FF0000">'0'</font>
     cmd <font color="#990000">+=</font> <font color="#990000">[</font> simulate_index <font color="#990000">]</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
<b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at fit command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<i><font color="#9A1900"># compare truth and fit</font></i>
file_name      <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
new             <font color="#990000">=</font> False
connection      <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
var_table       <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
truth_var_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'truth_var'</font><font color="#990000">)</font>
fit_var_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'fit_var'</font><font color="#990000">)</font>
ok              <font color="#990000">=</font> True
max_err         <font color="#990000">=</font> <font color="#993399">0.0</font>
<b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font>var_table<font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     truth_var_value <font color="#990000">=</font> truth_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'truth_var_value'</font><font color="#990000">]</font>
     fit_var_value   <font color="#990000">=</font> fit_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'fit_var_value'</font><font color="#990000">]</font>
     <b><font color="#0000FF">if</font></b> truth_var_value <font color="#990000">!=</font> <font color="#993399">0.0</font> <font color="#990000">:</font>
          rel_err <font color="#990000">=</font> fit_var_value <font color="#990000">/</font> truth_var_value <font color="#990000">-</font> <font color="#993399">1.0</font>
          flag    <font color="#990000">=</font> <b><font color="#000000">abs</font></b><font color="#990000">(</font> rel_err <font color="#990000">)</font> <font color="#990000">&lt;=</font> accept_rel_err
          ok     <font color="#990000">&amp;=</font> flag
          <b><font color="#0000FF">if</font></b> <b><font color="#0000FF">not</font></b> flag <font color="#990000">:</font>
               <b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'var_id = '</font><font color="#990000">,</font> var_id<font color="#990000">,</font> <font color="#FF0000">', rel_err = '</font><font color="#990000">,</font> rel_err<font color="#990000">)</font>
          max_err <font color="#990000">=</font> <b><font color="#000000">max</font></b><font color="#990000">(</font> max_err<font color="#990000">,</font> <b><font color="#000000">abs</font></b><font color="#990000">(</font>rel_err<font color="#990000">)</font> <font color="#990000">)</font>
<b><font color="#0000FF">assert</font></b> ok
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'max_err = '</font><font color="#990000">,</font> max_err <font color="#990000">)</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'elapsed seconds = '</font><font color="#990000">,</font> time<font color="#990000">.</font><b><font color="#000000">time</font></b><font color="#990000">()</font> <font color="#990000">-</font> start_second<font color="#990000">)</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'diabetes.py: OK'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i></tt></pre>

<hr>Input File: example/user/diabetes.py

</body>
</html>
