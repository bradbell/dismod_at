<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>Remove an Age or Time From a Smoothing</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="Remove an Age or Time From a Smoothing">
<meta name="keywords" id="keywords" content=" remove age time from smoothing purpose table parent value prior difference change fit source code ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_user_change_grid.py_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://bradbell.github.io/dismod_at" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Location-&gt;</option>
<option>dismod_at</option>
<option>user</option>
<option>user_change_grid.py</option>
</select>
</td>
<td>
<select onchange='choose_across0(this)'>
<option>Search-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td><a href="user_jump_at_age.py.htm" target="_top">Prev</a>
</td><td><a href="user_asymptotic.py.htm" target="_top">Next</a>
</td><td>
<script type='text/javascript' language='JavaScript' src='_childtable_dismod_at_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_user_htm.js'></script>
</td>
<td>user_change_grid.py</td>
</tr></table><br>
@(@\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@<center><b><big><big>Remove an Age or Time From a Smoothing</big></big></b></center>

<br><a href="user_change_grid.py.htm#Purpose" target="_top">Purpose</a>
<br><a href="user_change_grid.py.htm#Age Table" target="_top">Age&nbsp;Table</a>
<br><a href="user_change_grid.py.htm#Time Table" target="_top">Time&nbsp;Table</a>
<br><a href="user_change_grid.py.htm#Parent Smoothing" target="_top">Parent&nbsp;Smoothing</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_change_grid.py.htm#Parent Smoothing.Value Prior" target="_top">Value&nbsp;Prior</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="user_change_grid.py.htm#Parent Smoothing.Difference Prior" target="_top">Difference&nbsp;Prior</a>
<br><a href="user_change_grid.py.htm#Change Parent Smoothing" target="_top">Change&nbsp;Parent&nbsp;Smoothing</a>
<br><a href="user_change_grid.py.htm#Fit" target="_top">Fit</a>
<br><a href="user_change_grid.py.htm#Source Code" target="_top">Source&nbsp;Code</a>
<br><br>
<b><big><a name="Purpose" id="Purpose">Purpose</a></big></b>
<br>
This examples uses SQL commands to modify a data base.
To be specific, it removes one of the age points from a smoothing grid.

<br>
<br>
<b><big><a name="Age Table" id="Age Table">Age Table</a></big></b>
<br>
The <a href="age_table.htm" target="_top"><span style='white-space: nowrap'>age_table</span></a>
 for this example is specified by the code
<code><font color='blue'><pre style='display:inline'> 
     age_list = [0, 1, 20, 30, 40, 50, 60, 70, 80, 90, 100 ]
</pre></font></code>
<br>
<b><big><a name="Time Table" id="Time Table">Time Table</a></big></b>
<br>
The <a href="time_table.htm" target="_top"><span style='white-space: nowrap'>time_table</span></a>
 is specified by
<code><font color='blue'><pre style='display:inline'> 
     time_list = [ 1960, 1995 ]
</pre></font></code>
<br>
<b><big><a name="Parent Smoothing" id="Parent Smoothing">Parent Smoothing</a></big></b>
<br>
The original parent smoothing table contains all of the age and time points.

<br>
<br>
<big><a name="Parent Smoothing.Value Prior" id="Parent Smoothing.Value Prior">Value Prior</a></big>
<br>
The value prior at each (age, time) pair is log-Gaussian with
lower limit 
<code><font color="blue"><span style='white-space: nowrap'>1e-2*</span></font><i><font color="black"><span style='white-space: nowrap'>iota_mean</span></font></i></code>
,
upper limit 
<code><i><font color="black"><span style='white-space: nowrap'>1e+2*</span></font></i><font color="blue"><span style='white-space: nowrap'>iota_mean</span></font></code>
,
mean 
<code><i><font color="black"><span style='white-space: nowrap'>iota&nbsp;mean</span></font></i></code>
,
standard deviation 
<code><i><font color="black"><span style='white-space: nowrap'>iota_mean</span></font></i></code>
,
and the offset in the log transform 
<code><font color="blue"><span style='white-space: nowrap'>1e-3*</span></font><i><font color="black"><span style='white-space: nowrap'>iota_mean</span></font></i></code>
.

<br>
<br>
<big><a name="Parent Smoothing.Difference Prior" id="Parent Smoothing.Difference Prior">Difference Prior</a></big>
<br>
The forward difference prior at each (age, time) pair is log-Gaussian with
no lower limit,
no upper limit,
mean zero,
standard deviation 
<code><i><font color="black"><span style='white-space: nowrap'>1.0</span></font></i></code>
,
and the offset in the log transform <code><font color="blue">1e-6</font></code>.

<br>
<br>
<b><big><a name="Change Parent Smoothing" id="Change Parent Smoothing">Change Parent Smoothing</a></big></b>
<br>
Note that the original age grid has 11 points.
The last age point, and all the corresponding (age, time) pairs
are removed from the smoothing grid with the following SQL commands:
<code><font color='blue'><pre style='display:inline'> 
     UPDATE smooth SET n_age = 10 WHERE smooth_id == 0;
     UPDATE smooth_grid SET smooth_id = WHERE smooth_id == 0 AND age_id == 10;
</pre></font></code>
We refer to this as the modified smoothing.

<br>
<br>
<b><big><a name="Fit" id="Fit">Fit</a></big></b>
<br>
The only variables in this example are the parent rates for 
<code><i><font color="black"><span style='white-space: nowrap'>iota</span></font></i></code>
.
Hence the number of variables in the <a href="var_table.htm" target="_top"><span style='white-space: nowrap'>var_table</span></a>
 should be the number
of grid points in the modified smoothing; i.e., 20.
There is no data for this example.
Hence the optimal fit is to have 
<code><i><font color="black"><span style='white-space: nowrap'>iota</span></font></i></code>
 equal to 
<code><i><font color="black"><span style='white-space: nowrap'>iota_mean</span></font></i></code>

for all the (age, time) paris in the modified smoothing.

<br>
<br>
<b><big><a name="Source Code" id="Source Code">Source Code</a></big></b>

<pre><tt>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
iota_mean <font color="#990000">=</font> <font color="#993399">0.01</font>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#000080">import</font></b> sys
<b><font color="#000080">import</font></b> os
<b><font color="#000080">import</font></b> distutils<font color="#990000">.</font>dir_util
<b><font color="#000080">import</font></b> subprocess
test_program <font color="#990000">=</font> <font color="#FF0000">'example/user/change_grid.py'</font>
<b><font color="#0000FF">if</font></b> sys<font color="#990000">.</font>argv<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">!=</font> test_program  <b><font color="#0000FF">or</font></b> <b><font color="#000000">len</font></b><font color="#990000">(</font>sys<font color="#990000">.</font>argv<font color="#990000">)</font> <font color="#990000">!=</font> <font color="#993399">1</font> <font color="#990000">:</font>
     usage  <font color="#990000">=</font> <font color="#FF0000">'python3 '</font> <font color="#990000">+</font> test_program <font color="#990000">+</font> <font color="#FF0000">'\n'</font>
     usage <font color="#990000">+=</font> <font color="#FF0000">'where python3 is the python 3 program on your system\n'</font>
     usage <font color="#990000">+=</font> <font color="#FF0000">'and working directory is the dismod_at distribution directory\n'</font>
     sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font>usage<font color="#990000">)</font>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font>test_program<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># import dismod_at</font></i>
local_dir <font color="#990000">=</font> os<font color="#990000">.</font><b><font color="#000000">getcwd</font></b><font color="#990000">()</font> <font color="#990000">+</font> <font color="#FF0000">'/python'</font>
<b><font color="#0000FF">if</font></b><font color="#990000">(</font> os<font color="#990000">.</font>path<font color="#990000">.</font><b><font color="#000000">isdir</font></b><font color="#990000">(</font> local_dir <font color="#990000">+</font> <font color="#FF0000">'/dismod_at'</font> <font color="#990000">)</font> <font color="#990000">)</font> <font color="#990000">:</font>
     sys<font color="#990000">.</font>path<font color="#990000">.</font><b><font color="#000000">insert</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> local_dir<font color="#990000">)</font>
<b><font color="#000080">import</font></b> dismod_at
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># change into the build/test/user directory</font></i>
distutils<font color="#990000">.</font>dir_util<font color="#990000">.</font><b><font color="#000000">mkpath</font></b><font color="#990000">(</font><font color="#FF0000">'build/test/user'</font><font color="#990000">)</font>
os<font color="#990000">.</font><b><font color="#000000">chdir</font></b><font color="#990000">(</font><font color="#FF0000">'build/test/user'</font><font color="#990000">)</font>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">constant_weight_fun</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
     <b><font color="#0000FF">return</font></b> <font color="#993399">1.0</font>
<i><font color="#9A1900"># note that the a, t values are not used for this case</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">fun_iota_parent</font></b><font color="#990000">(</font>a<font color="#990000">,</font> t<font color="#990000">)</font> <font color="#990000">:</font>
     <b><font color="#0000FF">return</font></b> <font color="#990000">(</font><font color="#FF0000">'prior_value'</font><font color="#990000">,</font> <font color="#FF0000">'prior_diff'</font><font color="#990000">,</font> <font color="#FF0000">'prior_diff'</font><font color="#990000">)</font>
<i><font color="#9A1900"># ------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">example_db</font></b> <font color="#990000">(</font>file_name<font color="#990000">)</font> <font color="#990000">:</font>
     <b><font color="#000080">import</font></b> copy
     <b><font color="#000080">import</font></b> dismod_at
     <b><font color="#000080">import</font></b> math
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># age table</font></i>
     age_list    <font color="#990000">=</font> <font color="#990000">[</font><font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">1</font><font color="#990000">,</font> <font color="#993399">20</font><font color="#990000">,</font> <font color="#993399">30</font><font color="#990000">,</font> <font color="#993399">40</font><font color="#990000">,</font> <font color="#993399">50</font><font color="#990000">,</font> <font color="#993399">60</font><font color="#990000">,</font> <font color="#993399">70</font><font color="#990000">,</font> <font color="#993399">80</font><font color="#990000">,</font> <font color="#993399">90</font><font color="#990000">,</font> <font color="#993399">100</font> <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># time table</font></i>
     time_list   <font color="#990000">=</font> <font color="#990000">[</font> <font color="#993399">1960</font><font color="#990000">,</font> <font color="#993399">1995</font> <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># integrand table</font></i>
     integrand_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'Sincidence'</font> <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># node table</font></i>
     node_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'world'</font><font color="#990000">,</font>         <font color="#FF0000">'parent'</font><font color="#990000">:</font><font color="#FF0000">''</font> <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># weight table: The constant function 1.0 (one age and one time point)</font></i>
     fun <font color="#990000">=</font> constant_weight_fun
     weight_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'constant'</font><font color="#990000">,</font>  <font color="#FF0000">'age_id'</font><font color="#990000">:[</font><font color="#993399">0</font><font color="#990000">],</font> <font color="#FF0000">'time_id'</font><font color="#990000">:[</font><font color="#993399">0</font><font color="#990000">],</font> <font color="#FF0000">'fun'</font><font color="#990000">:</font>fun <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># covariate table:</font></i>
     covariate_table <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900">#</font></i>
     <i><font color="#9A1900"># mulcov table</font></i>
     mulcov_table <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># data table:</font></i>
     data_table <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># prior_table</font></i>
     prior_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <i><font color="#9A1900"># prior_diff</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_diff'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    None<font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    None<font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     <font color="#993399">0.0</font><font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      <font color="#993399">1.0</font><font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-6</font>
          <font color="#990000">},{</font> <i><font color="#9A1900"># prior_value</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>     <font color="#FF0000">'prior_value'</font><font color="#990000">,</font>
               <font color="#FF0000">'density'</font><font color="#990000">:</font>  <font color="#FF0000">'log_gaussian'</font><font color="#990000">,</font>
               <font color="#FF0000">'lower'</font><font color="#990000">:</font>    <font color="#993399">1e-2</font> <font color="#990000">*</font> iota_mean<font color="#990000">,</font>
               <font color="#FF0000">'upper'</font><font color="#990000">:</font>    <font color="#993399">1e+2</font> <font color="#990000">*</font> iota_mean<font color="#990000">,</font>
               <font color="#FF0000">'mean'</font><font color="#990000">:</font>     iota_mean<font color="#990000">,</font>
               <font color="#FF0000">'std'</font><font color="#990000">:</font>      iota_mean<font color="#990000">,</font>
               <font color="#FF0000">'eta'</font><font color="#990000">:</font>      <font color="#993399">1e-3</font> <font color="#990000">*</font> iota_mean
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># smooth table</font></i>
     age_id_list <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> age_list <font color="#990000">)</font> <font color="#990000">)</font>
     time_id_list <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> time_list <font color="#990000">)</font> <font color="#990000">)</font>
     smooth_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <i><font color="#9A1900"># smooth_rate_parent</font></i>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>                     <font color="#FF0000">'smooth_rate_parent'</font><font color="#990000">,</font>
               <font color="#FF0000">'age_id'</font><font color="#990000">:</font>                   age_id_list<font color="#990000">,</font>
               <font color="#FF0000">'time_id'</font><font color="#990000">:</font>                  time_id_list<font color="#990000">,</font>
               <font color="#FF0000">'mulstd_value_prior_name'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
               <font color="#FF0000">'mulstd_dage_prior_name'</font><font color="#990000">:</font>   None<font color="#990000">,</font>
               <font color="#FF0000">'mulstd_dtime_prior_name'</font><font color="#990000">:</font>  None<font color="#990000">,</font>
               <font color="#FF0000">'fun'</font><font color="#990000">:</font>                      fun_iota_parent
          <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># rate table</font></i>
     rate_table <font color="#990000">=</font> <font color="#990000">[</font> <font color="#990000">{</font>
               <font color="#FF0000">'name'</font><font color="#990000">:</font>          <font color="#FF0000">'iota'</font><font color="#990000">,</font>
               <font color="#FF0000">'parent_smooth'</font><font color="#990000">:</font> <font color="#FF0000">'smooth_rate_parent'</font>
     <font color="#990000">}</font> <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># option_table</font></i>
     option_table <font color="#990000">=</font> <font color="#990000">[</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'parent_node_name'</font><font color="#990000">,</font>       <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'world'</font>             <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'ode_step_size'</font><font color="#990000">,</font>          <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'10.0'</font>              <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'random_seed'</font><font color="#990000">,</font>            <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'0'</font>                 <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'rate_case'</font><font color="#990000">,</font>              <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'iota_pos_rho_zero'</font> <font color="#990000">},</font>

          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'quasi_fixed'</font><font color="#990000">,</font>            <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'true'</font>              <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'derivative_test_fixed'</font><font color="#990000">,</font>  <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'none'</font>              <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'max_num_iter_fixed'</font><font color="#990000">,</font>     <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'50'</font>                <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'print_level_fixed'</font><font color="#990000">,</font>      <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'0'</font>                 <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'tolerance_fixed'</font><font color="#990000">,</font>        <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'1e-10'</font>             <font color="#990000">},</font>

          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'derivative_test_random'</font><font color="#990000">,</font> <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'second-order'</font>      <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'max_num_iter_random'</font><font color="#990000">,</font>    <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'50'</font>                <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'print_level_random'</font><font color="#990000">,</font>     <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'0'</font>                 <font color="#990000">},</font>
          <font color="#990000">{</font> <font color="#FF0000">'name'</font><font color="#990000">:</font><font color="#FF0000">'tolerance_random'</font><font color="#990000">,</font>       <font color="#FF0000">'value'</font><font color="#990000">:</font><font color="#FF0000">'1e-10'</font>             <font color="#990000">}</font>
     <font color="#990000">]</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># avgint table: empty</font></i>
     avgint_table <font color="#990000">=</font> <b><font color="#000000">list</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># nslist_table:</font></i>
     nslist_table <font color="#990000">=</font> <b><font color="#000000">dict</font></b><font color="#990000">()</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     <i><font color="#9A1900"># create database</font></i>
     dismod_at<font color="#990000">.</font><b><font color="#000000">create_database</font></b><font color="#990000">(</font>
          file_name<font color="#990000">,</font>
          age_list<font color="#990000">,</font>
          time_list<font color="#990000">,</font>
          integrand_table<font color="#990000">,</font>
          node_table<font color="#990000">,</font>
          weight_table<font color="#990000">,</font>
          covariate_table<font color="#990000">,</font>
          avgint_table<font color="#990000">,</font>
          data_table<font color="#990000">,</font>
          prior_table<font color="#990000">,</font>
          smooth_table<font color="#990000">,</font>
          nslist_table<font color="#990000">,</font>
          rate_table<font color="#990000">,</font>
          mulcov_table<font color="#990000">,</font>
          option_table
     <font color="#990000">)</font>
     <i><font color="#9A1900"># ----------------------------------------------------------------------</font></i>
     n_smooth  <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> smooth_table <font color="#990000">)</font>
     <b><font color="#0000FF">return</font></b>
<i><font color="#9A1900">#</font></i>
file_name   <font color="#990000">=</font> <font color="#FF0000">'example.db'</font>
<b><font color="#000000">example_db</font></b><font color="#990000">(</font>file_name<font color="#990000">)</font>
<i><font color="#9A1900"># ===========================================================================</font></i>
<i><font color="#9A1900"># remove one age from the original smoothing</font></i>
<i><font color="#9A1900"># ===========================================================================</font></i>
<i><font color="#9A1900">#</font></i>
new         <font color="#990000">=</font> False
connection  <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">create_connection</font></b><font color="#990000">(</font>file_name<font color="#990000">,</font> new<font color="#990000">)</font>
age_table   <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'age'</font><font color="#990000">)</font>
n_age       <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> age_table <font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># change number of ages in the smooth table</font></i>
command  <font color="#990000">=</font> <font color="#FF0000">'UPDATE smooth SET n_age = '</font> <font color="#990000">+</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>n_age <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font> <font color="#990000">+</font> <font color="#FF0000">' '</font>
command <font color="#990000">+=</font> <font color="#FF0000">'WHERE smooth_id == 0;'</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">sql_command</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> command<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Remove the last grid point. Note that there is a new last age and the</font></i>
<i><font color="#9A1900"># corresponding dage priors are not used (even though they are not null).</font></i>
remove_index <font color="#990000">=</font> <b><font color="#000000">int</font></b><font color="#990000">(</font> n_age <font color="#990000">-</font> <font color="#993399">1</font> <font color="#990000">)</font>
command  <font color="#990000">=</font> <font color="#FF0000">'UPDATE smooth_grid SET smooth_id = null '</font>
command <font color="#990000">+=</font> <font color="#FF0000">'WHERE smooth_id == 0 AND age_id == '</font> <font color="#990000">+</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>remove_index<font color="#990000">)</font> <font color="#990000">+</font> <font color="#FF0000">';'</font>
dismod_at<font color="#990000">.</font><b><font color="#000000">sql_command</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> command<font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># ===========================================================================</font></i>
<i><font color="#9A1900"># do a fit and check results</font></i>
<i><font color="#9A1900"># ===========================================================================</font></i>
program        <font color="#990000">=</font> <font color="#FF0000">'../../devel/dismod_at'</font>
<b><font color="#0000FF">for</font></b> command <b><font color="#0000FF">in</font></b> <font color="#990000">[</font> <font color="#FF0000">'init'</font><font color="#990000">,</font> <font color="#FF0000">'fit'</font> <font color="#990000">]</font> <font color="#990000">:</font>
     cmd <font color="#990000">=</font> <font color="#990000">[</font> program<font color="#990000">,</font> file_name<font color="#990000">,</font> command <font color="#990000">]</font>
     <b><font color="#0000FF">if</font></b> command <font color="#990000">==</font> <font color="#FF0000">'fit'</font> <font color="#990000">:</font>
          variables <font color="#990000">=</font> <font color="#FF0000">'both'</font>
          cmd<font color="#990000">.</font><b><font color="#000000">append</font></b><font color="#990000">(</font>variables<font color="#990000">)</font>
     <b><font color="#0000FF">print</font></b><font color="#990000">(</font> <font color="#FF0000">' '</font><font color="#990000">.</font><b><font color="#000000">join</font></b><font color="#990000">(</font>cmd<font color="#990000">)</font> <font color="#990000">)</font>
     flag <font color="#990000">=</font> subprocess<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font> cmd <font color="#990000">)</font>
     <b><font color="#0000FF">if</font></b> flag <font color="#990000">!=</font> <font color="#993399">0</font> <font color="#990000">:</font>
          sys<font color="#990000">.</font><b><font color="#000000">exit</font></b><font color="#990000">(</font><font color="#FF0000">'The dismod_at '</font> <font color="#990000">+</font> command <font color="#990000">+</font> <font color="#FF0000">' command failed'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># Results for fitting with no noise</font></i>
age_table     <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'age'</font><font color="#990000">)</font>
time_table    <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'time'</font><font color="#990000">)</font>
var_table     <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'var'</font><font color="#990000">)</font>
fit_var_table <font color="#990000">=</font> dismod_at<font color="#990000">.</font><b><font color="#000000">get_table_dict</font></b><font color="#990000">(</font>connection<font color="#990000">,</font> <font color="#FF0000">'fit_var'</font><font color="#990000">)</font>
<i><font color="#9A1900">#</font></i>
n_age  <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> age_table <font color="#990000">)</font>
n_time <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> time_table <font color="#990000">)</font>
n_var  <font color="#990000">=</font> <b><font color="#000000">len</font></b><font color="#990000">(</font> var_table <font color="#990000">)</font>
<b><font color="#0000FF">assert</font></b> n_var <font color="#990000">==</font> <font color="#990000">(</font>n_age <font color="#990000">-</font> <font color="#993399">1</font> <font color="#990000">)</font> <font color="#990000">*</font> n_time
<i><font color="#9A1900">#</font></i>
parent_node_id <font color="#990000">=</font> <font color="#993399">0</font>
eps            <font color="#990000">=</font> <font color="#993399">1e-4</font>
<i><font color="#9A1900">#</font></i>
<i><font color="#9A1900"># check parent rates values</font></i>
iota_rate_id      <font color="#990000">=</font> <font color="#993399">1</font>
max_err           <font color="#990000">=</font> <font color="#993399">0.0</font><font color="#990000">;</font>
age_id_list       <font color="#990000">=</font> <b><font color="#000000">range</font></b><font color="#990000">(</font> n_age <font color="#990000">)</font>
<b><font color="#0000FF">for</font></b> var_id <b><font color="#0000FF">in</font></b> <b><font color="#000000">range</font></b><font color="#990000">(</font> n_var <font color="#990000">)</font> <font color="#990000">:</font>
     row    <font color="#990000">=</font> var_table<font color="#990000">[</font>var_id<font color="#990000">]</font>
     value  <font color="#990000">=</font> fit_var_table<font color="#990000">[</font>var_id<font color="#990000">][</font><font color="#FF0000">'fit_var_value'</font><font color="#990000">]</font>
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'var_type'</font><font color="#990000">]</font> <font color="#990000">==</font> <font color="#FF0000">'rate'</font>
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'node_id'</font><font color="#990000">]</font> <font color="#990000">==</font> parent_node_id
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'rate_id'</font><font color="#990000">]</font> <font color="#990000">==</font> iota_rate_id
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font> <b><font color="#0000FF">in</font></b> age_id_list
     <b><font color="#0000FF">assert</font></b> row<font color="#990000">[</font><font color="#FF0000">'age_id'</font><font color="#990000">]</font> <font color="#990000">!=</font> remove_index
     max_err <font color="#990000">=</font> <b><font color="#000000">max</font></b><font color="#990000">(</font>max_err<font color="#990000">,</font> <b><font color="#000000">abs</font></b><font color="#990000">(</font> value <font color="#990000">/</font> iota_mean <font color="#990000">-</font> <font color="#993399">1.0</font> <font color="#990000">)</font> <font color="#990000">)</font>
<b><font color="#0000FF">assert</font></b> <b><font color="#000000">abs</font></b><font color="#990000">(</font>value <font color="#990000">/</font> iota_mean <font color="#990000">-</font> <font color="#993399">1.0</font> <font color="#990000">)</font> <font color="#990000">&lt;=</font> <font color="#993399">1e-2</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i>
<b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">'change_grid.py: OK'</font><font color="#990000">)</font>
<i><font color="#9A1900"># -----------------------------------------------------------------------------</font></i></tt></pre>

<hr>Input File: example/user/change_grid.py

</body>
</html>
