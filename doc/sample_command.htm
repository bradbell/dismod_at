<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>The Sample Command</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="The Sample Command">
<meta name="keywords" id="keywords" content=" ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_sample_command_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="https://bradbell.github.io/dismod_at" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td><a href="predict_command.py.htm" target="_top">Prev</a>
</td><td><a href="sample_command.py.htm" target="_top">Next</a>
</td><td>
<select onchange='choose_across0(this)'>
<option>Index-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Up-&gt;</option>
<option>dismod_at</option>
<option>command</option>
<option>sample_command</option>
</select>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_dismod_at_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_command_htm.js'></script>
</td>
<td>
<script type='text/javascript' language='JavaScript' src='_childtable_sample_command_htm.js'></script>
</td>
</tr></table><br>
@(@\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@<b>This is old dismod documentation:</b> Here is a link to its
<a href="http://bradbell.github.io/dismod_at" target="_top"><span style='white-space: nowrap'>current&nbsp;documentation</span></a>
.

<center><b><big><big>The Sample Command</big></big></b></center>

<br><a href="sample_command.htm#Syntax" target="_top">Syntax</a>
<br><a href="sample_command.htm#database" target="_top">database</a>
<br><a href="sample_command.htm#Purpose" target="_top">Purpose</a>
<br><a href="sample_command.htm#method" target="_top">method</a>
<br><a href="sample_command.htm#variables" target="_top">variables</a>
<br><a href="sample_command.htm#number_sample" target="_top">number_sample</a>
<br><a href="sample_command.htm#simulate_index" target="_top">simulate_index</a>
<br><a href="sample_command.htm#simulate" target="_top">simulate</a>
<br><a href="sample_command.htm#asymptotic" target="_top">asymptotic</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#asymptotic.Fixed Effects Distribution" target="_top">Fixed&nbsp;Effects&nbsp;Distribution</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#asymptotic.Random Effects Distribution" target="_top">Random&nbsp;Effects&nbsp;Distribution</a>
<br><a href="sample_command.htm#Extra Input Tables" target="_top">Extra&nbsp;Input&nbsp;Tables</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Extra Input Tables.data_sim_table" target="_top">data_sim_table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Extra Input Tables.prior_sim_table" target="_top">prior_sim_table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Extra Input Tables.fit_var_table" target="_top">fit_var_table</a>
<br><a href="sample_command.htm#Output Tables" target="_top">Output&nbsp;Tables</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Output Tables.sample_table" target="_top">sample_table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Output Tables.No Sample Table" target="_top">No&nbsp;Sample&nbsp;Table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Output Tables.hes_fixed_table" target="_top">hes_fixed_table</a>
<br>&#160;&#160;&#160;&#160;&#160;<a href="sample_command.htm#Output Tables.hes_random_table" target="_top">hes_random_table</a>
<br><a href="sample_command.htm#Bounds" target="_top">Bounds</a>
<br><a href="sample_command.htm#Example" target="_top">Example</a>
<br><br>
<b><big><a name="Syntax" id="Syntax">Syntax</a></big></b>

<br>

<code><font color="blue"><span style='white-space: nowrap'>dismod_at&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>database</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;sample&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>method</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>number_sample</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>

<code><font color="blue"><span style='white-space: nowrap'>dismod_at&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>database</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;sample&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>method</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>number_sample</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>
<br>
<b><big><a name="database" id="database">database</a></big></b>
<br>
Is an
<a href="http://www.sqlite.org/sqlite/" target="_top"><span style='white-space: nowrap'>http://www.sqlite.org/sqlite/</span></a>
 database containing the
<code><font color="blue">dismod_at</font></code> <a href="input.htm" target="_top"><span style='white-space: nowrap'>input</span></a>
 tables which are not modified.

<br>
<br>
<b><big><a name="Purpose" id="Purpose">Purpose</a></big></b>
<br>
This command simulates samples of the <a href="model_variables.htm" target="_top"><span style='white-space: nowrap'>model_variables</span></a>

from the posterior distribution; see
<a href="posterior.htm#Simulation" target="_top"><span style='white-space: nowrap'>simulation</span></a>
 for the posterior distribution.

<br>
<br>
<b><big><a name="method" id="method">method</a></big></b>
<br>
The sample command argument 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 must be
<code><font color="blue">simulate</font></code> or <code><font color="blue">asymptotic</font></code>; see discussion below:

<br>
<br>
<b><big><a name="variables" id="variables">variables</a></big></b>
<br>
The sample command argument 
<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 must be
<code><font color="blue">fixed</font></code> or <code><font color="blue">both</font></code>.
This corresponds to the asymptotic statistics for
<a href="fit_command.htm#variables.fixed" target="_top"><span style='white-space: nowrap'>fit&nbsp;fixed</span></a>
 and
<a href="fit_command.htm#variables.both" target="_top"><span style='white-space: nowrap'>fit&nbsp;both</span></a>
 respectively.

<br>
<br>
<b><big><a name="number_sample" id="number_sample">number_sample</a></big></b>
<br>
Is the number of samples. Each sample contains a complete
set of model variables.
If 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 is <code><font color="blue">simulate</font></code>,

<code><i><font color="black"><span style='white-space: nowrap'>number_sample</span></font></i></code>
 must be equal to
<a href="simulate_command.htm#number_simulate" target="_top"><span style='white-space: nowrap'>number_simulate</span></a>

in the previous simulate command.

<br>
<br>
<b><big><a name="simulate_index" id="simulate_index">simulate_index</a></big></b>
<br>
If this argument is present, 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 must be <code><font color="blue">asymptotic</font></code>
and 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
 must be the same as in the corresponding
<a href="fit_command.htm#simulate_index" target="_top"><span style='white-space: nowrap'>fit&nbsp;command</span></a>
.

<br>
<br>
<b><big><a name="simulate" id="simulate">simulate</a></big></b>
<br>
A complete set of <a href="model_variables.htm" target="_top"><span style='white-space: nowrap'>model_variables</span></a>
,
corresponding to each <a href="sample_table.htm#sample_index" target="_top"><span style='white-space: nowrap'>sample_index</span></a>
,
is written to the sample table.
They correspond to fitting the data in the data_sim table with
<a href="data_sim_table.htm#simulate_index" target="_top"><span style='white-space: nowrap'>simulate_index</span></a>
 equal to

<code><i><font color="black"><span style='white-space: nowrap'>sample_index</span></font></i></code>
.
The fixed effects correspond to the optimal fit of both the fixed and random
effects with the prior for the fixed effects replaced by the corresponding
values in the <a href="prior_sim_table.htm" target="_top"><span style='white-space: nowrap'>prior_sim_table</span></a>
.
This value is used for the fixed effects and the value for the
random effects is obtained by optimizing just the random
effects with the prior for the random effects replaced by the corresponding
values in the <a href="prior_sim_table.htm" target="_top"><span style='white-space: nowrap'>prior_sim_table</span></a>
.
This requires running 
<code><i><font color="black"><span style='white-space: nowrap'>number_sample</span></font></i></code>
 fits of the model variables
(fitting just the random effects is faster compared to fitting both).
See <a href="posterior.htm#Simulation" target="_top"><span style='white-space: nowrap'>simulation</span></a>
 in the discussion of the
posterior distribution of maximum likelihood estimates.

<br>
<br>
<b><big><a name="asymptotic" id="asymptotic">asymptotic</a></big></b>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 is <code><font color="blue">asymptotic</font></code>,
the <a href="fit_var_table.htm" target="_top"><span style='white-space: nowrap'>fit_var_table</span></a>
 is an additional input in this case
and it assumed to correspond to a
fit <a href="fit_command.htm#variables.both" target="_top"><span style='white-space: nowrap'>both</span></a>
.
If the previous fit did (did not) have a
<a href="fit_command.htm#simulate_index" target="_top"><span style='white-space: nowrap'>simulate_index</span></a>
 it
must (must not) be included in the sample_command.
The asymptotic statistics of the model variables is used to generate

<code><i><font color="black"><span style='white-space: nowrap'>number_sample</span></font></i></code>
 samples of the model variables
The samples with different values of 
<code><i><font color="black"><span style='white-space: nowrap'>sample_index</span></font></i></code>
 are independent.
All of the Laplace density terms are ignored by the asymptotic statistics.
The constraints are also ignored, except the constraints were
the lower and upper limits for a variable are equal.

<br>
<br>
<big><a name="asymptotic.Fixed Effects Distribution" id="asymptotic.Fixed Effects Distribution">Fixed Effects Distribution</a></big>
<br>
The asymptotic distribution used to simulate the fixed effects is a normal
with mean equal to the value of the fixed effects in the <a href="fit_var_table.htm" target="_top"><span style='white-space: nowrap'>fit_var_table</span></a>

and covariance equal to the inverse of the
Hessian of the fixed effect objective
<a href="sample_command.htm#Output Tables.hes_fixed_table" target="_top"><span style='white-space: nowrap'>hes_fixed_table</span></a>
.
If a fixed effect is scaled
(see <a href="prior_table.htm#eta.Scaling Fixed Effects" target="_top"><span style='white-space: nowrap'>scaling&nbsp;fixed&nbsp;effects</span></a>
)
the scaled version of the fixed effect has the asymptotic distribution.
If the lower and upper limits are equal, the corresponding variable
is simulated as having that constant value.

<br>
<br>
<big><a name="asymptotic.Random Effects Distribution" id="asymptotic.Random Effects Distribution">Random Effects Distribution</a></big>
<br>
If the lower and upper limits for a random effect are equal,
the random effect is simulated as having that constant value.
If the lower and upper limits are not equal and

<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 is <code><font color="blue">fixed</font></code>,
the random effect is simulated with value zero.
Otherwise,
the asymptotic distribution used to simulate a random effect is a normal
with mean equal to the value of the random effect in the <a href="fit_var_table.htm" target="_top"><span style='white-space: nowrap'>fit_var_table</span></a>

This is the optimal value given the fixed effects; see
<a href="sample_command.htm#Extra Input Tables.fit_var_table" target="_top"><span style='white-space: nowrap'>fit_var_table</span></a>
 below.
The covariance of the random effects is equal to the inverse of the
Hessian of the random effect objective
<a href="sample_command.htm#Output Tables.hes_fixed_table" target="_top"><span style='white-space: nowrap'>hes_fixed_table</span></a>
.

<br>
<br>
<b><big><a name="Extra Input Tables" id="Extra Input Tables">Extra Input Tables</a></big></b>


<br>
<br>
<big><a name="Extra Input Tables.data_sim_table" id="Extra Input Tables.data_sim_table">data_sim_table</a></big>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 is <code><font color="blue">simulate</font></code>,
this command has the extra input <a href="data_sim_table.htm" target="_top"><span style='white-space: nowrap'>data_sim_table</span></a>

which was created by the previous <a href="simulate_command.htm" target="_top"><span style='white-space: nowrap'>simulate_command</span></a>
.

<br>
<br>
<big><a name="Extra Input Tables.prior_sim_table" id="Extra Input Tables.prior_sim_table">prior_sim_table</a></big>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 is <code><font color="blue">simulate</font></code>,
this command has the extra input <a href="prior_sim_table.htm" target="_top"><span style='white-space: nowrap'>prior_sim_table</span></a>

which was created by the previous <a href="simulate_command.htm" target="_top"><span style='white-space: nowrap'>simulate_command</span></a>
.

<br>
<br>
<big><a name="Extra Input Tables.fit_var_table" id="Extra Input Tables.fit_var_table">fit_var_table</a></big>
<br>
If 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 is <code><font color="blue">asymptotic</font></code>,
this command has the extra input <a href="fit_var_table.htm" target="_top"><span style='white-space: nowrap'>fit_var_table</span></a>

which was created by a previous fit command which
must have included <a href="fit_command.htm#variables.both" target="_top"><span style='white-space: nowrap'>both</span></a>

fixed and random effects.

<br>
<br>
<b><big><a name="Output Tables" id="Output Tables">Output Tables</a></big></b>


<br>
<br>
<big><a name="Output Tables.sample_table" id="Output Tables.sample_table">sample_table</a></big>
<br>
A new <a href="sample_table.htm" target="_top"><span style='white-space: nowrap'>sample_table</span></a>
 is created each time this command is run.
It contains samples of the model variables.
Hence the number of rows in this table is 
<code><i><font color="black"><span style='white-space: nowrap'>number_sample</span></font></i></code>

times the number of rows in the <a href="var_table.htm" target="_top"><span style='white-space: nowrap'>var_table</span></a>
.
If the <code><font color="blue">asymptotic</font></code> command fails because the
fixed effects information matrix is not positive definite,
this command will terminate with an error and the sample table will not exist.
The corresponding fixed effects information matrix will be in the
<a href="sample_command.htm#Output Tables.hes_fixed_table" target="_top"><span style='white-space: nowrap'>hes_fixed_table</span></a>
.

<br>
<br>
<big><a name="Output Tables.No Sample Table" id="Output Tables.No Sample Table">No Sample Table</a></big>
<br>
In the special case where 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 is <code><font color="blue">asymptotic</font></code>
and the Hessian of the fixed objective is not positive definite,
the sample table is not created; i.e.,
there is be no sample table in the database after this command.
In addition, if 
<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 is <code><font color="blue">both</font></code> and the Hessian
of the random effects objective is not positive definite,
the sample table is not created.

<br>
<br>
<big><a name="Output Tables.hes_fixed_table" id="Output Tables.hes_fixed_table">hes_fixed_table</a></big>
<br>
A new <a href="hes_fixed_table.htm" target="_top"><span style='white-space: nowrap'>hes_fixed_table</span></a>
 is created each time this command is run
with 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 equal to <code><font color="blue">asymptotic</font></code>.
The Hessian of the fixed effects objective is written in this table.
If 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
 is present (is not present) the Hessian corresponds
to the simulated measurements in the <a href="data_sim_table.htm" target="_top"><span style='white-space: nowrap'>data_sim_table</span></a>

(measurements in the <a href="data_table.htm" target="_top"><span style='white-space: nowrap'>data_table</span></a>
).

<br>
<br>
<big><a name="Output Tables.hes_random_table" id="Output Tables.hes_random_table">hes_random_table</a></big>
<br>
A new <a href="hes_random_table.htm" target="_top"><span style='white-space: nowrap'>hes_random_table</span></a>
 is created each time this command is run
with 
<code><i><font color="black"><span style='white-space: nowrap'>method</span></font></i></code>
 equal to <code><font color="blue">asymptotic</font></code> and

<code><i><font color="black"><span style='white-space: nowrap'>variables</span></font></i></code>
 equal to <code><font color="blue">both</font></code>.
The Hessian of the random effects objective is written in this table.
If 
<code><i><font color="black"><span style='white-space: nowrap'>simulate_index</span></font></i></code>
 is present (is not present) the Hessian corresponds
to the simulated measurements in the <a href="data_sim_table.htm" target="_top"><span style='white-space: nowrap'>data_sim_table</span></a>

(measurements in the <a href="data_table.htm" target="_top"><span style='white-space: nowrap'>data_table</span></a>
).

<br>
<br>
<b><big><a name="Bounds" id="Bounds">Bounds</a></big></b>
<br>
If you use the <code><font color="blue">simulate</font></code> method,
the samples are all within the specified bounds, including the bounds
on the random effects specified by
<a href="option_table.htm#Optimize Random Only.bound_random" target="_top"><span style='white-space: nowrap'>bound_random</span></a>
.
If you use the <code><font color="blue">asymptotic</font></code> method,
the only bounds that are enforced are where the upper and lower limits
are equal.


<br>
<br>
<b><big><a name="Example" id="Example">Example</a></big></b>
<br>
The files
<a href="sample_command.py.htm" target="_top"><span style='white-space: nowrap'>sample_command.py</span></a>
, <a href="user_sample_asy.py.htm" target="_top"><span style='white-space: nowrap'>user_sample_asy.py</span></a>

contain examples and tests using this command.


<hr>Input File: devel/cmd/sample_command.cpp

</body>
</html>
