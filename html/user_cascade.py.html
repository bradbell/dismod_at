<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="user_cascade.py, generating, priors, for, next, level, down, node, tree" name="keywords" />
<meta content="node, table" name="keywords" />
<meta content="problem" name="keywords" />
<meta content="procedure" name="keywords" />
<meta content="step, 1:, create, database" name="keywords" />
<meta content="step, 2:, fit, with, n1, as, parent" name="keywords" />
<meta content="step, 3:, simulate, data" name="keywords" />
<meta content="step, 4:, sample, posterior" name="keywords" />
<meta content="step, 5:, predictions, for, n11" name="keywords" />
<meta content="step, 6:, priors, for, n11, as, parent" name="keywords" />
<meta content="step, 7:, fit, n11, as, parent" name="keywords" />
<meta content="problem, parameters" name="keywords" />
<meta content="age, and, time, values" name="keywords" />
<meta content="rate, table" name="keywords" />
<meta content="covariates" name="keywords" />
<meta content="multipliers" name="keywords" />
<meta content="gamma" name="keywords" />
<meta content="alpha" name="keywords" />
<meta content="data, table" name="keywords" />
<meta content="source, code" name="keywords" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="user_censor.py" href="user_censor.py.html" /><link rel="prev" title="user_bnd_mulcov.py" href="user_bnd_mulcov.py.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.09.29"/>
        <title>user_cascade.py - dismod_at documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="xrst_root_doc.html"><div class="brand">dismod_at  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="xrst_root_doc.html">
  
  
  <span class="sidebar-brand-text">dismod_at  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="xrst_table_of_contents.html">Table of Contents</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="dismod_at.html">dismod_at</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="math_abstract.html">math_abstract</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="math_ode.html">math_ode</a></li>
<li class="toctree-l3"><a class="reference internal" href="censor_density.html">censor_density</a></li>
<li class="toctree-l3"><a class="reference internal" href="prevalence_ode.html">prevalence_ode</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="install.html">install</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="dock_dismod_at.sh.html">dock_dismod_at.sh</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="install_unix.html">install_unix</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="run_cmake.sh.html">run_cmake.sh</a></li>
<li class="toctree-l4"><a class="reference internal" href="example_install.sh.html">example_install.sh</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="get_started.html">get_started</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="get_started_db.py.html">get_started_db.py</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="user_example.html">user_example</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="user_age_avg_split.py.html">user_age_avg_split.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_bilevel_random.py.html">user_bilevel_random.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_bnd_mulcov.py.html">user_bnd_mulcov.py</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">user_cascade.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_censor.py.html">user_censor.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_change_grid.py.html">user_change_grid.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_compress.py.html">user_compress.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_const_random.py.html">user_const_random.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_const_value.py.html">user_const_value.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_continue_fit.py.html">user_continue_fit.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_covid_19.py.html">user_covid_19.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_csv2db.py.html">user_csv2db.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_data_density.py.html">user_data_density.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_data_sim.py.html">user_data_sim.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_diabetes.py.html">user_diabetes.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_diff_constraint.py.html">user_diff_constraint.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_fit_fixed_both.py.html">user_fit_fixed_both.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_fit_meas_noise.py.html">user_fit_meas_noise.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_fit_random.py.html">user_fit_random.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_fit_sim.py.html">user_fit_sim.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_group_mulcov.py.html">user_group_mulcov.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_hes_fixed_math.py.html">user_hes_fixed_math.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_hes_random.py.html">user_hes_random.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_hold_out_1.py.html">user_hold_out_1.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_hold_out_2.py.html">user_hold_out_2.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_ill_condition.py.html">user_ill_condition.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_jump_at_age.py.html">user_jump_at_age.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_lasso_covariate.py.html">user_lasso_covariate.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_mulstd.py.html">user_mulstd.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_no_children.py.html">user_no_children.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_one_function.py.html">user_one_function.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_plot_curve.py.html">user_plot_curve.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_plot_data_fit.py.html">user_plot_data_fit.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_plot_rate_fit.py.html">user_plot_rate_fit.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_predict_fit.py.html">user_predict_fit.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_predict_mulcov.py.html">user_predict_mulcov.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_re_scale.py.html">user_re_scale.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_residual.py.html">user_residual.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_sample_asy.py.html">user_sample_asy.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_sample_asy_sim.py.html">user_sample_asy_sim.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_sample_sim.py.html">user_sample_sim.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_sim_log.py.html">user_sim_log.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_speed.py.html">user_speed.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_subgroup_mulcov.py.html">user_subgroup_mulcov.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_sum_residual.py.html">user_sum_residual.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_system_command_prc.py.html">user_system_command_prc.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_trace_init.py.html">user_trace_init.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_trapezoidal.py.html">user_trapezoidal.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_warm_start.py.html">user_warm_start.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_zsum_child_rate.py.html">user_zsum_child_rate.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_zsum_mulcov_meas.py.html">user_zsum_mulcov_meas.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_zsum_mulcov_rate.py.html">user_zsum_mulcov_rate.py</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="database.html">database</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="input.html">input</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="age_table.html">age_table</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="age_table.py.html">age_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="avgint_table.html">avgint_table</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="avgint_table.py.html">avgint_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="covariate_table.html">covariate_table</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="covariate_table.py.html">covariate_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="data_table.html">data_table</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="data_table.py.html">data_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="density_table.html">density_table</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="density_table.py.html">density_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="integrand_table.html">integrand_table</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="integrand_table.py.html">integrand_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="mulcov_table.html">mulcov_table</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="mulcov_table.py.html">mulcov_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="node_table.html">node_table</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="node_table.py.html">node_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="nslist_pair_table.html">nslist_pair_table</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="nslist_pair_table.py.html">nslist_pair_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="nslist_table.html">nslist_table</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="nslist_table.py.html">nslist_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="option_table.html">option_table</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="option_default.html">option_default</a></li>
<li class="toctree-l5"><a class="reference internal" href="option_table.py.html">option_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="prior_table.html">prior_table</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="prior_table.py.html">prior_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="rate_table.html">rate_table</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="rate_table.py.html">rate_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="smooth_grid_table.html">smooth_grid_table</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="smooth_grid_table.py.html">smooth_grid_table.py</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="smooth_table.html">smooth_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="subgroup_table.html">subgroup_table</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="time_table.html">time_table</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="time_table.py.html">time_table.py</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="weight_grid_table.html">weight_grid_table</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="weight_grid_table.py.html">weight_grid_table.py</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="weight_table.html">weight_table</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="data_flow.html">data_flow</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="age_avg_table.html">age_avg_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="bnd_mulcov_table.html">bnd_mulcov_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_sim_table.html">data_sim_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_subset_table.html">data_subset_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="depend_var_table.html">depend_var_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="fit_data_subset_table.html">fit_data_subset_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="fit_var_table.html">fit_var_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="hes_fixed_table.html">hes_fixed_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="hes_random_table.html">hes_random_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="log_table.html">log_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="mixed_info_table.html">mixed_info_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="predict_table.html">predict_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="prior_sim_table.html">prior_sim_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="sample_table.html">sample_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="scale_var_table.html">scale_var_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="start_var_table.html">start_var_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="trace_fixed_table.html">trace_fixed_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="truth_var_table.html">truth_var_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="var_table.html">var_table</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="model.html">model</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="model_variables.html">model_variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="avg_integrand.html">avg_integrand</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_like.html">data_like</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="variable_prior.html">variable_prior</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="fixed_value.html">fixed_value</a></li>
<li class="toctree-l4"><a class="reference internal" href="random_value.html">random_value</a></li>
<li class="toctree-l4"><a class="reference internal" href="smooth_dage.html">smooth_dage</a></li>
<li class="toctree-l4"><a class="reference internal" href="smooth_dtime.html">smooth_dtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="fixed_diff.html">fixed_diff</a></li>
<li class="toctree-l4"><a class="reference internal" href="random_diff.html">random_diff</a></li>
<li class="toctree-l4"><a class="reference internal" href="fixed_prior.html">fixed_prior</a></li>
<li class="toctree-l4"><a class="reference internal" href="random_prior.html">random_prior</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="statistic.html">statistic</a></li>
<li class="toctree-l3"><a class="reference internal" href="bilinear.html">bilinear</a></li>
<li class="toctree-l3"><a class="reference internal" href="posterior.html">posterior</a></li>
<li class="toctree-l3"><a class="reference internal" href="prev_dep.html">prev_dep</a></li>
<li class="toctree-l3"><a class="reference internal" href="numeric_average.html">numeric_average</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="command.html">command</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="dismodat.py.html">dismodat.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="bnd_mulcov_command.html">bnd_mulcov_command</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_density_command.html">data_density_command</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="depend_command.html">depend_command</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="depend_command.py.html">depend_command.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="fit_command.html">fit_command</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="fit_command.py.html">fit_command.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="hold_out_command.html">hold_out_command</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="init_command.html">init_command</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="init_command.py.html">init_command.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="old2new_command.html">old2new_command</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="old2new_command.py.html">old2new_command.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="predict_command.html">predict_command</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="predict_command.py.html">predict_command.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="sample_command.html">sample_command</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="sample_command.py.html">sample_command.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="set_command.html">set_command</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="set_command.py.html">set_command.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="simulate_command.html">simulate_command</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="simulate_command.py.html">simulate_command.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="python.html">python</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="average_integrand.html">average_integrand</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="user_average_integrand.py.html">user_average_integrand.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="connection_file.html">connection_file</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="user_connection_file.py.html">user_connection_file.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="create_connection.html">create_connection</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="create_database.html">create_database</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="create_database.py.html">create_database.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="create_table.html">create_table</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="create_table.py.html">create_table.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="csv2db_command.html">csv2db_command</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="db2csv_command.html">db2csv_command</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="db2csv_command.py.html">db2csv_command.py</a></li>
<li class="toctree-l4"><a class="reference internal" href="ihme_db.sh.html">ihme_db.sh</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="get_name_type.html">get_name_type</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="get_name_type.py.html">get_name_type.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="get_row_list.html">get_row_list</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="get_row_list.py.html">get_row_list.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="get_table_dict.html">get_table_dict</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="get_table_dict.py.html">get_table_dict.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="metropolis.html">metropolis</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="user_metropolis.py.html">user_metropolis.py</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="modify_command.html">modify_command</a><input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" role="switch" type="checkbox"/><label for="toctree-checkbox-47"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="modify_command.py.html">modify_command.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="perturb_command.html">perturb_command</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_curve.html">plot_curve</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_data_fit.html">plot_data_fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="plot_rate_fit.html">plot_rate_fit</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="replace_table.html">replace_table</a><input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" role="switch" type="checkbox"/><label for="toctree-checkbox-48"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="replace_table.py.html">replace_table.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sql_command.html">sql_command</a></li>
<li class="toctree-l3"><a class="reference internal" href="system_command_prc.html">system_command_prc</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="unicode_tuple.html">unicode_tuple</a><input class="toctree-checkbox" id="toctree-checkbox-49" name="toctree-checkbox-49" role="switch" type="checkbox"/><label for="toctree-checkbox-49"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="unicode_tuple.py.html">unicode_tuple.py</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="release_notes.html">release_notes</a><input class="toctree-checkbox" id="toctree-checkbox-50" name="toctree-checkbox-50" role="switch" type="checkbox"/><label for="toctree-checkbox-50"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2022.html">whats_new_2022</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2021.html">whats_new_2021</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2020.html">whats_new_2020</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2019.html">whats_new_2019</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2018.html">whats_new_2018</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2017.html">whats_new_2017</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2016.html">whats_new_2016</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_2015.html">whats_new_2015</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="wish_list.html">wish_list</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="xrst_index.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <p class="hidden"><span class="math notranslate nohighlight">\(\newcommand{\B}[1]{ {\bf #1} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\R}[1]{ {\rm #1} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\W}[1]{ \; #1 \; }\)</span></p>
<section id="user-cascade-py">
<span id="user-cascade-py-name"></span><h1>user_cascade.py<a class="headerlink" href="#user-cascade-py" title="Permalink to this headline">#</a></h1>
<p>xrst input file: <code class="docutils literal notranslate"><span class="pre">example/user/cascade.py</span></code></p>
<section id="generating-priors-for-next-level-down-node-tree">
<span id="user-cascade-py-title"></span><span id="index-0"></span><h2>Generating Priors For Next Level Down Node Tree<a class="headerlink" href="#generating-priors-for-next-level-down-node-tree" title="Permalink to this headline">#</a></h2>
<section id="node-table">
<span id="user-cascade-py-node-table"></span><span id="index-1"></span><h3>Node Table<a class="headerlink" href="#node-table" title="Permalink to this headline">#</a></h3>
<p>The following is a diagram of the node tree for this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>            <span class="n">n1</span>
      <span class="o">/-----/</span>\<span class="o">-----</span>\
    <span class="n">n11</span>            <span class="n">n12</span>
  <span class="o">/</span>     \        <span class="o">/</span>     \
<span class="n">n111</span>   <span class="n">n112</span>    <span class="n">n121</span>   <span class="n">n122</span>
</pre></div>
</div>
<p>We refer to <em>n1</em> as the root node and
<em>n111</em> , <em>n112</em> , <em>n121</em> , <em>n122</em> as the leaf nodes.</p>
</section>
<section id="problem">
<span id="user-cascade-py-problem"></span><span id="index-2"></span><h3>Problem<a class="headerlink" href="#problem" title="Permalink to this headline">#</a></h3>
<p>Given the information for a fit with <em>n1</em> as the parent,
with corresponding data <em>y1</em> ,
pass down summary information for a fit with <em>n11</em> as the parent
with corresponding data <em>y11</em> .</p>
</section>
<section id="procedure">
<span id="user-cascade-py-procedure"></span><span id="index-3"></span><h3>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">#</a></h3>
<section id="step-1-create-database">
<span id="user-cascade-py-procedure-step-1-create-database"></span><span id="index-4"></span><h4>Step 1: Create Database<a class="headerlink" href="#step-1-create-database" title="Permalink to this headline">#</a></h4>
<p>This first database <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code>
is for fitting with <em>n1</em> as the parent and predicting
for <em>n11</em> .</p>
</section>
<section id="step-2-fit-with-n1-as-parent">
<span id="user-cascade-py-procedure-step-2-fit-with-n1-as-parent"></span><span id="index-5"></span><h4>Step 2: Fit With n1 As Parent<a class="headerlink" href="#step-2-fit-with-n1-as-parent" title="Permalink to this headline">#</a></h4>
<p>Use <a class="reference internal" href="fit_command.html#fit-command-variables-both"><span class="std std-ref">fit both</span></a>
to fit with <em>n1</em> as the parent to obtain
<em>e1</em> the corresponding estimate for the <a class="reference internal" href="model_variables.html#model-variables-name"><span class="std std-ref">model_variables</span></a> .
This is done using database <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code></p>
</section>
<section id="step-3-simulate-data">
<span id="user-cascade-py-procedure-step-3-simulate-data"></span><span id="index-6"></span><h4>Step 3: Simulate Data<a class="headerlink" href="#step-3-simulate-data" title="Permalink to this headline">#</a></h4>
<p>Set the <a class="reference internal" href="truth_var_table.html#truth-var-table-name"><span class="std std-ref">truth_var_table</span></a> equal to the estimate <em>e1</em>
and then use the <a class="reference internal" href="simulate_command.html#simulate-command-name"><span class="std std-ref">simulate_command</span></a> to simulate <em>N</em> data sets.
This is done using database <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code></p>
</section>
<section id="step-4-sample-posterior">
<span id="user-cascade-py-procedure-step-4-sample-posterior"></span><span id="index-7"></span><h4>Step 4: Sample Posterior<a class="headerlink" href="#step-4-sample-posterior" title="Permalink to this headline">#</a></h4>
<p>Use the sample command with the
<a class="reference internal" href="sample_command.html#sample-command-simulate"><span class="std std-ref">simulate</span></a> method
to create <em>N</em> samples of the model variables.
Call these samples <em>s1_1</em> , … , <em>s1_N</em> .
This is done using database <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code></p>
</section>
<section id="step-5-predictions-for-n11">
<span id="user-cascade-py-procedure-step-5-predictions-for-n11"></span><span id="index-8"></span><h4>Step 5: Predictions For n11<a class="headerlink" href="#step-5-predictions-for-n11" title="Permalink to this headline">#</a></h4>
<p>Use the predict command with the
<a class="reference internal" href="predict_command.html#predict-command-source-sample"><span class="std std-ref">sample</span></a>
to create <em>N</em> predictions for the
model variable corresponding to fit with <em>n11</em> as the parent.
Call these predictions <em>p11_1</em> , … , <em>p11_N</em> .
This is done using database <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code></p>
</section>
<section id="step-6-priors-for-n11-as-parent">
<span id="user-cascade-py-procedure-step-6-priors-for-n11-as-parent"></span><span id="index-9"></span><h4>Step 6: Priors For n11 As Parent<a class="headerlink" href="#step-6-priors-for-n11-as-parent" title="Permalink to this headline">#</a></h4>
<p>Use the predictions <em>p11_1</em> , … , <em>p11_N</em> to create priors
for the model variables corresponding to fitting with <em>n11</em>
as the parent and with data <em>y11</em> .
In this process account for the fact that the data <em>y11</em> is a subset
of <em>y1</em> which was used to obtain the predictions.
These priors are written to the database <code class="docutils literal notranslate"><span class="pre">fit_n11.db</span></code>
which starts as a copy of the final <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code> .
This is done so that the subsequent
<a class="reference internal" href="init_command.html#init-command-name"><span class="std std-ref">init</span></a> and <a class="reference internal" href="fit_command.html#fit-command-name"><span class="std std-ref">fit</span></a> commands
do not wipe out the results stored in <code class="docutils literal notranslate"><span class="pre">fit_n1.db</span></code> .</p>
</section>
<section id="step-7-fit-n11-as-parent">
<span id="user-cascade-py-procedure-step-7-fit-n11-as-parent"></span><span id="index-10"></span><h4>Step 7: Fit n11 As Parent<a class="headerlink" href="#step-7-fit-n11-as-parent" title="Permalink to this headline">#</a></h4>
<p>Use <a class="reference internal" href="fit_command.html#fit-command-variables-both"><span class="std std-ref">fit both</span></a>
to fit with <em>n11</em> as the parent to obtain
<em>e11</em> corresponding estimate for the model variables.</p>
</section>
</section>
<section id="problem-parameters">
<span id="user-cascade-py-problem-parameters"></span><span id="index-11"></span><h3>Problem Parameters<a class="headerlink" href="#problem-parameters" title="Permalink to this headline">#</a></h3>
<p>The following parameters, used in this example, can be changed:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">iota_no_effect</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">:</span>
   <span class="k">return</span> <span class="mf">0.01</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">age</span> <span class="o">/</span> <span class="mf">100.0</span> <span class="c1"># must be non-decreasing with age</span>
<span class="n">data_per_leaf</span> <span class="o">=</span>  <span class="mi">10</span>    <span class="c1"># number of simulated data points for each leaf node</span>
<span class="n">meas_cv</span>       <span class="o">=</span>  <span class="mf">0.10</span>  <span class="c1"># coefficient of variation for each data point</span>
<span class="n">alpha_true</span>    <span class="o">=</span> <span class="o">-</span><span class="mf">0.10</span>  <span class="c1"># rate_value covariate multiplier used to simulate data</span>
<span class="n">random_seed</span>   <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># if zero, seed off the clock</span>
<span class="n">number_sample</span> <span class="o">=</span>  <span class="mi">10</span>    <span class="c1"># number of simulated data sets and posterior samples</span>
<span class="c1">#</span>
<span class="n">random_effect</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>  <span class="o">=</span>  <span class="mf">0.2</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n12&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.1</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n112&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.1</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n122&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span>
<span class="c1">#</span>
<span class="n">avg_income</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n112&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n122&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n112&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n12&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n122&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>  <span class="o">+</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n12&#39;</span><span class="p">])</span> <span class="o">/</span><span class="mf">2.0</span>
</pre></div>
</div>
</section>
<section id="age-and-time-values">
<span id="user-cascade-py-age-and-time-values"></span><span id="index-12"></span><h3>Age and Time Values<a class="headerlink" href="#age-and-time-values" title="Permalink to this headline">#</a></h3>
<p>The time values do not matter for this problem
because all the functions are constant with respect to time.
The <a class="reference internal" href="age_table.html#age-table-name"><span class="std std-ref">age_table</span></a> for this problem is given by</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span>   <span class="n">age_list</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mf">100.0</span> <span class="p">]</span>
</pre></div>
</div>
<p>We use <em>n_age</em> to denote the length of this table.</p>
</section>
<section id="rate-table">
<span id="user-cascade-py-rate-table"></span><span id="index-13"></span><h3>Rate Table<a class="headerlink" href="#rate-table" title="Permalink to this headline">#</a></h3>
<p>The only rate in this problem is <em>iota</em> . There are <em>n_age</em>
<a class="reference internal" href="model_variables.html#model-variables-fixed-effects-theta-parent-rates"><span class="std std-ref">parent rate</span></a>
values for <em>iota</em> , one for each point in the age table.
There are two <em>iota</em>
<a class="reference internal" href="model_variables.html#model-variables-random-effects-u-child-rate-effects"><span class="std std-ref">Child Rate Effects</span></a> ,
one for each child node.
Note that there are two children when fitting <em>n1</em> as the parent
and when fitting <em>n11</em> as the parent.</p>
</section>
<section id="covariates">
<span id="user-cascade-py-covariates"></span><span id="index-14"></span><h3>Covariates<a class="headerlink" href="#covariates" title="Permalink to this headline">#</a></h3>
<p>There are two <a class="reference internal" href="covariate_table.html#covariate-table-name"><span class="std std-ref">covariates</span></a> for this example.
One covariate has the constant one and reference zero.
The other covariate is income and uses the average for its reference.
The average income is different depending on whether
<em>n1</em> or <em>n11</em>
is the parent.</p>
</section>
<section id="multipliers">
<span id="user-cascade-py-multipliers"></span><span id="index-15"></span><h3>Multipliers<a class="headerlink" href="#multipliers" title="Permalink to this headline">#</a></h3>
<p>There are two
<a class="reference internal" href="model_variables.html#model-variables-fixed-effects-theta-group-covariate-multipliers"><span class="std std-ref">Group Covariate Multipliers</span></a> .</p>
<section id="gamma">
<span id="user-cascade-py-multipliers-gamma"></span><span id="index-16"></span><h4>gamma<a class="headerlink" href="#gamma" title="Permalink to this headline">#</a></h4>
<p>One multiplier multiples the constant one and models the unknown variation
in the data (sometimes referred to as model misspecification).
We call this covariate multiplier
<a class="reference internal" href="data_like.html#data-like-measurement-noise-covariates-gamma-j-a-t"><span class="std std-ref">gamma</span></a> .
We use a uniform prior on this multiplier so that it absorbs
all the noise due to model misspecification.
When checking for coverage by the samples <em>s1_1</em> , … , <em>s1_N</em> ,
we expand the sample standard deviation by a factor of
(1 + <em>gamma</em> ) .
This accounts for the fact that the noise absorbed by <em>gamma</em>
is modeled as independent between data points.
When fitting with <em>n1</em> as the parent, this noise is
correlated between samples in the same leaf.</p>
</section>
<section id="alpha">
<span id="user-cascade-py-multipliers-alpha"></span><span id="index-17"></span><h4>alpha<a class="headerlink" href="#alpha" title="Permalink to this headline">#</a></h4>
<p>The other multiplier multiplies income and affects <em>iota</em> .
We call this covariate multiplier
<a class="reference internal" href="avg_integrand.html#avg-integrand-rate-functions-group-rate-covariate-multiplier-alpha-jk"><span class="std std-ref">alpha</span></a> .
We note that both average income and random effects vary between the nodes.
When fitting with <em>n1</em> as the parent,
<em>alpha</em> tries to absorb the random effects at the leaf level.
We use a Laplace prior on <em>alpha</em> to reduce this effect.</p>
</section>
</section>
<section id="data-table">
<span id="user-cascade-py-data-table"></span><span id="index-18"></span><h3>Data Table<a class="headerlink" href="#data-table" title="Permalink to this headline">#</a></h3>
<p>For this example, all the data is
<a class="reference internal" href="avg_integrand.html#avg-integrand-integrand-i-i-a-t-sincidence"><span class="std std-ref">Sincidence</span></a> .
There are <em>data_per_leaf</em> data point for each leaf node.
Income is varies within each leaf node so the random effect
can be separated from the income effect.
Normally there is much more data, so we compensate by using
a small coefficient of variation for the measurement values
<em>meas_cv</em> .
The simulation value of <em>iota</em> , corresponding to no effect, is
a function of age and defined by <code class="docutils literal notranslate"><span class="pre">iota_no_effect</span></code> ( <em>age</em> ) .
Each data point corresponds to a leaf node.
The total effect for a data point is
the random effect for the leaf node,
plus the random effect for parent of the leaf,
plus the income effect.
Each data point is for a specific age and the corresponding mean
is <em>iota_no_effect</em> ( <code class="docutils literal notranslate"><span class="pre">age</span></code> ) times the exponential of the total effect.
The standard deviation of the data is <em>meas_cv</em> times its mean.
A Gaussian with this mean and standard deviation is used to simulate
each data point.</p>
</section>
<section id="source-code">
<span id="user-cascade-py-source-code"></span><span id="index-19"></span><h3>Source Code<a class="headerlink" href="#source-code" title="Permalink to this headline">#</a></h3>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="c1"># begin problem parameters</span>
<span class="k">def</span> <span class="nf">iota_no_effect</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">:</span>
   <span class="k">return</span> <span class="mf">0.01</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">age</span> <span class="o">/</span> <span class="mf">100.0</span> <span class="c1"># must be non-decreasing with age</span>
<span class="n">data_per_leaf</span> <span class="o">=</span>  <span class="mi">10</span>    <span class="c1"># number of simulated data points for each leaf node</span>
<span class="n">meas_cv</span>       <span class="o">=</span>  <span class="mf">0.10</span>  <span class="c1"># coefficient of variation for each data point</span>
<span class="n">alpha_true</span>    <span class="o">=</span> <span class="o">-</span><span class="mf">0.10</span>  <span class="c1"># rate_value covariate multiplier used to simulate data</span>
<span class="n">random_seed</span>   <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># if zero, seed off the clock</span>
<span class="n">number_sample</span> <span class="o">=</span>  <span class="mi">10</span>    <span class="c1"># number of simulated data sets and posterior samples</span>
<span class="c1">#</span>
<span class="n">random_effect</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>  <span class="o">=</span>  <span class="mf">0.2</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n12&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.1</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n112&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">0.1</span>
<span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n122&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">random_effect</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span>
<span class="c1">#</span>
<span class="n">avg_income</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n112&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n122&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n111&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n112&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n12&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n121&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n122&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
<span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">]</span>  <span class="o">+</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n12&#39;</span><span class="p">])</span> <span class="o">/</span><span class="mf">2.0</span>
<span class="c1"># end problem parameters</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">if</span> <span class="n">random_seed</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
   <span class="n">random_seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="p">)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># run in build/example/user using local (not installed) version of dismod_at</span>
<span class="n">test_program</span> <span class="o">=</span> <span class="s1">&#39;example/user/cascade.py&#39;</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">test_program</span>  <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">:</span>
   <span class="n">usage</span>  <span class="o">=</span> <span class="s1">&#39;python3 &#39;</span> <span class="o">+</span> <span class="n">test_program</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">usage</span> <span class="o">+=</span> <span class="s1">&#39;where python3 is the python 3 program on your system</span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">usage</span> <span class="o">+=</span> <span class="s1">&#39;and working directory is the dismod_at distribution directory</span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_program</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># import dismod_at</span>
<span class="n">local_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/python&#39;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span> <span class="n">local_dir</span> <span class="o">+</span> <span class="s1">&#39;/dismod_at&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
   <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">local_dir</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">dismod_at</span>
<span class="c1">#</span>
<span class="c1"># change into the build/example/user directory</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;build/example/user&#39;</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;build/example/user&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;build/example/user&#39;</span><span class="p">)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># count number of rows in an sql file</span>
<span class="k">def</span> <span class="nf">sql_count_rows</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">sqlcmd</span> <span class="o">=</span> <span class="s1">&#39;SELECT COUNT(*) FROM &#39;</span> <span class="o">+</span> <span class="n">table_name</span>
   <span class="n">result</span> <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
   <span class="n">n_row</span>  <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">return</span> <span class="n">n_row</span>
<span class="c1">#</span>
<span class="c1"># average integrand</span>
<span class="k">def</span> <span class="nf">avg_integrand</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">total_effect</span>  <span class="o">=</span> <span class="n">alpha_true</span> <span class="o">*</span> <span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">])</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">:</span>
      <span class="n">total_effect</span> <span class="o">+=</span> <span class="n">random_effect</span><span class="p">[</span> <span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="p">]</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">:</span>
      <span class="n">total_effect</span> <span class="o">+=</span> <span class="n">random_effect</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
   <span class="k">return</span> <span class="n">iota_no_effect</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">total_effect</span><span class="p">)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">example_db</span> <span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="p">:</span>
   <span class="k">def</span> <span class="nf">fun_iota_n1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;prior_iota_n1_value&#39;</span><span class="p">,</span> <span class="s1">&#39;prior_iota_n1_dage&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
   <span class="k">def</span> <span class="nf">fun_iota_child</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;prior_iota_child&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
   <span class="k">def</span> <span class="nf">fun_alpha_n1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;prior_alpha_n1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
   <span class="k">def</span> <span class="nf">fun_gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;prior_gamma&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
   <span class="c1">#</span>
   <span class="c1"># node_table</span>
   <span class="n">node_table</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n1&#39;</span><span class="p">,</span>      <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span>    <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n11&#39;</span><span class="p">,</span>     <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;n1&#39;</span>  <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n12&#39;</span><span class="p">,</span>     <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;n1&#39;</span>  <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n111&#39;</span><span class="p">,</span>    <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;n11&#39;</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n112&#39;</span><span class="p">,</span>    <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;n11&#39;</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n121&#39;</span><span class="p">,</span>    <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;n12&#39;</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;n122&#39;</span><span class="p">,</span>    <span class="s1">&#39;parent&#39;</span><span class="p">:</span><span class="s1">&#39;n12&#39;</span> <span class="p">},</span>
   <span class="p">]</span>
   <span class="c1"># BEGIN age_table</span>
   <span class="n">age_list</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mf">100.0</span> <span class="p">]</span>
   <span class="c1"># END age_table</span>
   <span class="c1">#</span>
   <span class="c1"># time_table</span>
   <span class="n">time_list</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">1990.0</span><span class="p">,</span> <span class="mf">2020.0</span> <span class="p">]</span>
   <span class="c1"># rate_table</span>
   <span class="n">rate_table</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span>
      <span class="s1">&#39;name&#39;</span><span class="p">:</span>          <span class="s1">&#39;iota&#39;</span><span class="p">,</span>
      <span class="s1">&#39;parent_smooth&#39;</span><span class="p">:</span> <span class="s1">&#39;smooth_iota_n1&#39;</span><span class="p">,</span>
      <span class="s1">&#39;child_smooth&#39;</span><span class="p">:</span>  <span class="s1">&#39;smooth_iota_child&#39;</span><span class="p">,</span>
   <span class="p">}</span> <span class="p">]</span>
   <span class="c1"># covariate_table</span>
   <span class="n">covariate_table</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;one&#39;</span><span class="p">,</span>    <span class="s1">&#39;reference&#39;</span><span class="p">:</span><span class="mf">0.0</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;income&#39;</span><span class="p">,</span> <span class="s1">&#39;reference&#39;</span><span class="p">:</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span> <span class="p">},</span>
   <span class="p">]</span>
   <span class="c1"># mulcov_table</span>
   <span class="n">mulcov_table</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span>
      <span class="s1">&#39;covariate&#39;</span><span class="p">:</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span>
      <span class="s1">&#39;type&#39;</span><span class="p">:</span>      <span class="s1">&#39;meas_noise&#39;</span><span class="p">,</span>
      <span class="s1">&#39;effected&#39;</span><span class="p">:</span>  <span class="s1">&#39;Sincidence&#39;</span><span class="p">,</span>
      <span class="s1">&#39;group&#39;</span><span class="p">:</span>     <span class="s1">&#39;world&#39;</span><span class="p">,</span>
      <span class="s1">&#39;smooth&#39;</span><span class="p">:</span>    <span class="s1">&#39;smooth_gamma&#39;</span>
      <span class="p">},{</span>
      <span class="s1">&#39;covariate&#39;</span><span class="p">:</span> <span class="s1">&#39;income&#39;</span><span class="p">,</span>
      <span class="s1">&#39;type&#39;</span><span class="p">:</span>      <span class="s1">&#39;rate_value&#39;</span><span class="p">,</span>
      <span class="s1">&#39;effected&#39;</span><span class="p">:</span>  <span class="s1">&#39;iota&#39;</span><span class="p">,</span>
      <span class="s1">&#39;group&#39;</span><span class="p">:</span>     <span class="s1">&#39;world&#39;</span><span class="p">,</span>
      <span class="s1">&#39;smooth&#39;</span><span class="p">:</span>    <span class="s1">&#39;smooth_alpha_n1&#39;</span>
   <span class="p">}</span> <span class="p">]</span>
   <span class="c1"># prior_table</span>
   <span class="n">prior_table</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span>   <span class="c1"># prior_iota_n1_value</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>    <span class="s1">&#39;prior_iota_n1_value&#39;</span><span class="p">,</span>
         <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
         <span class="s1">&#39;lower&#39;</span><span class="p">:</span>   <span class="n">iota_no_effect</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span>
         <span class="s1">&#39;upper&#39;</span><span class="p">:</span>   <span class="n">iota_no_effect</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">,</span>
         <span class="s1">&#39;mean&#39;</span><span class="p">:</span>    <span class="n">iota_no_effect</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
      <span class="p">},{</span> <span class="c1"># prior_iota_n1_dage</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>    <span class="s1">&#39;prior_iota_n1_dage&#39;</span><span class="p">,</span>
         <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="s1">&#39;log_gaussian&#39;</span><span class="p">,</span>
         <span class="s1">&#39;mean&#39;</span><span class="p">:</span>     <span class="mf">0.0</span><span class="p">,</span>
         <span class="s1">&#39;std&#39;</span><span class="p">:</span>      <span class="mf">1.0</span><span class="p">,</span>
         <span class="s1">&#39;eta&#39;</span><span class="p">:</span>      <span class="n">iota_no_effect</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span>
      <span class="p">},{</span> <span class="c1"># prior_iota_child</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>    <span class="s1">&#39;prior_iota_child&#39;</span><span class="p">,</span>
         <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
         <span class="s1">&#39;mean&#39;</span><span class="p">:</span>     <span class="mf">0.0</span><span class="p">,</span>
         <span class="s1">&#39;std&#39;</span><span class="p">:</span>      <span class="mf">1.0</span><span class="p">,</span>
      <span class="p">},{</span> <span class="c1"># prior_alpha_n1</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>    <span class="s1">&#39;prior_alpha_n1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="s1">&#39;laplace&#39;</span><span class="p">,</span>
         <span class="s1">&#39;mean&#39;</span><span class="p">:</span>     <span class="mf">0.0</span><span class="p">,</span>
         <span class="s1">&#39;std&#39;</span><span class="p">:</span>      <span class="mf">0.01</span><span class="p">,</span>
         <span class="s1">&#39;lower&#39;</span><span class="p">:</span>   <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">alpha_true</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">,</span>
         <span class="s1">&#39;upper&#39;</span><span class="p">:</span>    <span class="nb">abs</span><span class="p">(</span><span class="n">alpha_true</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">,</span>
      <span class="p">},{</span> <span class="c1"># prior_gamma</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>    <span class="s1">&#39;prior_gamma&#39;</span><span class="p">,</span>
         <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
         <span class="s1">&#39;mean&#39;</span><span class="p">:</span>     <span class="mf">0.0</span><span class="p">,</span>
         <span class="s1">&#39;std&#39;</span><span class="p">:</span>      <span class="mf">1.0</span><span class="p">,</span>
         <span class="s1">&#39;lower&#39;</span><span class="p">:</span>    <span class="mf">0.0</span><span class="p">,</span>
         <span class="s1">&#39;upper&#39;</span><span class="p">:</span>   <span class="mf">10.0</span><span class="p">,</span>
      <span class="p">}</span>
   <span class="p">]</span>
   <span class="c1"># smooth_table</span>
   <span class="n">smooth_table</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span>   <span class="c1"># smooth_iota_n1</span>
         <span class="s1">&#39;name&#39;</span> <span class="p">:</span>    <span class="s1">&#39;smooth_iota_n1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;age_id&#39;</span><span class="p">:</span>   <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">age_list</span><span class="p">)),</span>
         <span class="s1">&#39;time_id&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;fun&#39;</span><span class="p">:</span>      <span class="n">fun_iota_n1</span>
      <span class="p">},{</span> <span class="c1"># smooth_iota_child</span>
         <span class="s1">&#39;name&#39;</span> <span class="p">:</span>    <span class="s1">&#39;smooth_iota_child&#39;</span><span class="p">,</span>
         <span class="s1">&#39;age_id&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;time_id&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;fun&#39;</span><span class="p">:</span>      <span class="n">fun_iota_child</span>
      <span class="p">},{</span> <span class="c1"># smooth_alpha_n1</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>     <span class="s1">&#39;smooth_alpha_n1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;age_id&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;time_id&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;fun&#39;</span><span class="p">:</span>      <span class="n">fun_alpha_n1</span>
      <span class="p">},{</span> <span class="c1"># smooth_gamma</span>
         <span class="s1">&#39;name&#39;</span><span class="p">:</span>     <span class="s1">&#39;smooth_gamma&#39;</span><span class="p">,</span>
         <span class="s1">&#39;age_id&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;time_id&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;fun&#39;</span><span class="p">:</span>      <span class="n">fun_gamma</span>
      <span class="p">}</span>
   <span class="p">]</span>
   <span class="c1"># weight table:</span>
   <span class="n">weight_table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
   <span class="c1"># nslist_table</span>
   <span class="n">nslist_table</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
   <span class="c1"># option_table</span>
   <span class="n">option_table</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;parent_node_name&#39;</span><span class="p">,</span>      <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;n1&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;rate_case&#39;</span><span class="p">,</span>             <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;iota_pos_rho_zero&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;zero_sum_child_rate&#39;</span><span class="p">,</span>  <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;iota&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;meas_noise_effect&#39;</span><span class="p">,</span>    <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;add_var_scale_all&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;quasi_fixed&#39;</span><span class="p">,</span>           <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;max_num_iter_fixed&#39;</span><span class="p">,</span>    <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;100&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;print_level_fixed&#39;</span><span class="p">,</span>     <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;0&#39;</span><span class="p">},</span>
      <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;tolerance_fixed&#39;</span><span class="p">,</span>       <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;1e-12&#39;</span><span class="p">},</span>
   <span class="p">]</span>
   <span class="c1"># integrand_table</span>
   <span class="n">integrand_table</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;Sincidence&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;mulcov_1&#39;</span><span class="p">}</span> <span class="p">]</span>
   <span class="c1"># ------------------------------------------------------------------------</span>
   <span class="c1"># data_table</span>
   <span class="n">data_table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
   <span class="c1"># values that are the same for all data points</span>
   <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;integrand&#39;</span><span class="p">:</span>   <span class="s1">&#39;Sincidence&#39;</span><span class="p">,</span>
      <span class="s1">&#39;density&#39;</span><span class="p">:</span>     <span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
      <span class="s1">&#39;weight&#39;</span><span class="p">:</span>      <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;hold_out&#39;</span><span class="p">:</span>    <span class="kc">False</span><span class="p">,</span>
      <span class="s1">&#39;time_lower&#39;</span><span class="p">:</span>  <span class="mf">2000.0</span><span class="p">,</span>
      <span class="s1">&#39;time_upper&#39;</span><span class="p">:</span>  <span class="mf">2000.0</span><span class="p">,</span>
      <span class="s1">&#39;one&#39;</span><span class="p">:</span>         <span class="mf">1.0</span><span class="p">,</span>
      <span class="s1">&#39;subgroup&#39;</span><span class="p">:</span>    <span class="s1">&#39;world&#39;</span><span class="p">,</span>
   <span class="p">}</span>
   <span class="k">assert</span> <span class="n">covariate_table</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;income&#39;</span>
   <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">age_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">age_list</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
      <span class="n">age</span>       <span class="o">=</span> <span class="n">age_list</span><span class="p">[</span><span class="n">age_id</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;n111&#39;</span><span class="p">,</span> <span class="s1">&#39;n112&#39;</span><span class="p">,</span> <span class="s1">&#39;n121&#39;</span><span class="p">,</span> <span class="s1">&#39;n122&#39;</span> <span class="p">]</span> <span class="p">:</span>
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data_per_leaf</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">income</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">avg_income</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">data_per_leaf</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">iota</span>       <span class="o">=</span> <span class="n">avg_integrand</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">income</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="n">meas_std</span>   <span class="o">=</span> <span class="n">iota</span> <span class="o">*</span> <span class="n">meas_cv</span>
            <span class="n">meas_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">iota</span><span class="p">,</span> <span class="n">meas_std</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">node</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;meas_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meas_value</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;meas_std&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">meas_std</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;age_lower&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">age</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;age_upper&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">age</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;income&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">income</span>
            <span class="n">data_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="p">)</span>
   <span class="c1"># ------------------------------------------------------------------------</span>
   <span class="c1"># avgint_table</span>
   <span class="n">avgint_table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
   <span class="c1"># values that are the same for all data points</span>
   <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;node&#39;</span><span class="p">:</span>        <span class="s1">&#39;n11&#39;</span><span class="p">,</span>
      <span class="s1">&#39;subgroup&#39;</span><span class="p">:</span>    <span class="s1">&#39;world&#39;</span><span class="p">,</span>
      <span class="s1">&#39;weight&#39;</span><span class="p">:</span>      <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;hold_out&#39;</span><span class="p">:</span>    <span class="kc">False</span><span class="p">,</span>
      <span class="s1">&#39;time_lower&#39;</span><span class="p">:</span>  <span class="mf">2000.0</span><span class="p">,</span>
      <span class="s1">&#39;time_upper&#39;</span><span class="p">:</span>  <span class="mf">2000.0</span><span class="p">,</span>
      <span class="s1">&#39;income&#39;</span><span class="p">:</span>      <span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">],</span>
      <span class="s1">&#39;one&#39;</span><span class="p">:</span>         <span class="mf">1.0</span><span class="p">,</span>
   <span class="p">}</span>
   <span class="k">for</span> <span class="n">age_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">age_list</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
      <span class="n">age</span>  <span class="o">=</span> <span class="n">age_list</span><span class="p">[</span><span class="n">age_id</span><span class="p">]</span>
      <span class="n">row</span><span class="p">[</span><span class="s1">&#39;integrand&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;Sincidence&#39;</span>
      <span class="n">row</span><span class="p">[</span><span class="s1">&#39;age_lower&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">age</span>
      <span class="n">row</span><span class="p">[</span><span class="s1">&#39;age_upper&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">age</span>
      <span class="n">avgint_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="p">)</span>
   <span class="c1"># alpha is constant w.r.t age and time</span>
   <span class="k">assert</span> <span class="n">mulcov_table</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rate_value&#39;</span>
   <span class="n">row</span><span class="p">[</span><span class="s1">&#39;integrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mulcov_1&#39;</span>
   <span class="n">row</span><span class="p">[</span><span class="s1">&#39;age_lower&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
   <span class="n">row</span><span class="p">[</span><span class="s1">&#39;age_upper&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
   <span class="n">avgint_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="p">)</span>
   <span class="c1"># ----------------------------------------------------------------------</span>
   <span class="c1"># subgroup_table</span>
   <span class="n">subgroup_table</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> <span class="s1">&#39;subgroup&#39;</span><span class="p">:</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">:</span><span class="s1">&#39;world&#39;</span> <span class="p">}</span> <span class="p">]</span>
   <span class="c1"># ----------------------------------------------------------------------</span>
   <span class="c1"># create database</span>
   <span class="n">dismod_at</span><span class="o">.</span><span class="n">create_database</span><span class="p">(</span>
      <span class="n">file_name</span><span class="p">,</span>
      <span class="n">age_list</span><span class="p">,</span>
      <span class="n">time_list</span><span class="p">,</span>
      <span class="n">integrand_table</span><span class="p">,</span>
      <span class="n">node_table</span><span class="p">,</span>
      <span class="n">subgroup_table</span><span class="p">,</span>
      <span class="n">weight_table</span><span class="p">,</span>
      <span class="n">covariate_table</span><span class="p">,</span>
      <span class="n">avgint_table</span><span class="p">,</span>
      <span class="n">data_table</span><span class="p">,</span>
      <span class="n">prior_table</span><span class="p">,</span>
      <span class="n">smooth_table</span><span class="p">,</span>
      <span class="n">nslist_table</span><span class="p">,</span>
      <span class="n">rate_table</span><span class="p">,</span>
      <span class="n">mulcov_table</span><span class="p">,</span>
      <span class="n">option_table</span>
   <span class="p">)</span>
<span class="c1"># ---------------------------------------------------------------------------</span>
<span class="c1"># Step 1: Create fit_n1.db</span>
<span class="c1"># ---------------------------------------------------------------------------</span>
<span class="n">file_name</span>  <span class="o">=</span> <span class="s1">&#39;fit_n1.db&#39;</span>
<span class="n">example_db</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># init</span>
<span class="n">program</span> <span class="o">=</span> <span class="s1">&#39;../../devel/dismod_at&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span> <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span> <span class="p">]</span> <span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Step 2: Fit With n1 As Parent</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span> <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span> <span class="p">]</span> <span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># check e1</span>
<span class="n">new</span>              <span class="o">=</span> <span class="kc">False</span>
<span class="n">connection</span>       <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
<span class="n">rate_table</span>       <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">)</span>
<span class="n">node_table</span>       <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">)</span>
<span class="n">age_table</span>        <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="n">var_table</span>        <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">)</span>
<span class="n">fit_var_table</span>    <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;fit_var&#39;</span><span class="p">)</span>
<span class="n">covariate_table</span>  <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;covariate&#39;</span><span class="p">)</span>
<span class="n">n_var</span>            <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_table</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_var</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">var_type</span>     <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;var_type&#39;</span><span class="p">]</span>
   <span class="n">age_id</span>       <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;age_id&#39;</span><span class="p">]</span>
   <span class="n">rate_id</span>      <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;rate_id&#39;</span><span class="p">]</span>
   <span class="n">node_id</span>      <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;node_id&#39;</span><span class="p">]</span>
   <span class="n">covariate_id</span> <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;covariate_id&#39;</span><span class="p">]</span>
   <span class="n">value</span>        <span class="o">=</span> <span class="n">fit_var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;fit_var_value&#39;</span><span class="p">]</span>
   <span class="n">fixed</span>        <span class="o">=</span> <span class="kc">True</span>
   <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;rate&#39;</span> <span class="p">:</span>
      <span class="n">age</span>  <span class="o">=</span> <span class="n">age_table</span><span class="p">[</span><span class="n">age_id</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
      <span class="n">node</span> <span class="o">=</span> <span class="n">node_table</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;node_name&#39;</span><span class="p">]</span>
      <span class="n">rate</span> <span class="o">=</span> <span class="n">rate_table</span><span class="p">[</span><span class="n">rate_id</span><span class="p">][</span><span class="s1">&#39;rate_name&#39;</span><span class="p">]</span>
      <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="s1">&#39;iota&#39;</span>
      <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;n1&#39;</span> <span class="p">:</span>
         <span class="n">truth</span> <span class="o">=</span> <span class="n">iota_no_effect</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">:</span>
         <span class="n">truth</span> <span class="o">=</span> <span class="n">random_effect</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
         <span class="n">fixed</span> <span class="o">=</span> <span class="kc">False</span>
   <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;mulcov_rate_value&#39;</span> <span class="p">:</span>
      <span class="n">rate</span>      <span class="o">=</span> <span class="n">rate_table</span><span class="p">[</span><span class="n">rate_id</span><span class="p">][</span><span class="s1">&#39;rate_name&#39;</span><span class="p">]</span>
      <span class="n">covariate</span> <span class="o">=</span> <span class="n">covariate_table</span><span class="p">[</span><span class="n">covariate_id</span><span class="p">][</span><span class="s1">&#39;covariate_name&#39;</span><span class="p">]</span>
      <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="s1">&#39;iota&#39;</span>
      <span class="k">assert</span> <span class="n">covariate</span> <span class="o">==</span> <span class="s1">&#39;income&#39;</span>
      <span class="n">truth</span> <span class="o">=</span> <span class="n">alpha_true</span>
   <span class="k">else</span> <span class="p">:</span>
      <span class="n">covariate</span> <span class="o">=</span> <span class="n">covariate_table</span><span class="p">[</span><span class="n">covariate_id</span><span class="p">][</span><span class="s1">&#39;covariate_name&#39;</span><span class="p">]</span>
      <span class="k">assert</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;mulcov_meas_noise&#39;</span>
      <span class="k">assert</span> <span class="n">covariate</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span>
      <span class="n">gamma_fit_n1</span> <span class="o">=</span> <span class="n">value</span>
   <span class="k">if</span> <span class="n">var_type</span> <span class="o">!=</span> <span class="s1">&#39;mulcov_meas_noise&#39;</span> <span class="p">:</span>
      <span class="n">rel_err</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">value</span> <span class="o">/</span> <span class="n">truth</span><span class="p">)</span>
      <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;fixed=</span><span class="si">{}</span><span class="s1">, truth=</span><span class="si">{:7.4f}</span><span class="s1">, value=</span><span class="si">{:7.4f}</span><span class="s1">, rel_err=</span><span class="si">{:6.3f}</span><span class="s1">&#39;</span>
      <span class="c1"># print( fmt.format(fixed, truth, value, rel_err) )</span>
      <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rel_err</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">2e-1</span> <span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fixed</span><span class="p">,</span> <span class="n">truth</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">rel_err</span><span class="p">)</span> <span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;random_seed = &quot;</span><span class="p">,</span>  <span class="n">random_seed</span><span class="p">)</span>
         <span class="k">assert</span> <span class="kc">False</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Step 3: Simulate Data</span>
<span class="c1"># Step 4: Sample Posterior</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># obtain s1_1, ... , s1_N</span>
<span class="n">N_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_sample</span><span class="p">)</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span>
   <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;truth_var&#39;</span><span class="p">,</span> <span class="s1">&#39;fit_var&#39;</span> <span class="p">]</span>
<span class="p">)</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span>
   <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;start_var&#39;</span><span class="p">,</span> <span class="s1">&#39;fit_var&#39;</span> <span class="p">]</span>
<span class="p">)</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span>
   <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;scale_var&#39;</span><span class="p">,</span> <span class="s1">&#39;fit_var&#39;</span> <span class="p">]</span>
<span class="p">)</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">([</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;simulate&#39;</span><span class="p">,</span> <span class="n">N_str</span> <span class="p">])</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span>
   <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;simulate&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">N_str</span> <span class="p">]</span>
<span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># check coverage of true values by posterior samples standard deviation</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">connection</span>   <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
<span class="n">sample_table</span> <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">)</span>
<span class="n">sample_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">number_sample</span><span class="p">,</span> <span class="n">n_var</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">double</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_table</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
   <span class="n">sample_index</span> <span class="o">=</span> <span class="n">sample_table</span><span class="p">[</span><span class="n">sample_id</span><span class="p">][</span><span class="s1">&#39;sample_index&#39;</span><span class="p">]</span>
   <span class="n">var_id</span>       <span class="o">=</span> <span class="n">sample_table</span><span class="p">[</span><span class="n">sample_id</span><span class="p">][</span><span class="s1">&#39;var_id&#39;</span><span class="p">]</span>
   <span class="n">var_value</span>    <span class="o">=</span> <span class="n">sample_table</span><span class="p">[</span><span class="n">sample_id</span><span class="p">][</span><span class="s1">&#39;var_value&#39;</span><span class="p">]</span>
   <span class="k">assert</span> <span class="n">sample_id</span> <span class="o">==</span> <span class="n">sample_index</span> <span class="o">*</span> <span class="n">n_var</span> <span class="o">+</span> <span class="n">var_id</span>
   <span class="n">sample_array</span><span class="p">[</span><span class="n">sample_index</span><span class="p">,</span> <span class="n">var_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">var_value</span>
<span class="n">sample_std</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sample_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#</span>
<span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_var</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">var_type</span>     <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;var_type&#39;</span><span class="p">]</span>
   <span class="n">age_id</span>       <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;age_id&#39;</span><span class="p">]</span>
   <span class="n">node_id</span>      <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;node_id&#39;</span><span class="p">]</span>
   <span class="n">covariate_id</span> <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;covariate_id&#39;</span><span class="p">]</span>
   <span class="n">fit</span>          <span class="o">=</span> <span class="n">fit_var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;fit_var_value&#39;</span><span class="p">]</span>
   <span class="n">std</span>          <span class="o">=</span> <span class="n">sample_std</span><span class="p">[</span><span class="n">var_id</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">gamma_fit_n1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;rate&#39;</span> <span class="p">:</span>
      <span class="n">age</span>  <span class="o">=</span> <span class="n">age_table</span><span class="p">[</span><span class="n">age_id</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
      <span class="n">node</span> <span class="o">=</span> <span class="n">node_table</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;node_name&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;n1&#39;</span> <span class="p">:</span>
         <span class="n">truth</span> <span class="o">=</span> <span class="n">iota_no_effect</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">:</span>
         <span class="n">truth</span> <span class="o">=</span> <span class="n">random_effect</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
   <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;mulcov_rate_value&#39;</span> <span class="p">:</span>
      <span class="n">truth</span> <span class="o">=</span> <span class="n">alpha_true</span>
   <span class="k">else</span> <span class="p">:</span>
      <span class="k">assert</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;mulcov_meas_noise&#39;</span>
   <span class="k">if</span> <span class="n">var_type</span> <span class="o">!=</span> <span class="s1">&#39;mulcov_meas_noise&#39;</span> <span class="p">:</span>
      <span class="n">std_factor</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="n">fit</span> <span class="o">-</span> <span class="n">truth</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
      <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;truth=</span><span class="si">{:7.4f}</span><span class="s1">, fit=</span><span class="si">{:7.4f}</span><span class="s1">, std_factor=</span><span class="si">{:6.3f}</span><span class="s1">&#39;</span>
      <span class="c1"># print( fmt.format(truth, fit, std_factor) )</span>
      <span class="k">if</span> <span class="n">std_factor</span> <span class="o">&gt;</span> <span class="mf">3.0</span> <span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">truth</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">std_factor</span><span class="p">)</span> <span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;random_seed = &quot;</span><span class="p">,</span>  <span class="n">random_seed</span><span class="p">)</span>
         <span class="k">assert</span> <span class="kc">False</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Step 5: Predictions For n11</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># obtain p11_1, p_11_2, ...</span>
<span class="c1"># and add prior_n11_age values to data base</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">([</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span> <span class="p">])</span>
<span class="n">avgint_table</span>    <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;avgint&#39;</span><span class="p">)</span>
<span class="n">predict_table</span>   <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;predict&#39;</span><span class="p">)</span>
<span class="n">n_avgint</span>        <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">avgint_table</span> <span class="p">)</span>
<span class="n">n_predict</span>       <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">predict_table</span> <span class="p">)</span>
<span class="n">n_subset</span>        <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">n_predict</span> <span class="o">/</span> <span class="n">number_sample</span> <span class="p">)</span>
<span class="k">assert</span> <span class="n">n_predict</span> <span class="o">==</span> <span class="n">n_subset</span> <span class="o">*</span> <span class="n">number_sample</span>
<span class="n">predict_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">number_sample</span><span class="p">,</span> <span class="n">n_avgint</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">double</span> <span class="p">)</span>
<span class="n">predict_found</span> <span class="o">=</span> <span class="n">n_avgint</span> <span class="o">*</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
<span class="k">for</span> <span class="n">predict_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_predict</span> <span class="p">)</span> <span class="p">:</span>
   <span class="n">sample_index</span>  <span class="o">=</span> <span class="n">predict_table</span><span class="p">[</span><span class="n">predict_id</span><span class="p">][</span><span class="s1">&#39;sample_index&#39;</span><span class="p">]</span>
   <span class="n">avgint_id</span>     <span class="o">=</span> <span class="n">predict_table</span><span class="p">[</span><span class="n">predict_id</span><span class="p">][</span><span class="s1">&#39;avgint_id&#39;</span><span class="p">]</span>
   <span class="n">value</span>         <span class="o">=</span> <span class="n">predict_table</span><span class="p">[</span><span class="n">predict_id</span><span class="p">][</span><span class="s1">&#39;avg_integrand&#39;</span><span class="p">]</span>
   <span class="n">predict_array</span><span class="p">[</span><span class="n">sample_index</span><span class="p">,</span> <span class="n">avgint_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
   <span class="n">predict_found</span><span class="p">[</span><span class="n">avgint_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">predict_mean</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predict_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">predict_std</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">predict_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Step 6: Priors for n11 as Parent</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># create fit_n11.db starting from fit_n1.db</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;fit_n11.db&#39;</span><span class="p">)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;fit_n11.db&#39;</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">connection</span>       <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># get last id from certain tables</span>
<span class="n">sqlcmd</span>           <span class="o">=</span> <span class="s1">&#39;SELECT COUNT(prior_id) FROM prior&#39;</span>
<span class="n">result</span>           <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="n">prior_id</span>         <span class="o">=</span> <span class="n">sql_count_rows</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;prior&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">smooth_id</span>        <span class="o">=</span> <span class="n">sql_count_rows</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;smooth&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">smooth_grid_id</span>   <span class="o">=</span> <span class="n">sql_count_rows</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;smooth_grid&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c1">#</span>
<span class="n">sqlcmd</span>      <span class="o">=</span> <span class="s1">&#39;SELECT density_id FROM density WHERE density_name==&quot;uniform&quot;&#39;</span>
<span class="n">result</span>      <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="n">uniform_id</span>  <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#</span>
<span class="n">sqlcmd</span>      <span class="o">=</span> <span class="s1">&#39;SELECT density_id FROM density WHERE density_name==&quot;gaussian&quot;&#39;</span>
<span class="n">result</span>      <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="n">gaussian_id</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># add smooth_iota_n11</span>
<span class="n">smooth_name</span> <span class="o">=</span> <span class="s1">&#39;smooth_iota_n11&#39;</span>
<span class="n">n_age</span>       <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">age_table</span> <span class="p">)</span>
<span class="n">smooth_id</span>   <span class="o">=</span> <span class="n">smooth_id</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;INSERT INTO smooth </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;(smooth_id, smooth_name, n_age, n_time) </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;VALUES (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">smooth_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">smooth_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">n_age</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;1)&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="n">iota_smooth_id</span> <span class="o">=</span> <span class="n">smooth_id</span>
<span class="c1">#</span>
<span class="c1"># add smooth_alpha_n11</span>
<span class="n">smooth_name</span> <span class="o">=</span> <span class="s1">&#39;smooth_alpha_n11&#39;</span>
<span class="n">smooth_id</span>   <span class="o">=</span> <span class="n">smooth_id</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;INSERT INTO smooth </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;(smooth_id, smooth_name, n_age, n_time) </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;VALUES (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">smooth_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">smooth_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;1,&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;1)&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="n">alpha_smooth_id</span> <span class="o">=</span> <span class="n">smooth_id</span>
<span class="c1">#</span>
<span class="c1"># add prior_none</span>
<span class="n">prior_name</span> <span class="o">=</span> <span class="s1">&#39;prior_none&#39;</span>
<span class="n">prior_id</span>   <span class="o">=</span> <span class="n">prior_id</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">sqlcmd</span>     <span class="o">=</span> <span class="s1">&#39;INSERT INTO prior </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">sqlcmd</span>    <span class="o">+=</span> <span class="s1">&#39;(prior_id, prior_name, density_id, mean) </span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">sqlcmd</span>    <span class="o">+=</span> <span class="s1">&#39;VALUES (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prior_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="n">sqlcmd</span>    <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">prior_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span>
<span class="n">sqlcmd</span>    <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uniform_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="n">sqlcmd</span>    <span class="o">+=</span> <span class="s1">&#39;0)&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="n">none_prior_id</span> <span class="o">=</span> <span class="n">smooth_id</span>
<span class="c1">#</span>
<span class="c1"># add new entries in prior and smooth_grid tables</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">age_table</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_avgint</span> <span class="o">-</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">avgint_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">n_avgint</span> <span class="p">)</span> <span class="p">:</span>
   <span class="k">assert</span> <span class="n">predict_found</span><span class="p">[</span><span class="n">avgint_id</span><span class="p">]</span>
   <span class="n">age</span>        <span class="o">=</span> <span class="n">avgint_table</span><span class="p">[</span><span class="n">avgint_id</span><span class="p">][</span><span class="s1">&#39;age_lower&#39;</span><span class="p">]</span>
   <span class="n">mean</span>       <span class="o">=</span> <span class="n">predict_mean</span><span class="p">[</span><span class="n">avgint_id</span><span class="p">]</span>
   <span class="n">std</span>        <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">gamma_fit_n1</span><span class="p">)</span> <span class="o">*</span> <span class="n">predict_std</span><span class="p">[</span><span class="n">avgint_id</span><span class="p">]</span>
   <span class="c1">#</span>
   <span class="c1"># entry in prior table for alpha</span>
   <span class="n">prior_id</span>   <span class="o">=</span> <span class="n">prior_id</span> <span class="o">+</span> <span class="mi">1</span>
   <span class="n">prior_name</span> <span class="o">=</span> <span class="s1">&#39;prior_alpha_n11&#39;</span>
   <span class="n">lower</span>      <span class="o">=</span> <span class="s1">&#39;null&#39;</span>
   <span class="n">upper</span>      <span class="o">=</span> <span class="s1">&#39;null&#39;</span>
   <span class="k">if</span> <span class="n">avgint_id</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">age_table</span><span class="p">)</span> <span class="p">:</span>
      <span class="c1"># entry in prior table for iota</span>
      <span class="n">prior_name</span> <span class="o">=</span> <span class="s1">&#39;prior_iota_n11_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">age</span><span class="p">))</span>
      <span class="n">lower</span>      <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">iota_no_effect</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="p">)</span>
      <span class="n">upper</span>      <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">iota_no_effect</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="p">)</span>
   <span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;INSERT INTO prior </span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;(prior_id, prior_name, density_id, mean, std, lower, upper)</span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;VALUES (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prior_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">prior_name</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">gaussian_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="n">lower</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="n">upper</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
   <span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
   <span class="c1">#</span>
   <span class="c1"># entry in smooth_grid table</span>
   <span class="n">age_id</span>          <span class="o">=</span> <span class="mi">0</span>
   <span class="n">time_id</span>         <span class="o">=</span> <span class="mi">0</span>
   <span class="n">value_prior_id</span>  <span class="o">=</span> <span class="n">prior_id</span>
   <span class="n">dage_prior_id</span>   <span class="o">=</span> <span class="n">none_prior_id</span>
   <span class="n">tmp_smooth_id</span>   <span class="o">=</span> <span class="n">alpha_smooth_id</span>
   <span class="k">if</span> <span class="n">avgint_id</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">age_table</span><span class="p">)</span> <span class="p">:</span>
      <span class="k">assert</span> <span class="n">age</span> <span class="o">==</span> <span class="n">age_table</span><span class="p">[</span><span class="n">avgint_id</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
      <span class="n">age_id</span>        <span class="o">=</span> <span class="n">avgint_id</span>
      <span class="n">tmp_smooth_id</span> <span class="o">=</span> <span class="n">iota_smooth_id</span>
   <span class="n">smooth_grid_id</span>   <span class="o">=</span> <span class="n">smooth_grid_id</span> <span class="o">+</span> <span class="mi">1</span>
   <span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;INSERT INTO smooth_grid </span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;(smooth_grid_id, smooth_id, age_id, time_id, &#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;value_prior_id, dage_prior_id) </span><span class="se">\n</span><span class="s1">&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39;VALUES (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">smooth_grid_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmp_smooth_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">age_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value_prior_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
   <span class="n">sqlcmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dage_prior_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
   <span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># change parent to be n11</span>
<span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;UPDATE option SET option_value = &quot;n11&quot;&#39;</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39; WHERE option_name == &quot;parent_node_name&quot;&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># use smooth_iota_n11 for parent smoothing of iota</span>
<span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;UPDATE rate SET parent_smooth_id = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iota_smooth_id</span><span class="p">)</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39; WHERE rate_name == &quot;iota&quot;&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># use smooth_alpha_n11 for smoothing alpha</span>
<span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;UPDATE mulcov SET group_smooth_id = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha_smooth_id</span><span class="p">)</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39; WHERE mulcov_type == &quot;rate_value&quot;&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># change reference income</span>
<span class="n">sqlcmd</span>  <span class="o">=</span> <span class="s1">&#39;UPDATE covariate SET reference = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">avg_income</span><span class="p">[</span><span class="s1">&#39;n11&#39;</span><span class="p">])</span>
<span class="n">sqlcmd</span> <span class="o">+=</span> <span class="s1">&#39; WHERE covariate_name == &quot;income&quot;&#39;</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">sql_command</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">sqlcmd</span><span class="p">)</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># Step 7: Fit With n11 as Parent</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># obtain e11, estimate of model variables with n11 as the parent node</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span> <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">dismod_at</span><span class="o">.</span><span class="n">system_command_prc</span><span class="p">(</span> <span class="p">[</span> <span class="n">program</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span> <span class="p">]</span> <span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># check e11</span>
<span class="n">var_table</span>        <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">)</span>
<span class="n">fit_var_table</span>    <span class="o">=</span> <span class="n">dismod_at</span><span class="o">.</span><span class="n">get_table_dict</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="s1">&#39;fit_var&#39;</span><span class="p">)</span>
<span class="n">n_var</span>            <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_table</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_var</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">var_type</span>     <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;var_type&#39;</span><span class="p">]</span>
   <span class="n">age_id</span>       <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;age_id&#39;</span><span class="p">]</span>
   <span class="n">rate_id</span>      <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;rate_id&#39;</span><span class="p">]</span>
   <span class="n">node_id</span>      <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;node_id&#39;</span><span class="p">]</span>
   <span class="n">covariate_id</span> <span class="o">=</span> <span class="n">var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;covariate_id&#39;</span><span class="p">]</span>
   <span class="n">value</span>        <span class="o">=</span> <span class="n">fit_var_table</span><span class="p">[</span><span class="n">var_id</span><span class="p">][</span><span class="s1">&#39;fit_var_value&#39;</span><span class="p">]</span>
   <span class="n">fixed</span>        <span class="o">=</span> <span class="kc">True</span>
   <span class="k">if</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;rate&#39;</span> <span class="p">:</span>
      <span class="n">age</span>  <span class="o">=</span> <span class="n">age_table</span><span class="p">[</span><span class="n">age_id</span><span class="p">][</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
      <span class="n">node</span> <span class="o">=</span> <span class="n">node_table</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;node_name&#39;</span><span class="p">]</span>
      <span class="n">rate</span> <span class="o">=</span> <span class="n">rate_table</span><span class="p">[</span><span class="n">rate_id</span><span class="p">][</span><span class="s1">&#39;rate_name&#39;</span><span class="p">]</span>
      <span class="k">assert</span> <span class="n">rate</span> <span class="o">==</span> <span class="s1">&#39;iota&#39;</span>
      <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;n11&#39;</span> <span class="p">:</span>
         <span class="n">truth</span> <span class="o">=</span> <span class="n">avg_integrand</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">avg_income</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">:</span>
         <span class="n">truth</span> <span class="o">=</span> <span class="n">random_effect</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
         <span class="n">fixed</span> <span class="o">=</span> <span class="kc">False</span>
   <span class="k">elif</span> <span class="n">var_type</span> <span class="o">==</span> <span class="s1">&#39;mulcov_rate_value&#39;</span> <span class="p">:</span>
      <span class="n">truth</span> <span class="o">=</span> <span class="n">alpha_true</span>
   <span class="k">if</span> <span class="n">var_type</span> <span class="o">!=</span> <span class="s1">&#39;mulcov_meas_noise&#39;</span> <span class="p">:</span>
      <span class="n">rel_err</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">value</span> <span class="o">/</span> <span class="n">truth</span><span class="p">)</span>
      <span class="n">fmt</span>     <span class="o">=</span> <span class="s1">&#39;fixed=</span><span class="si">{}</span><span class="s1">, truth=</span><span class="si">{:7.4f}</span><span class="s1">, value=</span><span class="si">{:7.4f}</span><span class="s1">, rel_err=</span><span class="si">{:6.3f}</span><span class="s1">&#39;</span>
      <span class="c1"># print( fmt.format(fixed, truth, value, rel_err) )</span>
      <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rel_err</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">2e-1</span> <span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fixed</span><span class="p">,</span> <span class="n">truth</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">rel_err</span><span class="p">)</span> <span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;random_seed = &quot;</span><span class="p">,</span>  <span class="n">random_seed</span><span class="p">)</span>
         <span class="k">assert</span> <span class="kc">False</span>
<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cascade.py: OK&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="user_censor.py.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">user_censor.py</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="user_bnd_mulcov.py.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">user_bnd_mulcov.py</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">user_cascade.py</a><ul>
<li><a class="reference internal" href="#generating-priors-for-next-level-down-node-tree">Generating Priors For Next Level Down Node Tree</a><ul>
<li><a class="reference internal" href="#node-table">Node Table</a></li>
<li><a class="reference internal" href="#problem">Problem</a></li>
<li><a class="reference internal" href="#procedure">Procedure</a><ul>
<li><a class="reference internal" href="#step-1-create-database">Step 1: Create Database</a></li>
<li><a class="reference internal" href="#step-2-fit-with-n1-as-parent">Step 2: Fit With n1 As Parent</a></li>
<li><a class="reference internal" href="#step-3-simulate-data">Step 3: Simulate Data</a></li>
<li><a class="reference internal" href="#step-4-sample-posterior">Step 4: Sample Posterior</a></li>
<li><a class="reference internal" href="#step-5-predictions-for-n11">Step 5: Predictions For n11</a></li>
<li><a class="reference internal" href="#step-6-priors-for-n11-as-parent">Step 6: Priors For n11 As Parent</a></li>
<li><a class="reference internal" href="#step-7-fit-n11-as-parent">Step 7: Fit n11 As Parent</a></li>
</ul>
</li>
<li><a class="reference internal" href="#problem-parameters">Problem Parameters</a></li>
<li><a class="reference internal" href="#age-and-time-values">Age and Time Values</a></li>
<li><a class="reference internal" href="#rate-table">Rate Table</a></li>
<li><a class="reference internal" href="#covariates">Covariates</a></li>
<li><a class="reference internal" href="#multipliers">Multipliers</a><ul>
<li><a class="reference internal" href="#gamma">gamma</a></li>
<li><a class="reference internal" href="#alpha">alpha</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-table">Data Table</a></li>
<li><a class="reference internal" href="#source-code">Source Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>